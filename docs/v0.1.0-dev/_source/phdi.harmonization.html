
<!DOCTYPE html>

<html lang="English">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>phdi.harmonization package &#8212; Public Health Data Infrastructure (PHDI) 0.1.0-dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="phdi.linkage package" href="phdi.linkage.html" />
    <link rel="prev" title="phdi.geospatial package" href="phdi.geospatial.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="phdi-harmonization-package">
<h1>phdi.harmonization package<a class="headerlink" href="#phdi-harmonization-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-phdi.harmonization.hl7">
<span id="phdi-harmonization-hl7-module"></span><h2>phdi.harmonization.hl7 module<a class="headerlink" href="#module-phdi.harmonization.hl7" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.hl7.convert_hl7_batch_messages_to_list">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.hl7.</span></span><span class="sig-name descname"><span class="pre">convert_hl7_batch_messages_to_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">content</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'\n'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#convert_hl7_batch_messages_to_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.hl7.convert_hl7_batch_messages_to_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a batch file of messages into a list of strings
representing parts of the message. This function is based
on the following header/tail segments:</p>
<ul class="simple">
<li><dl class="simple">
<dt>FHS is a &quot;File Header Segment&quot;, which is used to head a file</dt><dd><p>(group of batches)</p>
</dd>
</dl>
</li>
<li><p>FTS is a &quot;File Trailer Segment&quot;, which defines the end of a file</p></li>
<li><p>BHS is &quot;Batch Header Segment&quot;, which defines the start of a batch</p></li>
<li><p>BTS is &quot;Batch Trailer Segment&quot;, which defines the end of a batch</p></li>
</ul>
<p>The structure of an HL7 Batch looks like this:
[FHS] (file header segment) { [BHS] (batch header segment)
{ [MSH (zero or more HL7 messages)
....
....
....
] }
[BTS] (batch trailer segment)
}
[FTS] (file trailer segment)</p>
<p>Ignores lines that start with these header/tail segments since we don't want to
include them in a message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>content</strong> (<em>str</em>) -- The batch content to turn into a list.</p></li>
<li><p><strong>delimiter</strong> (<em>str</em>) -- The character delimiting messages in the batch.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of separated, cleaned HL7 messages.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><em>List</em>[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.hl7.default_hl7_value">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.hl7.</span></span><span class="sig-name descname"><span class="pre">default_hl7_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#default_hl7_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.hl7.default_hl7_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults a field value in an HL7 message.</p>
<p>This function accepts either segments terminated by <cite>r</cite> or <cite>n</cite>, but always
returns data with <cite>n</cite> as the segment terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>str</em>) -- A string representing the HL7 message use to modify
a value.</p></li>
<li><p><strong>segment_id</strong> (<em>str</em>) -- The segment type (MSH, PID, etc) of the field to replace.</p></li>
<li><p><strong>field_num</strong> (<em>int</em>) -- The field number to replace in the segment named by <cite>segment_id</cite>.</p></li>
<li><p><strong>default_value</strong> (<em>str</em>) -- If the selected field is blank, set the
field's value to this value.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The HL7 message with default value inserted at the
specified segment location, if possible. If not, then the
original message.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.hl7.normalize_hl7_datetime">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.hl7.</span></span><span class="sig-name descname"><span class="pre">normalize_hl7_datetime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hl7_datetime</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#normalize_hl7_datetime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.hl7.normalize_hl7_datetime" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits HL7 datetime-formatted fields into the following parts:
&lt;integer 8+ digits&gt;[.&lt;integer 1+ digits&gt;][+/-&lt;integer 4+ digits&gt;]</p>
<p>Each group of integers is truncated to conform to the HL7
specification:
- first integer group: max 14 digits
- following decimal point: max 4 digits
- following +/- (timezone): 4 digits</p>
<p>This normalization facilitates downstream processing using
cloud providers that have particular requirements for dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>hl7_datetime</strong> (<em>str</em>) -- The raw datetime string to clean.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The datetime string with normalizing substitions
performed, or the original HL7 datetime if no matching
format could be found.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.hl7.normalize_hl7_datetime_segment">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.hl7.</span></span><span class="sig-name descname"><span class="pre">normalize_hl7_datetime_segment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#normalize_hl7_datetime_segment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.hl7.normalize_hl7_datetime_segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies datetime normalization to multiple fields in a segment,
overwriting values in the input segment as necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>hl7.containers.Message</em>) -- The HL7 message, represented as a list
of indexable component strings (which is how the HL7 library
processes and returns messages).</p></li>
<li><p><strong>segment_id</strong> (<em>str</em>) -- The segment type (MSH, PID, etc) of the field to replace.</p></li>
<li><p><strong>field_num</strong> -- The field number to replace in the segment named by <cite>segment_id</cite>.</p></li>
<li><p><strong>field_list</strong> (<em>list</em>) -- The list of field numbers to replace in the segment named
by <cite>segement_id</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.hl7.standardize_hl7_datetimes">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.hl7.</span></span><span class="sig-name descname"><span class="pre">standardize_hl7_datetimes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#standardize_hl7_datetimes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.hl7.standardize_hl7_datetimes" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepares an HL7 message for conversion by normalizing / sanitizing
fields that are known to contain datetime data in problematic formats. This
function helps messages conform to expectations.</p>
<p>This function accepts either segments terminated by <cite>r</cite> or <cite>n</cite>, but always
returns data with <cite>n</cite> as the segment terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> (<em>str</em>) -- The raw HL7 message to sanitize.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The HL7 message with potential problem formats resolved. If the function
is unable to parse a date, the original value is retained.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-phdi.harmonization.standardization">
<span id="phdi-harmonization-standardization-module"></span><h2>phdi.harmonization.standardization module<a class="headerlink" href="#module-phdi.harmonization.standardization" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardization.standardize_country_code">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.standardization.</span></span><span class="sig-name descname"><span class="pre">standardize_country_code</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_country</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'alpha_2'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_country_code"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardization.standardize_country_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Identifies the country represented and generate the desired type of the ISO
3611 standardized country identifier for a given string representation of a country
(whether a full name such as &quot;United States&quot;, or an abbreviation such as &quot;US&quot;
or &quot;USA&quot;). If the country identifier could not be determined, returns None.</p>
<p>Example: If raw_country = &quot;United States of America,&quot; then</p>
<ul class="simple">
<li><p>alpha_2 would be &quot;US&quot;</p></li>
<li><p>alpha_3 would be &quot;USA&quot;</p></li>
<li><p>numeric would be &quot;840&quot;</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_country</strong> (<em>str</em>) -- The string representation of the country to be
put in ISO 3611 standardized form.</p></li>
<li><p><strong>code_type</strong> (<em>Literal</em><em>[</em><em>'alpha_2'</em><em>, </em><em>'alpha_3'</em><em>, </em><em>'numeric'</em><em>]</em>) -- One of 'alpha_2', 'alpha_3', or 'numeric'; the
desired identifier type to generate.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The standardized country identifier found in the resource's addresses.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardization.standardize_name">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.standardization.</span></span><span class="sig-name descname"><span class="pre">standardize_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">case</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'upper'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_numbers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardization.standardize_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs basic standardization (described below) on each given name. Removes
punctuation characters and performs a variety of additional cleaning operations.
Other options can be toggled on or off using the relevant parameter.</p>
<p>All options specified will be applied uniformly to each input name,
i.e. specifying case = &quot;lower&quot; will make all given names lower case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_name</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) -- Either a single string name or a list of strings,
each representing a name.</p></li>
<li><p><strong>trim</strong> (<em>bool</em>) -- If true, strips leading/trailing whitespace;
if false, retains whitespace. Default: <cite>True</cite></p></li>
<li><p><strong>case</strong> (<em>Literal</em><em>[</em><em>'upper'</em><em>, </em><em>'lower'</em><em>, </em><em>'title'</em><em>]</em>) -- <p>What case to enforce on each name.</p>
<ul>
<li><p><cite>upper</cite>: All upper case</p></li>
<li><p><cite>lower</cite>: All lower case</p></li>
<li><p><cite>title</cite>: Title case</p></li>
</ul>
<p>Default: <cite>upper</cite></p>
</p></li>
<li><p><strong>remove_numbers</strong> (<em>bool</em>) -- </p></li>
</ul>
</dd>
<dt class="field-even">Remove_numbers</dt>
<dd class="field-even"><p>If true, removes numeric characters from inputs;
if false, retains numeric characters. Default <cite>True</cite></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Either a string or a list of strings, depending on the
input of raw_name, holding the cleaned name(s).</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><em>Union</em>[str, <em>List</em>[str]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardization.standardize_phone">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.standardization.</span></span><span class="sig-name descname"><span class="pre">standardize_phone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_phone</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">countries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">'US']</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_phone"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardization.standardize_phone" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses phone number and generates its standardized ISO E.164 international format
for each given phone number and optional list of associated countries. If an input
phone number can't be parsed, that number returns the empty string. Attempts
to parse the inputs using the first successful strategy out of the following:</p>
<ol class="arabic simple">
<li><p>parse the phone number on its own</p></li>
<li><p>parse the phone number using the provided list of possible
associated countries</p></li>
<li><p>parse the phone number using the US as country</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_phone</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) -- One or more raw phone number(s) to standardize.</p></li>
<li><p><strong>countries</strong> (<em>List</em>) -- An optional list containing 2 letter ISO codes
associated with the phone numbers, signifying to which countries
the phone numbers might belong.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either a string or a list of strings, depending on the
input of raw_phone, holding the standardized phone number(s).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><em>Union</em>[str, <em>List</em>[str]]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-phdi.harmonization">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-phdi.harmonization" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.convert_hl7_batch_messages_to_list">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">convert_hl7_batch_messages_to_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">content</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'\n'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#convert_hl7_batch_messages_to_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.convert_hl7_batch_messages_to_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a batch file of messages into a list of strings
representing parts of the message. This function is based
on the following header/tail segments:</p>
<ul class="simple">
<li><dl class="simple">
<dt>FHS is a &quot;File Header Segment&quot;, which is used to head a file</dt><dd><p>(group of batches)</p>
</dd>
</dl>
</li>
<li><p>FTS is a &quot;File Trailer Segment&quot;, which defines the end of a file</p></li>
<li><p>BHS is &quot;Batch Header Segment&quot;, which defines the start of a batch</p></li>
<li><p>BTS is &quot;Batch Trailer Segment&quot;, which defines the end of a batch</p></li>
</ul>
<p>The structure of an HL7 Batch looks like this:
[FHS] (file header segment) { [BHS] (batch header segment)
{ [MSH (zero or more HL7 messages)
....
....
....
] }
[BTS] (batch trailer segment)
}
[FTS] (file trailer segment)</p>
<p>Ignores lines that start with these header/tail segments since we don't want to
include them in a message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>content</strong> (<em>str</em>) -- The batch content to turn into a list.</p></li>
<li><p><strong>delimiter</strong> (<em>str</em>) -- The character delimiting messages in the batch.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of separated, cleaned HL7 messages.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><em>List</em>[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.default_hl7_value">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">default_hl7_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#default_hl7_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.default_hl7_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults a field value in an HL7 message.</p>
<p>This function accepts either segments terminated by <cite>r</cite> or <cite>n</cite>, but always
returns data with <cite>n</cite> as the segment terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>str</em>) -- A string representing the HL7 message use to modify
a value.</p></li>
<li><p><strong>segment_id</strong> (<em>str</em>) -- The segment type (MSH, PID, etc) of the field to replace.</p></li>
<li><p><strong>field_num</strong> (<em>int</em>) -- The field number to replace in the segment named by <cite>segment_id</cite>.</p></li>
<li><p><strong>default_value</strong> (<em>str</em>) -- If the selected field is blank, set the
field's value to this value.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The HL7 message with default value inserted at the
specified segment location, if possible. If not, then the
original message.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.normalize_hl7_datetime">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">normalize_hl7_datetime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hl7_datetime</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#normalize_hl7_datetime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.normalize_hl7_datetime" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits HL7 datetime-formatted fields into the following parts:
&lt;integer 8+ digits&gt;[.&lt;integer 1+ digits&gt;][+/-&lt;integer 4+ digits&gt;]</p>
<p>Each group of integers is truncated to conform to the HL7
specification:
- first integer group: max 14 digits
- following decimal point: max 4 digits
- following +/- (timezone): 4 digits</p>
<p>This normalization facilitates downstream processing using
cloud providers that have particular requirements for dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>hl7_datetime</strong> (<em>str</em>) -- The raw datetime string to clean.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The datetime string with normalizing substitions
performed, or the original HL7 datetime if no matching
format could be found.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.normalize_hl7_datetime_segment">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">normalize_hl7_datetime_segment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#normalize_hl7_datetime_segment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.normalize_hl7_datetime_segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies datetime normalization to multiple fields in a segment,
overwriting values in the input segment as necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<em>hl7.containers.Message</em>) -- The HL7 message, represented as a list
of indexable component strings (which is how the HL7 library
processes and returns messages).</p></li>
<li><p><strong>segment_id</strong> (<em>str</em>) -- The segment type (MSH, PID, etc) of the field to replace.</p></li>
<li><p><strong>field_num</strong> -- The field number to replace in the segment named by <cite>segment_id</cite>.</p></li>
<li><p><strong>field_list</strong> (<em>list</em>) -- The list of field numbers to replace in the segment named
by <cite>segement_id</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardize_country_code">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">standardize_country_code</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_country</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'alpha_2'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_country_code"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardize_country_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Identifies the country represented and generate the desired type of the ISO
3611 standardized country identifier for a given string representation of a country
(whether a full name such as &quot;United States&quot;, or an abbreviation such as &quot;US&quot;
or &quot;USA&quot;). If the country identifier could not be determined, returns None.</p>
<p>Example: If raw_country = &quot;United States of America,&quot; then</p>
<ul class="simple">
<li><p>alpha_2 would be &quot;US&quot;</p></li>
<li><p>alpha_3 would be &quot;USA&quot;</p></li>
<li><p>numeric would be &quot;840&quot;</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_country</strong> (<em>str</em>) -- The string representation of the country to be
put in ISO 3611 standardized form.</p></li>
<li><p><strong>code_type</strong> (<em>Literal</em><em>[</em><em>'alpha_2'</em><em>, </em><em>'alpha_3'</em><em>, </em><em>'numeric'</em><em>]</em>) -- One of 'alpha_2', 'alpha_3', or 'numeric'; the
desired identifier type to generate.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The standardized country identifier found in the resource's addresses.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardize_hl7_datetimes">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">standardize_hl7_datetimes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/hl7.html#standardize_hl7_datetimes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardize_hl7_datetimes" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepares an HL7 message for conversion by normalizing / sanitizing
fields that are known to contain datetime data in problematic formats. This
function helps messages conform to expectations.</p>
<p>This function accepts either segments terminated by <cite>r</cite> or <cite>n</cite>, but always
returns data with <cite>n</cite> as the segment terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> (<em>str</em>) -- The raw HL7 message to sanitize.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The HL7 message with potential problem formats resolved. If the function
is unable to parse a date, the original value is retained.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardize_name">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">standardize_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">case</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'upper'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_numbers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardize_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs basic standardization (described below) on each given name. Removes
punctuation characters and performs a variety of additional cleaning operations.
Other options can be toggled on or off using the relevant parameter.</p>
<p>All options specified will be applied uniformly to each input name,
i.e. specifying case = &quot;lower&quot; will make all given names lower case.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_name</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) -- Either a single string name or a list of strings,
each representing a name.</p></li>
<li><p><strong>trim</strong> (<em>bool</em>) -- If true, strips leading/trailing whitespace;
if false, retains whitespace. Default: <cite>True</cite></p></li>
<li><p><strong>case</strong> (<em>Literal</em><em>[</em><em>'upper'</em><em>, </em><em>'lower'</em><em>, </em><em>'title'</em><em>]</em>) -- <p>What case to enforce on each name.</p>
<ul>
<li><p><cite>upper</cite>: All upper case</p></li>
<li><p><cite>lower</cite>: All lower case</p></li>
<li><p><cite>title</cite>: Title case</p></li>
</ul>
<p>Default: <cite>upper</cite></p>
</p></li>
<li><p><strong>remove_numbers</strong> (<em>bool</em>) -- </p></li>
</ul>
</dd>
<dt class="field-even">Remove_numbers</dt>
<dd class="field-even"><p>If true, removes numeric characters from inputs;
if false, retains numeric characters. Default <cite>True</cite></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Either a string or a list of strings, depending on the
input of raw_name, holding the cleaned name(s).</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><em>Union</em>[str, <em>List</em>[str]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phdi.harmonization.standardize_phone">
<span class="sig-prename descclassname"><span class="pre">phdi.harmonization.</span></span><span class="sig-name descname"><span class="pre">standardize_phone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_phone</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">countries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">'US']</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/phdi/harmonization/standardization.html#standardize_phone"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#phdi.harmonization.standardize_phone" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses phone number and generates its standardized ISO E.164 international format
for each given phone number and optional list of associated countries. If an input
phone number can't be parsed, that number returns the empty string. Attempts
to parse the inputs using the first successful strategy out of the following:</p>
<ol class="arabic simple">
<li><p>parse the phone number on its own</p></li>
<li><p>parse the phone number using the provided list of possible
associated countries</p></li>
<li><p>parse the phone number using the US as country</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_phone</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em>) -- One or more raw phone number(s) to standardize.</p></li>
<li><p><strong>countries</strong> (<em>List</em>) -- An optional list containing 2 letter ISO codes
associated with the phone numbers, signifying to which countries
the phone numbers might belong.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either a string or a list of strings, depending on the
input of raw_phone, holding the standardized phone number(s).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><em>Union</em>[str, <em>List</em>[str]]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/PHDI-Logo.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=CDCGov&repo=phdi&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">phdi</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="phdi.html">phdi package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="phdi.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="phdi.cloud.html">phdi.cloud package</a></li>
<li class="toctree-l4"><a class="reference internal" href="phdi.fhir.html">phdi.fhir package</a></li>
<li class="toctree-l4"><a class="reference internal" href="phdi.geospatial.html">phdi.geospatial package</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">phdi.harmonization package</a></li>
<li class="toctree-l4"><a class="reference internal" href="phdi.linkage.html">phdi.linkage package</a></li>
<li class="toctree-l4"><a class="reference internal" href="phdi.tabulation.html">phdi.tabulation package</a></li>
<li class="toctree-l4"><a class="reference internal" href="phdi.transport.html">phdi.transport package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="phdi.html#module-phdi">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="modules.html">phdi</a><ul>
  <li><a href="phdi.html">phdi package</a><ul>
      <li>Previous: <a href="phdi.geospatial.html" title="previous chapter">phdi.geospatial package</a></li>
      <li>Next: <a href="phdi.linkage.html" title="next chapter">phdi.linkage package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, PHDI Team and Contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/_source/phdi.harmonization.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>