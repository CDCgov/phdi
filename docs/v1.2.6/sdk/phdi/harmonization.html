<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>phdi.harmonization API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../phdi.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;phdi</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#standardize_hl7_datetimes">standardize_hl7_datetimes</a>
            </li>
            <li>
                    <a class="function" href="#normalize_hl7_datetime_segment">normalize_hl7_datetime_segment</a>
            </li>
            <li>
                    <a class="function" href="#normalize_hl7_datetime">normalize_hl7_datetime</a>
            </li>
            <li>
                    <a class="function" href="#default_hl7_value">default_hl7_value</a>
            </li>
            <li>
                    <a class="function" href="#convert_hl7_batch_messages_to_list">convert_hl7_batch_messages_to_list</a>
            </li>
            <li>
                    <a class="function" href="#standardize_country_code">standardize_country_code</a>
            </li>
            <li>
                    <a class="function" href="#standardize_phone">standardize_phone</a>
            </li>
            <li>
                    <a class="function" href="#standardize_name">standardize_name</a>
            </li>
            <li>
                    <a class="function" href="#double_metaphone_string">double_metaphone_string</a>
            </li>
            <li>
                    <a class="function" href="#compare_strings">compare_strings</a>
            </li>
            <li>
                    <a class="class" href="#DoubleMetaphone">DoubleMetaphone</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DoubleMetaphone.check_word_start">check_word_start</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_vowel">process_vowel</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_b">process_b</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_c">process_c</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_d">process_d</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_f">process_f</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_g">process_g</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_h">process_h</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_j">process_j</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_k">process_k</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_l">process_l</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_m">process_m</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_n">process_n</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_p">process_p</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_q">process_q</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_r">process_r</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_s">process_s</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_t">process_t</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_v">process_v</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_w">process_w</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_x">process_x</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.process_z">process_z</a>
                        </li>
                        <li>
                                <a class="function" href="#DoubleMetaphone.parse">parse</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#standardize_birth_date">standardize_birth_date</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../phdi.html">phdi</a><wbr>.harmonization    </h1>

                
                        <input id="mod-harmonization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-harmonization-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.double_metaphone</span> <span class="kn">import</span> <span class="n">DoubleMetaphone</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.hl7</span> <span class="kn">import</span> <span class="n">convert_hl7_batch_messages_to_list</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.hl7</span> <span class="kn">import</span> <span class="n">default_hl7_value</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.hl7</span> <span class="kn">import</span> <span class="n">normalize_hl7_datetime</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.hl7</span> <span class="kn">import</span> <span class="n">normalize_hl7_datetime_segment</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.hl7</span> <span class="kn">import</span> <span class="n">standardize_hl7_datetimes</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.standardization</span> <span class="kn">import</span> <span class="n">double_metaphone_string</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.standardization</span> <span class="kn">import</span> <span class="n">standardize_birth_date</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.standardization</span> <span class="kn">import</span> <span class="n">standardize_country_code</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.standardization</span> <span class="kn">import</span> <span class="n">standardize_name</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.standardization</span> <span class="kn">import</span> <span class="n">standardize_phone</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">phdi.harmonization.utils</span> <span class="kn">import</span> <span class="n">compare_strings</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s2">&quot;standardize_hl7_datetimes&quot;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;normalize_hl7_datetime_segment&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;normalize_hl7_datetime&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;default_hl7_value&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;convert_hl7_batch_messages_to_list&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;standardize_country_code&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;standardize_phone&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;standardize_name&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;double_metaphone_string&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;compare_strings&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;DoubleMetaphone&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;standardize_birth_date&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="standardize_hl7_datetimes">
                            <input id="standardize_hl7_datetimes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_hl7_datetimes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="standardize_hl7_datetimes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_hl7_datetimes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_hl7_datetimes-9"><a href="#standardize_hl7_datetimes-9"><span class="linenos"> 9</span></a><span class="k">def</span> <span class="nf">standardize_hl7_datetimes</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="standardize_hl7_datetimes-10"><a href="#standardize_hl7_datetimes-10"><span class="linenos">10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_hl7_datetimes-11"><a href="#standardize_hl7_datetimes-11"><span class="linenos">11</span></a><span class="sd">    Prepares an HL7 message for conversion by normalizing / sanitizing</span>
</span><span id="standardize_hl7_datetimes-12"><a href="#standardize_hl7_datetimes-12"><span class="linenos">12</span></a><span class="sd">    fields that are known to contain datetime data in problematic formats. This</span>
</span><span id="standardize_hl7_datetimes-13"><a href="#standardize_hl7_datetimes-13"><span class="linenos">13</span></a><span class="sd">    function helps messages conform to expectations.</span>
</span><span id="standardize_hl7_datetimes-14"><a href="#standardize_hl7_datetimes-14"><span class="linenos">14</span></a>
</span><span id="standardize_hl7_datetimes-15"><a href="#standardize_hl7_datetimes-15"><span class="linenos">15</span></a><span class="sd">    This function accepts either segments terminated by `\\r` or `\\n`, but always</span>
</span><span id="standardize_hl7_datetimes-16"><a href="#standardize_hl7_datetimes-16"><span class="linenos">16</span></a><span class="sd">    returns data with `\\n` as the segment terminator.</span>
</span><span id="standardize_hl7_datetimes-17"><a href="#standardize_hl7_datetimes-17"><span class="linenos">17</span></a>
</span><span id="standardize_hl7_datetimes-18"><a href="#standardize_hl7_datetimes-18"><span class="linenos">18</span></a><span class="sd">    :param message: The raw HL7 message to sanitize.</span>
</span><span id="standardize_hl7_datetimes-19"><a href="#standardize_hl7_datetimes-19"><span class="linenos">19</span></a><span class="sd">    :return: The HL7 message with potential problem formats resolved. If the function</span>
</span><span id="standardize_hl7_datetimes-20"><a href="#standardize_hl7_datetimes-20"><span class="linenos">20</span></a><span class="sd">      is unable to parse a date, the original value is retained.</span>
</span><span id="standardize_hl7_datetimes-21"><a href="#standardize_hl7_datetimes-21"><span class="linenos">21</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_hl7_datetimes-22"><a href="#standardize_hl7_datetimes-22"><span class="linenos">22</span></a>    <span class="n">parsed_message</span><span class="p">:</span> <span class="n">hl7</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="standardize_hl7_datetimes-23"><a href="#standardize_hl7_datetimes-23"><span class="linenos">23</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="standardize_hl7_datetimes-24"><a href="#standardize_hl7_datetimes-24"><span class="linenos">24</span></a>        <span class="c1"># The hl7 module requires \n characters be replaced with \r</span>
</span><span id="standardize_hl7_datetimes-25"><a href="#standardize_hl7_datetimes-25"><span class="linenos">25</span></a>        <span class="n">parsed_message</span> <span class="o">=</span> <span class="n">hl7</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="standardize_hl7_datetimes-26"><a href="#standardize_hl7_datetimes-26"><span class="linenos">26</span></a>
</span><span id="standardize_hl7_datetimes-27"><a href="#standardize_hl7_datetimes-27"><span class="linenos">27</span></a>        <span class="c1"># MSH-7 - Message date/time</span>
</span><span id="standardize_hl7_datetimes-28"><a href="#standardize_hl7_datetimes-28"><span class="linenos">28</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;MSH&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-29"><a href="#standardize_hl7_datetimes-29"><span class="linenos">29</span></a>
</span><span id="standardize_hl7_datetimes-30"><a href="#standardize_hl7_datetimes-30"><span class="linenos">30</span></a>        <span class="c1"># PID-7 - Date of Birth</span>
</span><span id="standardize_hl7_datetimes-31"><a href="#standardize_hl7_datetimes-31"><span class="linenos">31</span></a>        <span class="c1"># PID-29 - Date of Death</span>
</span><span id="standardize_hl7_datetimes-32"><a href="#standardize_hl7_datetimes-32"><span class="linenos">32</span></a>        <span class="c1"># PID-33 - Last update date/time</span>
</span><span id="standardize_hl7_datetimes-33"><a href="#standardize_hl7_datetimes-33"><span class="linenos">33</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;PID&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">33</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-34"><a href="#standardize_hl7_datetimes-34"><span class="linenos">34</span></a>
</span><span id="standardize_hl7_datetimes-35"><a href="#standardize_hl7_datetimes-35"><span class="linenos">35</span></a>        <span class="c1"># PV1-44 - Admission Date</span>
</span><span id="standardize_hl7_datetimes-36"><a href="#standardize_hl7_datetimes-36"><span class="linenos">36</span></a>        <span class="c1"># PV1-45 - Discharge Date</span>
</span><span id="standardize_hl7_datetimes-37"><a href="#standardize_hl7_datetimes-37"><span class="linenos">37</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;PV1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-38"><a href="#standardize_hl7_datetimes-38"><span class="linenos">38</span></a>
</span><span id="standardize_hl7_datetimes-39"><a href="#standardize_hl7_datetimes-39"><span class="linenos">39</span></a>        <span class="c1"># ORC-9 Date/time of transaction</span>
</span><span id="standardize_hl7_datetimes-40"><a href="#standardize_hl7_datetimes-40"><span class="linenos">40</span></a>        <span class="c1"># ORC-15 Order effective date/time</span>
</span><span id="standardize_hl7_datetimes-41"><a href="#standardize_hl7_datetimes-41"><span class="linenos">41</span></a>        <span class="c1"># ORC-27 Filler&#39;s expected availability date/time</span>
</span><span id="standardize_hl7_datetimes-42"><a href="#standardize_hl7_datetimes-42"><span class="linenos">42</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;ORC&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">27</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-43"><a href="#standardize_hl7_datetimes-43"><span class="linenos">43</span></a>
</span><span id="standardize_hl7_datetimes-44"><a href="#standardize_hl7_datetimes-44"><span class="linenos">44</span></a>        <span class="c1"># OBR-7 Observation date/time</span>
</span><span id="standardize_hl7_datetimes-45"><a href="#standardize_hl7_datetimes-45"><span class="linenos">45</span></a>        <span class="c1"># OBR-8 Observation end date/time</span>
</span><span id="standardize_hl7_datetimes-46"><a href="#standardize_hl7_datetimes-46"><span class="linenos">46</span></a>        <span class="c1"># OBR-22 Status change date/time</span>
</span><span id="standardize_hl7_datetimes-47"><a href="#standardize_hl7_datetimes-47"><span class="linenos">47</span></a>        <span class="c1"># OBR-36 Scheduled date/time</span>
</span><span id="standardize_hl7_datetimes-48"><a href="#standardize_hl7_datetimes-48"><span class="linenos">48</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;OBR&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">36</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-49"><a href="#standardize_hl7_datetimes-49"><span class="linenos">49</span></a>
</span><span id="standardize_hl7_datetimes-50"><a href="#standardize_hl7_datetimes-50"><span class="linenos">50</span></a>        <span class="c1"># OBX-12 Effective date/time of reference range</span>
</span><span id="standardize_hl7_datetimes-51"><a href="#standardize_hl7_datetimes-51"><span class="linenos">51</span></a>        <span class="c1"># OBX-14 Date/time of observation</span>
</span><span id="standardize_hl7_datetimes-52"><a href="#standardize_hl7_datetimes-52"><span class="linenos">52</span></a>        <span class="c1"># OBX-19 Date/time of analysis</span>
</span><span id="standardize_hl7_datetimes-53"><a href="#standardize_hl7_datetimes-53"><span class="linenos">53</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;OBX&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-54"><a href="#standardize_hl7_datetimes-54"><span class="linenos">54</span></a>
</span><span id="standardize_hl7_datetimes-55"><a href="#standardize_hl7_datetimes-55"><span class="linenos">55</span></a>        <span class="c1"># TQ1-7 Start date/time</span>
</span><span id="standardize_hl7_datetimes-56"><a href="#standardize_hl7_datetimes-56"><span class="linenos">56</span></a>        <span class="c1"># TQ1-8 End date/time</span>
</span><span id="standardize_hl7_datetimes-57"><a href="#standardize_hl7_datetimes-57"><span class="linenos">57</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;TQ1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-58"><a href="#standardize_hl7_datetimes-58"><span class="linenos">58</span></a>
</span><span id="standardize_hl7_datetimes-59"><a href="#standardize_hl7_datetimes-59"><span class="linenos">59</span></a>        <span class="c1"># SPM-18 Specimen received date/time</span>
</span><span id="standardize_hl7_datetimes-60"><a href="#standardize_hl7_datetimes-60"><span class="linenos">60</span></a>        <span class="c1"># SPM-19 Specimen expiration date/time</span>
</span><span id="standardize_hl7_datetimes-61"><a href="#standardize_hl7_datetimes-61"><span class="linenos">61</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;SPM&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-62"><a href="#standardize_hl7_datetimes-62"><span class="linenos">62</span></a>
</span><span id="standardize_hl7_datetimes-63"><a href="#standardize_hl7_datetimes-63"><span class="linenos">63</span></a>        <span class="c1"># RXA-3 Date/time start of administration</span>
</span><span id="standardize_hl7_datetimes-64"><a href="#standardize_hl7_datetimes-64"><span class="linenos">64</span></a>        <span class="c1"># RXA-4 Date/time end of administration</span>
</span><span id="standardize_hl7_datetimes-65"><a href="#standardize_hl7_datetimes-65"><span class="linenos">65</span></a>        <span class="c1"># RXA-16 Substance expiration date</span>
</span><span id="standardize_hl7_datetimes-66"><a href="#standardize_hl7_datetimes-66"><span class="linenos">66</span></a>        <span class="c1"># RXA-22 System entry date/time</span>
</span><span id="standardize_hl7_datetimes-67"><a href="#standardize_hl7_datetimes-67"><span class="linenos">67</span></a>        <span class="n">normalize_hl7_datetime_segment</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">,</span> <span class="s2">&quot;RXA&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">22</span><span class="p">])</span>
</span><span id="standardize_hl7_datetimes-68"><a href="#standardize_hl7_datetimes-68"><span class="linenos">68</span></a>
</span><span id="standardize_hl7_datetimes-69"><a href="#standardize_hl7_datetimes-69"><span class="linenos">69</span></a>    <span class="c1"># @TODO: Eliminate logging, raise an exception, document the exception</span>
</span><span id="standardize_hl7_datetimes-70"><a href="#standardize_hl7_datetimes-70"><span class="linenos">70</span></a>    <span class="c1"># in the docstring, and make this fit into our new structure of allowing</span>
</span><span id="standardize_hl7_datetimes-71"><a href="#standardize_hl7_datetimes-71"><span class="linenos">71</span></a>    <span class="c1"># the caller to implement more robust error handling</span>
</span><span id="standardize_hl7_datetimes-72"><a href="#standardize_hl7_datetimes-72"><span class="linenos">72</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="standardize_hl7_datetimes-73"><a href="#standardize_hl7_datetimes-73"><span class="linenos">73</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
</span><span id="standardize_hl7_datetimes-74"><a href="#standardize_hl7_datetimes-74"><span class="linenos">74</span></a>            <span class="s2">&quot;Exception occurred while cleaning message.  &quot;</span>
</span><span id="standardize_hl7_datetimes-75"><a href="#standardize_hl7_datetimes-75"><span class="linenos">75</span></a>            <span class="o">+</span> <span class="s2">&quot;Passing through original message.&quot;</span>
</span><span id="standardize_hl7_datetimes-76"><a href="#standardize_hl7_datetimes-76"><span class="linenos">76</span></a>        <span class="p">)</span>
</span><span id="standardize_hl7_datetimes-77"><a href="#standardize_hl7_datetimes-77"><span class="linenos">77</span></a>
</span><span id="standardize_hl7_datetimes-78"><a href="#standardize_hl7_datetimes-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="n">message</span>
</span><span id="standardize_hl7_datetimes-79"><a href="#standardize_hl7_datetimes-79"><span class="linenos">79</span></a>
</span><span id="standardize_hl7_datetimes-80"><a href="#standardize_hl7_datetimes-80"><span class="linenos">80</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prepares an HL7 message for conversion by normalizing / sanitizing
fields that are known to contain datetime data in problematic formats. This
function helps messages conform to expectations.</p>

<p>This function accepts either segments terminated by <code>\r</code> or <code>\n</code>, but always
returns data with <code>\n</code> as the segment terminator.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>message</strong>:  The raw HL7 message to sanitize.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The HL7 message with potential problem formats resolved. If the function
    is unable to parse a date, the original value is retained.</p>
</blockquote>
</div>


                </section>
                <section id="normalize_hl7_datetime_segment">
                            <input id="normalize_hl7_datetime_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_hl7_datetime_segment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">message</span><span class="p">:</span> <span class="n">hl7</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">Message</span>,</span><span class="param">	<span class="n">segment_id</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="normalize_hl7_datetime_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#normalize_hl7_datetime_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="normalize_hl7_datetime_segment-200"><a href="#normalize_hl7_datetime_segment-200"><span class="linenos">200</span></a><span class="k">def</span> <span class="nf">normalize_hl7_datetime_segment</span><span class="p">(</span>
</span><span id="normalize_hl7_datetime_segment-201"><a href="#normalize_hl7_datetime_segment-201"><span class="linenos">201</span></a>    <span class="n">message</span><span class="p">:</span> <span class="n">hl7</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field_list</span><span class="p">:</span> <span class="nb">list</span>
</span><span id="normalize_hl7_datetime_segment-202"><a href="#normalize_hl7_datetime_segment-202"><span class="linenos">202</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime_segment-203"><a href="#normalize_hl7_datetime_segment-203"><span class="linenos">203</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="normalize_hl7_datetime_segment-204"><a href="#normalize_hl7_datetime_segment-204"><span class="linenos">204</span></a><span class="sd">    Applies datetime normalization to multiple fields in a segment,</span>
</span><span id="normalize_hl7_datetime_segment-205"><a href="#normalize_hl7_datetime_segment-205"><span class="linenos">205</span></a><span class="sd">    overwriting values in the input segment as necessary.</span>
</span><span id="normalize_hl7_datetime_segment-206"><a href="#normalize_hl7_datetime_segment-206"><span class="linenos">206</span></a>
</span><span id="normalize_hl7_datetime_segment-207"><a href="#normalize_hl7_datetime_segment-207"><span class="linenos">207</span></a><span class="sd">    :param message: The HL7 message, represented as a list</span>
</span><span id="normalize_hl7_datetime_segment-208"><a href="#normalize_hl7_datetime_segment-208"><span class="linenos">208</span></a><span class="sd">      of indexable component strings (which is how the HL7 library</span>
</span><span id="normalize_hl7_datetime_segment-209"><a href="#normalize_hl7_datetime_segment-209"><span class="linenos">209</span></a><span class="sd">      processes and returns messages).</span>
</span><span id="normalize_hl7_datetime_segment-210"><a href="#normalize_hl7_datetime_segment-210"><span class="linenos">210</span></a><span class="sd">    :param segment_id: The segment type (MSH, PID, etc) of the field to replace.</span>
</span><span id="normalize_hl7_datetime_segment-211"><a href="#normalize_hl7_datetime_segment-211"><span class="linenos">211</span></a><span class="sd">    :param field_num: The field number to replace in the segment named by `segment_id`.</span>
</span><span id="normalize_hl7_datetime_segment-212"><a href="#normalize_hl7_datetime_segment-212"><span class="linenos">212</span></a><span class="sd">    :param field_list: The list of field numbers to replace in the segment named</span>
</span><span id="normalize_hl7_datetime_segment-213"><a href="#normalize_hl7_datetime_segment-213"><span class="linenos">213</span></a><span class="sd">      by `segement_id`.</span>
</span><span id="normalize_hl7_datetime_segment-214"><a href="#normalize_hl7_datetime_segment-214"><span class="linenos">214</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="normalize_hl7_datetime_segment-215"><a href="#normalize_hl7_datetime_segment-215"><span class="linenos">215</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime_segment-216"><a href="#normalize_hl7_datetime_segment-216"><span class="linenos">216</span></a>        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">segments</span><span class="p">(</span><span class="n">segment_id</span><span class="p">):</span>
</span><span id="normalize_hl7_datetime_segment-217"><a href="#normalize_hl7_datetime_segment-217"><span class="linenos">217</span></a>            <span class="k">for</span> <span class="n">field_num</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime_segment-218"><a href="#normalize_hl7_datetime_segment-218"><span class="linenos">218</span></a>                <span class="c1"># Datetime value is always in first component</span>
</span><span id="normalize_hl7_datetime_segment-219"><a href="#normalize_hl7_datetime_segment-219"><span class="linenos">219</span></a>                <span class="n">component_num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="normalize_hl7_datetime_segment-220"><a href="#normalize_hl7_datetime_segment-220"><span class="linenos">220</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">field_num</span> <span class="ow">and</span> <span class="n">segment</span><span class="p">[</span><span class="n">field_num</span><span class="p">][</span><span class="n">component_num</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime_segment-221"><a href="#normalize_hl7_datetime_segment-221"><span class="linenos">221</span></a>                    <span class="n">cleaned_datetime</span> <span class="o">=</span> <span class="n">normalize_hl7_datetime</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="n">field_num</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="normalize_hl7_datetime_segment-222"><a href="#normalize_hl7_datetime_segment-222"><span class="linenos">222</span></a>                    <span class="n">segment</span><span class="p">[</span><span class="n">field_num</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cleaned_datetime</span>
</span><span id="normalize_hl7_datetime_segment-223"><a href="#normalize_hl7_datetime_segment-223"><span class="linenos">223</span></a>
</span><span id="normalize_hl7_datetime_segment-224"><a href="#normalize_hl7_datetime_segment-224"><span class="linenos">224</span></a>    <span class="c1"># @TODO: Eliminate logging, raise an exception, document the exception</span>
</span><span id="normalize_hl7_datetime_segment-225"><a href="#normalize_hl7_datetime_segment-225"><span class="linenos">225</span></a>    <span class="c1"># in the docstring, and make this fit into our new structure of allowing</span>
</span><span id="normalize_hl7_datetime_segment-226"><a href="#normalize_hl7_datetime_segment-226"><span class="linenos">226</span></a>    <span class="c1"># the caller to implement more robust error handling</span>
</span><span id="normalize_hl7_datetime_segment-227"><a href="#normalize_hl7_datetime_segment-227"><span class="linenos">227</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime_segment-228"><a href="#normalize_hl7_datetime_segment-228"><span class="linenos">228</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Segment </span><span class="si">{</span><span class="n">segment_id</span><span class="si">}</span><span class="s2"> not found in message.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies datetime normalization to multiple fields in a segment,
overwriting values in the input segment as necessary.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>message</strong>:  The HL7 message, represented as a list
of indexable component strings (which is how the HL7 library
processes and returns messages).</li>
<li><strong>segment_id</strong>:  The segment type (MSH, PID, etc) of the field to replace.</li>
<li><strong>field_num</strong>:  The field number to replace in the segment named by <code>segment_id</code>.</li>
<li><strong>field_list</strong>:  The list of field numbers to replace in the segment named
by <code>segement_id</code>.</li>
</ul>
</div>


                </section>
                <section id="normalize_hl7_datetime">
                            <input id="normalize_hl7_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normalize_hl7_datetime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">hl7_datetime</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="normalize_hl7_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#normalize_hl7_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="normalize_hl7_datetime-231"><a href="#normalize_hl7_datetime-231"><span class="linenos">231</span></a><span class="k">def</span> <span class="nf">normalize_hl7_datetime</span><span class="p">(</span><span class="n">hl7_datetime</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime-232"><a href="#normalize_hl7_datetime-232"><span class="linenos">232</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="normalize_hl7_datetime-233"><a href="#normalize_hl7_datetime-233"><span class="linenos">233</span></a><span class="sd">    Splits HL7 datetime-formatted fields into the following parts:</span>
</span><span id="normalize_hl7_datetime-234"><a href="#normalize_hl7_datetime-234"><span class="linenos">234</span></a><span class="sd">    &lt;integer 8+ digits&gt;[.&lt;integer 1+ digits&gt;][+/-&lt;integer 4+ digits&gt;]</span>
</span><span id="normalize_hl7_datetime-235"><a href="#normalize_hl7_datetime-235"><span class="linenos">235</span></a>
</span><span id="normalize_hl7_datetime-236"><a href="#normalize_hl7_datetime-236"><span class="linenos">236</span></a><span class="sd">    Each group of integers is truncated to conform to the HL7</span>
</span><span id="normalize_hl7_datetime-237"><a href="#normalize_hl7_datetime-237"><span class="linenos">237</span></a><span class="sd">    specification:</span>
</span><span id="normalize_hl7_datetime-238"><a href="#normalize_hl7_datetime-238"><span class="linenos">238</span></a>
</span><span id="normalize_hl7_datetime-239"><a href="#normalize_hl7_datetime-239"><span class="linenos">239</span></a><span class="sd">    - first integer group: max 14 digits</span>
</span><span id="normalize_hl7_datetime-240"><a href="#normalize_hl7_datetime-240"><span class="linenos">240</span></a><span class="sd">    - following decimal point: max 4 digits</span>
</span><span id="normalize_hl7_datetime-241"><a href="#normalize_hl7_datetime-241"><span class="linenos">241</span></a><span class="sd">    - following +/- (timezone): 4 digits</span>
</span><span id="normalize_hl7_datetime-242"><a href="#normalize_hl7_datetime-242"><span class="linenos">242</span></a>
</span><span id="normalize_hl7_datetime-243"><a href="#normalize_hl7_datetime-243"><span class="linenos">243</span></a><span class="sd">    This normalization facilitates downstream processing using</span>
</span><span id="normalize_hl7_datetime-244"><a href="#normalize_hl7_datetime-244"><span class="linenos">244</span></a><span class="sd">    cloud providers that have particular requirements for dates.</span>
</span><span id="normalize_hl7_datetime-245"><a href="#normalize_hl7_datetime-245"><span class="linenos">245</span></a>
</span><span id="normalize_hl7_datetime-246"><a href="#normalize_hl7_datetime-246"><span class="linenos">246</span></a><span class="sd">    :param hl7_datetime: The raw datetime string to clean.</span>
</span><span id="normalize_hl7_datetime-247"><a href="#normalize_hl7_datetime-247"><span class="linenos">247</span></a><span class="sd">    :return: The datetime string with normalizing substitutions</span>
</span><span id="normalize_hl7_datetime-248"><a href="#normalize_hl7_datetime-248"><span class="linenos">248</span></a><span class="sd">      performed, or the original HL7 datetime if no matching</span>
</span><span id="normalize_hl7_datetime-249"><a href="#normalize_hl7_datetime-249"><span class="linenos">249</span></a><span class="sd">      format could be found.</span>
</span><span id="normalize_hl7_datetime-250"><a href="#normalize_hl7_datetime-250"><span class="linenos">250</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="normalize_hl7_datetime-251"><a href="#normalize_hl7_datetime-251"><span class="linenos">251</span></a>
</span><span id="normalize_hl7_datetime-252"><a href="#normalize_hl7_datetime-252"><span class="linenos">252</span></a>    <span class="n">hl7_datetime_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d</span><span class="si">{8}</span><span class="s2">\d*)(\.\d+)?([+-]\d+)?&quot;</span><span class="p">,</span> <span class="n">hl7_datetime</span><span class="p">)</span>
</span><span id="normalize_hl7_datetime-253"><a href="#normalize_hl7_datetime-253"><span class="linenos">253</span></a>
</span><span id="normalize_hl7_datetime-254"><a href="#normalize_hl7_datetime-254"><span class="linenos">254</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">hl7_datetime_match</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime-255"><a href="#normalize_hl7_datetime-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">hl7_datetime</span>
</span><span id="normalize_hl7_datetime-256"><a href="#normalize_hl7_datetime-256"><span class="linenos">256</span></a>
</span><span id="normalize_hl7_datetime-257"><a href="#normalize_hl7_datetime-257"><span class="linenos">257</span></a>    <span class="n">hl7_datetime_parts</span> <span class="o">=</span> <span class="n">hl7_datetime_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="normalize_hl7_datetime-258"><a href="#normalize_hl7_datetime-258"><span class="linenos">258</span></a>
</span><span id="normalize_hl7_datetime-259"><a href="#normalize_hl7_datetime-259"><span class="linenos">259</span></a>    <span class="c1"># Start with date base</span>
</span><span id="normalize_hl7_datetime-260"><a href="#normalize_hl7_datetime-260"><span class="linenos">260</span></a>    <span class="n">normalized_datetime</span> <span class="o">=</span> <span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">14</span><span class="p">]</span>  <span class="c1"># First 14 digits</span>
</span><span id="normalize_hl7_datetime-261"><a href="#normalize_hl7_datetime-261"><span class="linenos">261</span></a>
</span><span id="normalize_hl7_datetime-262"><a href="#normalize_hl7_datetime-262"><span class="linenos">262</span></a>    <span class="c1"># Add date decimal if present</span>
</span><span id="normalize_hl7_datetime-263"><a href="#normalize_hl7_datetime-263"><span class="linenos">263</span></a>    <span class="k">if</span> <span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="normalize_hl7_datetime-264"><a href="#normalize_hl7_datetime-264"><span class="linenos">264</span></a>        <span class="n">normalized_datetime</span> <span class="o">+=</span> <span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># . plus first 4 digits</span>
</span><span id="normalize_hl7_datetime-265"><a href="#normalize_hl7_datetime-265"><span class="linenos">265</span></a>
</span><span id="normalize_hl7_datetime-266"><a href="#normalize_hl7_datetime-266"><span class="linenos">266</span></a>    <span class="c1"># Add timezone information if present</span>
</span><span id="normalize_hl7_datetime-267"><a href="#normalize_hl7_datetime-267"><span class="linenos">267</span></a>    <span class="k">if</span> <span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="normalize_hl7_datetime-268"><a href="#normalize_hl7_datetime-268"><span class="linenos">268</span></a>        <span class="n">normalized_datetime</span> <span class="o">+=</span> <span class="n">hl7_datetime_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># +/- plus 4 digits</span>
</span><span id="normalize_hl7_datetime-269"><a href="#normalize_hl7_datetime-269"><span class="linenos">269</span></a>
</span><span id="normalize_hl7_datetime-270"><a href="#normalize_hl7_datetime-270"><span class="linenos">270</span></a>    <span class="k">return</span> <span class="n">normalized_datetime</span>
</span></pre></div>


            <div class="docstring"><p>Splits HL7 datetime-formatted fields into the following parts:
<integer 8+ digits>[.<integer 1+ digits>][+/-<integer 4+ digits>]</p>

<p>Each group of integers is truncated to conform to the HL7
specification:</p>

<ul>
<li>first integer group: max 14 digits</li>
<li>following decimal point: max 4 digits</li>
<li>following +/- (timezone): 4 digits</li>
</ul>

<p>This normalization facilitates downstream processing using
cloud providers that have particular requirements for dates.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>hl7_datetime</strong>:  The raw datetime string to clean.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The datetime string with normalizing substitutions
    performed, or the original HL7 datetime if no matching
    format could be found.</p>
</blockquote>
</div>


                </section>
                <section id="default_hl7_value">
                            <input id="default_hl7_value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">default_hl7_value</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">segment_id</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">field_num</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">default_value</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="default_hl7_value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#default_hl7_value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="default_hl7_value-148"><a href="#default_hl7_value-148"><span class="linenos">148</span></a><span class="k">def</span> <span class="nf">default_hl7_value</span><span class="p">(</span>
</span><span id="default_hl7_value-149"><a href="#default_hl7_value-149"><span class="linenos">149</span></a>    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">default_value</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="default_hl7_value-150"><a href="#default_hl7_value-150"><span class="linenos">150</span></a><span class="p">):</span>
</span><span id="default_hl7_value-151"><a href="#default_hl7_value-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="default_hl7_value-152"><a href="#default_hl7_value-152"><span class="linenos">152</span></a><span class="sd">    Defaults a field value in an HL7 message.</span>
</span><span id="default_hl7_value-153"><a href="#default_hl7_value-153"><span class="linenos">153</span></a>
</span><span id="default_hl7_value-154"><a href="#default_hl7_value-154"><span class="linenos">154</span></a><span class="sd">    This function accepts either segments terminated by `\\r` or `\\n`, but always</span>
</span><span id="default_hl7_value-155"><a href="#default_hl7_value-155"><span class="linenos">155</span></a><span class="sd">    returns data with `\\n` as the segment terminator.</span>
</span><span id="default_hl7_value-156"><a href="#default_hl7_value-156"><span class="linenos">156</span></a>
</span><span id="default_hl7_value-157"><a href="#default_hl7_value-157"><span class="linenos">157</span></a><span class="sd">    :param message: A string representing the HL7 message used to modify</span>
</span><span id="default_hl7_value-158"><a href="#default_hl7_value-158"><span class="linenos">158</span></a><span class="sd">      a value.</span>
</span><span id="default_hl7_value-159"><a href="#default_hl7_value-159"><span class="linenos">159</span></a><span class="sd">    :param segment_id: The segment type (MSH, PID, etc) of the field to replace.</span>
</span><span id="default_hl7_value-160"><a href="#default_hl7_value-160"><span class="linenos">160</span></a><span class="sd">    :param field_num: The field number to replace in the segment named by `segment_id`.</span>
</span><span id="default_hl7_value-161"><a href="#default_hl7_value-161"><span class="linenos">161</span></a><span class="sd">    :param default_value: If the selected field is blank, set the</span>
</span><span id="default_hl7_value-162"><a href="#default_hl7_value-162"><span class="linenos">162</span></a><span class="sd">      field&#39;s value to this value.</span>
</span><span id="default_hl7_value-163"><a href="#default_hl7_value-163"><span class="linenos">163</span></a><span class="sd">    :return: The HL7 message with default value inserted at the</span>
</span><span id="default_hl7_value-164"><a href="#default_hl7_value-164"><span class="linenos">164</span></a><span class="sd">      specified segment location, if possible. If not, then the</span>
</span><span id="default_hl7_value-165"><a href="#default_hl7_value-165"><span class="linenos">165</span></a><span class="sd">      original message.</span>
</span><span id="default_hl7_value-166"><a href="#default_hl7_value-166"><span class="linenos">166</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="default_hl7_value-167"><a href="#default_hl7_value-167"><span class="linenos">167</span></a>
</span><span id="default_hl7_value-168"><a href="#default_hl7_value-168"><span class="linenos">168</span></a>    <span class="n">parsed_message</span><span class="p">:</span> <span class="n">hl7</span><span class="o">.</span><span class="n">Message</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="default_hl7_value-169"><a href="#default_hl7_value-169"><span class="linenos">169</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="default_hl7_value-170"><a href="#default_hl7_value-170"><span class="linenos">170</span></a>        <span class="c1"># The hl7 module requires \n characters be replaced with \r</span>
</span><span id="default_hl7_value-171"><a href="#default_hl7_value-171"><span class="linenos">171</span></a>        <span class="n">parsed_message</span> <span class="o">=</span> <span class="n">hl7</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="default_hl7_value-172"><a href="#default_hl7_value-172"><span class="linenos">172</span></a>
</span><span id="default_hl7_value-173"><a href="#default_hl7_value-173"><span class="linenos">173</span></a>        <span class="n">segment</span><span class="p">:</span> <span class="n">hl7</span><span class="o">.</span><span class="n">Segment</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="default_hl7_value-174"><a href="#default_hl7_value-174"><span class="linenos">174</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="default_hl7_value-175"><a href="#default_hl7_value-175"><span class="linenos">175</span></a>            <span class="n">segment</span> <span class="o">=</span> <span class="n">parsed_message</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">segment_id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">)</span>
</span><span id="default_hl7_value-176"><a href="#default_hl7_value-176"><span class="linenos">176</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="default_hl7_value-177"><a href="#default_hl7_value-177"><span class="linenos">177</span></a>            <span class="c1"># If the segment is not found, there is nothing to do</span>
</span><span id="default_hl7_value-178"><a href="#default_hl7_value-178"><span class="linenos">178</span></a>            <span class="k">return</span> <span class="n">message</span>
</span><span id="default_hl7_value-179"><a href="#default_hl7_value-179"><span class="linenos">179</span></a>
</span><span id="default_hl7_value-180"><a href="#default_hl7_value-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="default_hl7_value-181"><a href="#default_hl7_value-181"><span class="linenos">181</span></a>            <span class="n">segment</span><span class="o">.</span><span class="n">extract_field</span><span class="p">(</span><span class="n">field_num</span><span class="o">=</span><span class="n">field_num</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="default_hl7_value-182"><a href="#default_hl7_value-182"><span class="linenos">182</span></a>            <span class="ow">or</span> <span class="n">segment</span><span class="o">.</span><span class="n">extract_field</span><span class="p">(</span><span class="n">field_num</span><span class="o">=</span><span class="n">field_num</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</span><span id="default_hl7_value-183"><a href="#default_hl7_value-183"><span class="linenos">183</span></a>        <span class="p">):</span>
</span><span id="default_hl7_value-184"><a href="#default_hl7_value-184"><span class="linenos">184</span></a>            <span class="n">segment</span><span class="o">.</span><span class="n">assign_field</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span> <span class="n">field_num</span><span class="o">=</span><span class="n">field_num</span><span class="p">)</span>
</span><span id="default_hl7_value-185"><a href="#default_hl7_value-185"><span class="linenos">185</span></a>
</span><span id="default_hl7_value-186"><a href="#default_hl7_value-186"><span class="linenos">186</span></a>    <span class="c1"># @TODO: Eliminate logging, raise an exception, document the exception</span>
</span><span id="default_hl7_value-187"><a href="#default_hl7_value-187"><span class="linenos">187</span></a>    <span class="c1"># in the docstring, and make this fit into our new structure of allowing</span>
</span><span id="default_hl7_value-188"><a href="#default_hl7_value-188"><span class="linenos">188</span></a>    <span class="c1"># the caller to implement more robust error handling</span>
</span><span id="default_hl7_value-189"><a href="#default_hl7_value-189"><span class="linenos">189</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="default_hl7_value-190"><a href="#default_hl7_value-190"><span class="linenos">190</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
</span><span id="default_hl7_value-191"><a href="#default_hl7_value-191"><span class="linenos">191</span></a>            <span class="s2">&quot;Exception occurred while cleaning message.  &quot;</span>
</span><span id="default_hl7_value-192"><a href="#default_hl7_value-192"><span class="linenos">192</span></a>            <span class="o">+</span> <span class="s2">&quot;Passing through original message.&quot;</span>
</span><span id="default_hl7_value-193"><a href="#default_hl7_value-193"><span class="linenos">193</span></a>        <span class="p">)</span>
</span><span id="default_hl7_value-194"><a href="#default_hl7_value-194"><span class="linenos">194</span></a>
</span><span id="default_hl7_value-195"><a href="#default_hl7_value-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="n">message</span>
</span><span id="default_hl7_value-196"><a href="#default_hl7_value-196"><span class="linenos">196</span></a>
</span><span id="default_hl7_value-197"><a href="#default_hl7_value-197"><span class="linenos">197</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">parsed_message</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Defaults a field value in an HL7 message.</p>

<p>This function accepts either segments terminated by <code>\r</code> or <code>\n</code>, but always
returns data with <code>\n</code> as the segment terminator.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>message</strong>:  A string representing the HL7 message used to modify
a value.</li>
<li><strong>segment_id</strong>:  The segment type (MSH, PID, etc) of the field to replace.</li>
<li><strong>field_num</strong>:  The field number to replace in the segment named by <code>segment_id</code>.</li>
<li><strong>default_value</strong>:  If the selected field is blank, set the
field's value to this value.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The HL7 message with default value inserted at the
    specified segment location, if possible. If not, then the
    original message.</p>
</blockquote>
</div>


                </section>
                <section id="convert_hl7_batch_messages_to_list">
                            <input id="convert_hl7_batch_messages_to_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_hl7_batch_messages_to_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="convert_hl7_batch_messages_to_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert_hl7_batch_messages_to_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert_hl7_batch_messages_to_list-83"><a href="#convert_hl7_batch_messages_to_list-83"><span class="linenos"> 83</span></a><span class="k">def</span> <span class="nf">convert_hl7_batch_messages_to_list</span><span class="p">(</span>
</span><span id="convert_hl7_batch_messages_to_list-84"><a href="#convert_hl7_batch_messages_to_list-84"><span class="linenos"> 84</span></a>    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-85"><a href="#convert_hl7_batch_messages_to_list-85"><span class="linenos"> 85</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="convert_hl7_batch_messages_to_list-86"><a href="#convert_hl7_batch_messages_to_list-86"><span class="linenos"> 86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-87"><a href="#convert_hl7_batch_messages_to_list-87"><span class="linenos"> 87</span></a><span class="sd">    Converts a batch file of messages into a list of strings</span>
</span><span id="convert_hl7_batch_messages_to_list-88"><a href="#convert_hl7_batch_messages_to_list-88"><span class="linenos"> 88</span></a><span class="sd">    representing parts of the message. This function is based</span>
</span><span id="convert_hl7_batch_messages_to_list-89"><a href="#convert_hl7_batch_messages_to_list-89"><span class="linenos"> 89</span></a><span class="sd">    on the following header/tail segments:</span>
</span><span id="convert_hl7_batch_messages_to_list-90"><a href="#convert_hl7_batch_messages_to_list-90"><span class="linenos"> 90</span></a>
</span><span id="convert_hl7_batch_messages_to_list-91"><a href="#convert_hl7_batch_messages_to_list-91"><span class="linenos"> 91</span></a><span class="sd">    * FHS is a &quot;File Header Segment,&quot; which is used to head a file</span>
</span><span id="convert_hl7_batch_messages_to_list-92"><a href="#convert_hl7_batch_messages_to_list-92"><span class="linenos"> 92</span></a><span class="sd">        (group of batches)</span>
</span><span id="convert_hl7_batch_messages_to_list-93"><a href="#convert_hl7_batch_messages_to_list-93"><span class="linenos"> 93</span></a><span class="sd">    * FTS is a &quot;File Trailer Segment,&quot; which defines the end of a file</span>
</span><span id="convert_hl7_batch_messages_to_list-94"><a href="#convert_hl7_batch_messages_to_list-94"><span class="linenos"> 94</span></a><span class="sd">    * BHS is &quot;Batch Header Segment,&quot; which defines the start of a batch</span>
</span><span id="convert_hl7_batch_messages_to_list-95"><a href="#convert_hl7_batch_messages_to_list-95"><span class="linenos"> 95</span></a><span class="sd">    * BTS is &quot;Batch Trailer Segment,&quot; which defines the end of a batch</span>
</span><span id="convert_hl7_batch_messages_to_list-96"><a href="#convert_hl7_batch_messages_to_list-96"><span class="linenos"> 96</span></a>
</span><span id="convert_hl7_batch_messages_to_list-97"><a href="#convert_hl7_batch_messages_to_list-97"><span class="linenos"> 97</span></a><span class="sd">    The structure of an HL7 Batch looks like this:</span>
</span><span id="convert_hl7_batch_messages_to_list-98"><a href="#convert_hl7_batch_messages_to_list-98"><span class="linenos"> 98</span></a><span class="sd">    [FHS] (file header segment) { [BHS] (batch header segment)</span>
</span><span id="convert_hl7_batch_messages_to_list-99"><a href="#convert_hl7_batch_messages_to_list-99"><span class="linenos"> 99</span></a><span class="sd">    { [MSH (zero or more HL7 messages)</span>
</span><span id="convert_hl7_batch_messages_to_list-100"><a href="#convert_hl7_batch_messages_to_list-100"><span class="linenos">100</span></a><span class="sd">    ....</span>
</span><span id="convert_hl7_batch_messages_to_list-101"><a href="#convert_hl7_batch_messages_to_list-101"><span class="linenos">101</span></a><span class="sd">    ....</span>
</span><span id="convert_hl7_batch_messages_to_list-102"><a href="#convert_hl7_batch_messages_to_list-102"><span class="linenos">102</span></a><span class="sd">    ....</span>
</span><span id="convert_hl7_batch_messages_to_list-103"><a href="#convert_hl7_batch_messages_to_list-103"><span class="linenos">103</span></a><span class="sd">    ] }</span>
</span><span id="convert_hl7_batch_messages_to_list-104"><a href="#convert_hl7_batch_messages_to_list-104"><span class="linenos">104</span></a><span class="sd">    [BTS] (batch trailer segment)</span>
</span><span id="convert_hl7_batch_messages_to_list-105"><a href="#convert_hl7_batch_messages_to_list-105"><span class="linenos">105</span></a><span class="sd">    }</span>
</span><span id="convert_hl7_batch_messages_to_list-106"><a href="#convert_hl7_batch_messages_to_list-106"><span class="linenos">106</span></a><span class="sd">    [FTS] (file trailer segment)</span>
</span><span id="convert_hl7_batch_messages_to_list-107"><a href="#convert_hl7_batch_messages_to_list-107"><span class="linenos">107</span></a>
</span><span id="convert_hl7_batch_messages_to_list-108"><a href="#convert_hl7_batch_messages_to_list-108"><span class="linenos">108</span></a><span class="sd">    Ignores lines that start with these header/tail segments since we don&#39;t want to</span>
</span><span id="convert_hl7_batch_messages_to_list-109"><a href="#convert_hl7_batch_messages_to_list-109"><span class="linenos">109</span></a><span class="sd">    include them in a message.</span>
</span><span id="convert_hl7_batch_messages_to_list-110"><a href="#convert_hl7_batch_messages_to_list-110"><span class="linenos">110</span></a>
</span><span id="convert_hl7_batch_messages_to_list-111"><a href="#convert_hl7_batch_messages_to_list-111"><span class="linenos">111</span></a><span class="sd">    :param content: The batch content to turn into a list.</span>
</span><span id="convert_hl7_batch_messages_to_list-112"><a href="#convert_hl7_batch_messages_to_list-112"><span class="linenos">112</span></a><span class="sd">    :param delimiter: The character delimiting messages in the batch.</span>
</span><span id="convert_hl7_batch_messages_to_list-113"><a href="#convert_hl7_batch_messages_to_list-113"><span class="linenos">113</span></a><span class="sd">    :return: A list of separated, cleaned HL7 messages.</span>
</span><span id="convert_hl7_batch_messages_to_list-114"><a href="#convert_hl7_batch_messages_to_list-114"><span class="linenos">114</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-115"><a href="#convert_hl7_batch_messages_to_list-115"><span class="linenos">115</span></a>
</span><span id="convert_hl7_batch_messages_to_list-116"><a href="#convert_hl7_batch_messages_to_list-116"><span class="linenos">116</span></a>    <span class="n">cleaned_batch</span> <span class="o">=</span> <span class="n">_clean_hl7_batch</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="convert_hl7_batch_messages_to_list-117"><a href="#convert_hl7_batch_messages_to_list-117"><span class="linenos">117</span></a>    <span class="n">message_lines</span> <span class="o">=</span> <span class="n">cleaned_batch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
</span><span id="convert_hl7_batch_messages_to_list-118"><a href="#convert_hl7_batch_messages_to_list-118"><span class="linenos">118</span></a>    <span class="n">next_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-119"><a href="#convert_hl7_batch_messages_to_list-119"><span class="linenos">119</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_hl7_batch_messages_to_list-120"><a href="#convert_hl7_batch_messages_to_list-120"><span class="linenos">120</span></a>
</span><span id="convert_hl7_batch_messages_to_list-121"><a href="#convert_hl7_batch_messages_to_list-121"><span class="linenos">121</span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message_lines</span><span class="p">:</span>
</span><span id="convert_hl7_batch_messages_to_list-122"><a href="#convert_hl7_batch_messages_to_list-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;FHS&quot;</span><span class="p">,</span> <span class="s2">&quot;BHS&quot;</span><span class="p">,</span> <span class="s2">&quot;BTS&quot;</span><span class="p">,</span> <span class="s2">&quot;FTS&quot;</span><span class="p">)):</span>
</span><span id="convert_hl7_batch_messages_to_list-123"><a href="#convert_hl7_batch_messages_to_list-123"><span class="linenos">123</span></a>            <span class="k">continue</span>
</span><span id="convert_hl7_batch_messages_to_list-124"><a href="#convert_hl7_batch_messages_to_list-124"><span class="linenos">124</span></a>
</span><span id="convert_hl7_batch_messages_to_list-125"><a href="#convert_hl7_batch_messages_to_list-125"><span class="linenos">125</span></a>        <span class="c1"># If we reach a line that starts with MSH and we have</span>
</span><span id="convert_hl7_batch_messages_to_list-126"><a href="#convert_hl7_batch_messages_to_list-126"><span class="linenos">126</span></a>        <span class="c1"># content in nextMessage, then by definition we have</span>
</span><span id="convert_hl7_batch_messages_to_list-127"><a href="#convert_hl7_batch_messages_to_list-127"><span class="linenos">127</span></a>        <span class="c1"># a full message in next_message and need to append it</span>
</span><span id="convert_hl7_batch_messages_to_list-128"><a href="#convert_hl7_batch_messages_to_list-128"><span class="linenos">128</span></a>        <span class="c1"># to output. This will not trigger the first time we</span>
</span><span id="convert_hl7_batch_messages_to_list-129"><a href="#convert_hl7_batch_messages_to_list-129"><span class="linenos">129</span></a>        <span class="c1"># see a line with MSH since next_message will be empty</span>
</span><span id="convert_hl7_batch_messages_to_list-130"><a href="#convert_hl7_batch_messages_to_list-130"><span class="linenos">130</span></a>        <span class="c1"># at that time.</span>
</span><span id="convert_hl7_batch_messages_to_list-131"><a href="#convert_hl7_batch_messages_to_list-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">next_message</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MSH&quot;</span><span class="p">):</span>
</span><span id="convert_hl7_batch_messages_to_list-132"><a href="#convert_hl7_batch_messages_to_list-132"><span class="linenos">132</span></a>            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_message</span><span class="p">)</span>
</span><span id="convert_hl7_batch_messages_to_list-133"><a href="#convert_hl7_batch_messages_to_list-133"><span class="linenos">133</span></a>            <span class="n">next_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-134"><a href="#convert_hl7_batch_messages_to_list-134"><span class="linenos">134</span></a>
</span><span id="convert_hl7_batch_messages_to_list-135"><a href="#convert_hl7_batch_messages_to_list-135"><span class="linenos">135</span></a>        <span class="c1"># Otherwise, continue to add the line of text to next_message</span>
</span><span id="convert_hl7_batch_messages_to_list-136"><a href="#convert_hl7_batch_messages_to_list-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="convert_hl7_batch_messages_to_list-137"><a href="#convert_hl7_batch_messages_to_list-137"><span class="linenos">137</span></a>            <span class="n">next_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\r</span><span class="s2">&quot;</span>
</span><span id="convert_hl7_batch_messages_to_list-138"><a href="#convert_hl7_batch_messages_to_list-138"><span class="linenos">138</span></a>
</span><span id="convert_hl7_batch_messages_to_list-139"><a href="#convert_hl7_batch_messages_to_list-139"><span class="linenos">139</span></a>    <span class="c1"># Since our loop only adds messages to output when it finds</span>
</span><span id="convert_hl7_batch_messages_to_list-140"><a href="#convert_hl7_batch_messages_to_list-140"><span class="linenos">140</span></a>    <span class="c1"># a line that starts with MSH, the last message would never</span>
</span><span id="convert_hl7_batch_messages_to_list-141"><a href="#convert_hl7_batch_messages_to_list-141"><span class="linenos">141</span></a>    <span class="c1"># be added. So we explicitly add it here.</span>
</span><span id="convert_hl7_batch_messages_to_list-142"><a href="#convert_hl7_batch_messages_to_list-142"><span class="linenos">142</span></a>    <span class="k">if</span> <span class="n">next_message</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="convert_hl7_batch_messages_to_list-143"><a href="#convert_hl7_batch_messages_to_list-143"><span class="linenos">143</span></a>        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_message</span><span class="p">)</span>
</span><span id="convert_hl7_batch_messages_to_list-144"><a href="#convert_hl7_batch_messages_to_list-144"><span class="linenos">144</span></a>
</span><span id="convert_hl7_batch_messages_to_list-145"><a href="#convert_hl7_batch_messages_to_list-145"><span class="linenos">145</span></a>    <span class="k">return</span> <span class="n">output</span>
</span></pre></div>


            <div class="docstring"><p>Converts a batch file of messages into a list of strings
representing parts of the message. This function is based
on the following header/tail segments:</p>

<ul>
<li>FHS is a "File Header Segment," which is used to head a file
(group of batches)</li>
<li>FTS is a "File Trailer Segment," which defines the end of a file</li>
<li>BHS is "Batch Header Segment," which defines the start of a batch</li>
<li>BTS is "Batch Trailer Segment," which defines the end of a batch</li>
</ul>

<p>The structure of an HL7 Batch looks like this:
[FHS] (file header segment) { [BHS] (batch header segment)
{ [MSH (zero or more HL7 messages)
....
....
....
] }
[BTS] (batch trailer segment)
}
[FTS] (file trailer segment)</p>

<p>Ignores lines that start with these header/tail segments since we don't want to
include them in a message.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>content</strong>:  The batch content to turn into a list.</li>
<li><strong>delimiter</strong>:  The character delimiting messages in the batch.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of separated, cleaned HL7 messages.</p>
</blockquote>
</div>


                </section>
                <section id="standardize_country_code">
                            <input id="standardize_country_code-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_country_code</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">raw_country</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">code_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;alpha_2&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_3&#39;</span><span class="p">,</span> <span class="s1">&#39;numeric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;alpha_2&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="standardize_country_code-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_country_code"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_country_code-39"><a href="#standardize_country_code-39"><span class="linenos">39</span></a><span class="k">def</span> <span class="nf">standardize_country_code</span><span class="p">(</span>
</span><span id="standardize_country_code-40"><a href="#standardize_country_code-40"><span class="linenos">40</span></a>    <span class="n">raw_country</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;alpha_2&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_3&quot;</span><span class="p">,</span> <span class="s2">&quot;numeric&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;alpha_2&quot;</span>
</span><span id="standardize_country_code-41"><a href="#standardize_country_code-41"><span class="linenos">41</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="standardize_country_code-42"><a href="#standardize_country_code-42"><span class="linenos">42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_country_code-43"><a href="#standardize_country_code-43"><span class="linenos">43</span></a><span class="sd">    Identifies the country represented and generates the desired type of the ISO</span>
</span><span id="standardize_country_code-44"><a href="#standardize_country_code-44"><span class="linenos">44</span></a><span class="sd">    3611 standardized country identifier for a given string representation of a country</span>
</span><span id="standardize_country_code-45"><a href="#standardize_country_code-45"><span class="linenos">45</span></a><span class="sd">    (whether a full name such as &quot;United States,&quot; or an abbreviation such as &quot;US&quot;</span>
</span><span id="standardize_country_code-46"><a href="#standardize_country_code-46"><span class="linenos">46</span></a><span class="sd">    or &quot;USA&quot;). If the country identifier cannot be determined, returns None.</span>
</span><span id="standardize_country_code-47"><a href="#standardize_country_code-47"><span class="linenos">47</span></a>
</span><span id="standardize_country_code-48"><a href="#standardize_country_code-48"><span class="linenos">48</span></a><span class="sd">    Example: If raw_country = &quot;United States of America,&quot; then</span>
</span><span id="standardize_country_code-49"><a href="#standardize_country_code-49"><span class="linenos">49</span></a>
</span><span id="standardize_country_code-50"><a href="#standardize_country_code-50"><span class="linenos">50</span></a><span class="sd">    * alpha_2 would be &quot;US&quot;</span>
</span><span id="standardize_country_code-51"><a href="#standardize_country_code-51"><span class="linenos">51</span></a><span class="sd">    * alpha_3 would be &quot;USA&quot;</span>
</span><span id="standardize_country_code-52"><a href="#standardize_country_code-52"><span class="linenos">52</span></a><span class="sd">    * numeric would be &quot;840&quot;</span>
</span><span id="standardize_country_code-53"><a href="#standardize_country_code-53"><span class="linenos">53</span></a>
</span><span id="standardize_country_code-54"><a href="#standardize_country_code-54"><span class="linenos">54</span></a><span class="sd">    :param raw_country: The string representation of the country to be</span>
</span><span id="standardize_country_code-55"><a href="#standardize_country_code-55"><span class="linenos">55</span></a><span class="sd">      put in ISO 3611 standardized form.</span>
</span><span id="standardize_country_code-56"><a href="#standardize_country_code-56"><span class="linenos">56</span></a><span class="sd">    :param code_type: One of &#39;alpha_2&#39;, &#39;alpha_3&#39;, or &#39;numeric&#39;; the</span>
</span><span id="standardize_country_code-57"><a href="#standardize_country_code-57"><span class="linenos">57</span></a><span class="sd">      desired identifier type to generate.</span>
</span><span id="standardize_country_code-58"><a href="#standardize_country_code-58"><span class="linenos">58</span></a><span class="sd">    :return: The standardized country identifier found in the resource&#39;s addresses.</span>
</span><span id="standardize_country_code-59"><a href="#standardize_country_code-59"><span class="linenos">59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_country_code-60"><a href="#standardize_country_code-60"><span class="linenos">60</span></a>
</span><span id="standardize_country_code-61"><a href="#standardize_country_code-61"><span class="linenos">61</span></a>    <span class="c1"># @TODO: Potentially do some minor restructuring around this logic</span>
</span><span id="standardize_country_code-62"><a href="#standardize_country_code-62"><span class="linenos">62</span></a>    <span class="c1"># to make it shorter/clearer. A private helper was discussed, but</span>
</span><span id="standardize_country_code-63"><a href="#standardize_country_code-63"><span class="linenos">63</span></a>    <span class="c1"># prevailing consensus was that this logic is a guiding nice-to-have</span>
</span><span id="standardize_country_code-64"><a href="#standardize_country_code-64"><span class="linenos">64</span></a>    <span class="c1"># here, where it is, so we&#39;ll likely keep it. But this todo marks</span>
</span><span id="standardize_country_code-65"><a href="#standardize_country_code-65"><span class="linenos">65</span></a>    <span class="c1"># a revisit later around whether the logic can be restructuerd.</span>
</span><span id="standardize_country_code-66"><a href="#standardize_country_code-66"><span class="linenos">66</span></a>
</span><span id="standardize_country_code-67"><a href="#standardize_country_code-67"><span class="linenos">67</span></a>    <span class="c1"># First, identify what country the input is referencing</span>
</span><span id="standardize_country_code-68"><a href="#standardize_country_code-68"><span class="linenos">68</span></a>    <span class="n">standard</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="standardize_country_code-69"><a href="#standardize_country_code-69"><span class="linenos">69</span></a>    <span class="n">raw_country</span> <span class="o">=</span> <span class="n">raw_country</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="standardize_country_code-70"><a href="#standardize_country_code-70"><span class="linenos">70</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_country</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="standardize_country_code-71"><a href="#standardize_country_code-71"><span class="linenos">71</span></a>        <span class="n">standard</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_2</span><span class="o">=</span><span class="n">raw_country</span><span class="p">)</span>
</span><span id="standardize_country_code-72"><a href="#standardize_country_code-72"><span class="linenos">72</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_country</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="standardize_country_code-73"><a href="#standardize_country_code-73"><span class="linenos">73</span></a>        <span class="n">standard</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_3</span><span class="o">=</span><span class="n">raw_country</span><span class="p">)</span>
</span><span id="standardize_country_code-74"><a href="#standardize_country_code-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="n">standard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="standardize_country_code-75"><a href="#standardize_country_code-75"><span class="linenos">75</span></a>            <span class="n">standard</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">numeric</span><span class="o">=</span><span class="n">raw_country</span><span class="p">)</span>
</span><span id="standardize_country_code-76"><a href="#standardize_country_code-76"><span class="linenos">76</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_country</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="standardize_country_code-77"><a href="#standardize_country_code-77"><span class="linenos">77</span></a>        <span class="n">standard</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">raw_country</span><span class="p">)</span>
</span><span id="standardize_country_code-78"><a href="#standardize_country_code-78"><span class="linenos">78</span></a>        <span class="k">if</span> <span class="n">standard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="standardize_country_code-79"><a href="#standardize_country_code-79"><span class="linenos">79</span></a>            <span class="n">standard</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">official_name</span><span class="o">=</span><span class="n">raw_country</span><span class="p">)</span>
</span><span id="standardize_country_code-80"><a href="#standardize_country_code-80"><span class="linenos">80</span></a>
</span><span id="standardize_country_code-81"><a href="#standardize_country_code-81"><span class="linenos">81</span></a>    <span class="c1"># Then, if we figured that out, convert it to desired form</span>
</span><span id="standardize_country_code-82"><a href="#standardize_country_code-82"><span class="linenos">82</span></a>    <span class="k">if</span> <span class="n">standard</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="standardize_country_code-83"><a href="#standardize_country_code-83"><span class="linenos">83</span></a>        <span class="k">if</span> <span class="n">code_type</span> <span class="o">==</span> <span class="s2">&quot;alpha_2&quot;</span><span class="p">:</span>
</span><span id="standardize_country_code-84"><a href="#standardize_country_code-84"><span class="linenos">84</span></a>            <span class="n">standard</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">alpha_2</span>
</span><span id="standardize_country_code-85"><a href="#standardize_country_code-85"><span class="linenos">85</span></a>        <span class="k">elif</span> <span class="n">code_type</span> <span class="o">==</span> <span class="s2">&quot;alpha_3&quot;</span><span class="p">:</span>
</span><span id="standardize_country_code-86"><a href="#standardize_country_code-86"><span class="linenos">86</span></a>            <span class="n">standard</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">alpha_3</span>
</span><span id="standardize_country_code-87"><a href="#standardize_country_code-87"><span class="linenos">87</span></a>        <span class="k">elif</span> <span class="n">code_type</span> <span class="o">==</span> <span class="s2">&quot;numeric&quot;</span><span class="p">:</span>
</span><span id="standardize_country_code-88"><a href="#standardize_country_code-88"><span class="linenos">88</span></a>            <span class="n">standard</span> <span class="o">=</span> <span class="n">standard</span><span class="o">.</span><span class="n">numeric</span>
</span><span id="standardize_country_code-89"><a href="#standardize_country_code-89"><span class="linenos">89</span></a>
</span><span id="standardize_country_code-90"><a href="#standardize_country_code-90"><span class="linenos">90</span></a>    <span class="k">return</span> <span class="n">standard</span>
</span></pre></div>


            <div class="docstring"><p>Identifies the country represented and generates the desired type of the ISO
3611 standardized country identifier for a given string representation of a country
(whether a full name such as "United States," or an abbreviation such as "US"
or "USA"). If the country identifier cannot be determined, returns None.</p>

<p>Example: If raw_country = "United States of America," then</p>

<ul>
<li>alpha_2 would be "US"</li>
<li>alpha_3 would be "USA"</li>
<li>numeric would be "840"</li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>raw_country</strong>:  The string representation of the country to be
put in ISO 3611 standardized form.</li>
<li><strong>code_type</strong>:  One of 'alpha_2', 'alpha_3', or 'numeric'; the
desired identifier type to generate.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The standardized country identifier found in the resource's addresses.</p>
</blockquote>
</div>


                </section>
                <section id="standardize_phone">
                            <input id="standardize_phone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_phone</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">raw_phone</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">countries</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="standardize_phone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_phone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_phone-93"><a href="#standardize_phone-93"><span class="linenos"> 93</span></a><span class="k">def</span> <span class="nf">standardize_phone</span><span class="p">(</span>
</span><span id="standardize_phone-94"><a href="#standardize_phone-94"><span class="linenos"> 94</span></a>    <span class="n">raw_phone</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">countries</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;US&quot;</span><span class="p">]</span>
</span><span id="standardize_phone-95"><a href="#standardize_phone-95"><span class="linenos"> 95</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="standardize_phone-96"><a href="#standardize_phone-96"><span class="linenos"> 96</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_phone-97"><a href="#standardize_phone-97"><span class="linenos"> 97</span></a><span class="sd">    Parses phone number and generates its standardized ISO E.164 international format</span>
</span><span id="standardize_phone-98"><a href="#standardize_phone-98"><span class="linenos"> 98</span></a><span class="sd">    for each given phone number and optional list of associated countries. If an input</span>
</span><span id="standardize_phone-99"><a href="#standardize_phone-99"><span class="linenos"> 99</span></a><span class="sd">    phone number can&#39;t be parsed, that number returns the empty string. Attempts</span>
</span><span id="standardize_phone-100"><a href="#standardize_phone-100"><span class="linenos">100</span></a><span class="sd">    to parse the inputs using the first successful strategy out of the following:</span>
</span><span id="standardize_phone-101"><a href="#standardize_phone-101"><span class="linenos">101</span></a>
</span><span id="standardize_phone-102"><a href="#standardize_phone-102"><span class="linenos">102</span></a><span class="sd">    1. parses the phone number on its own</span>
</span><span id="standardize_phone-103"><a href="#standardize_phone-103"><span class="linenos">103</span></a><span class="sd">    2. parses the phone number using the provided list of possible</span>
</span><span id="standardize_phone-104"><a href="#standardize_phone-104"><span class="linenos">104</span></a><span class="sd">       associated countries</span>
</span><span id="standardize_phone-105"><a href="#standardize_phone-105"><span class="linenos">105</span></a><span class="sd">    3. parses the phone number using the US as country</span>
</span><span id="standardize_phone-106"><a href="#standardize_phone-106"><span class="linenos">106</span></a>
</span><span id="standardize_phone-107"><a href="#standardize_phone-107"><span class="linenos">107</span></a><span class="sd">    :param raw_phone: One or more raw phone number(s) to standardize.</span>
</span><span id="standardize_phone-108"><a href="#standardize_phone-108"><span class="linenos">108</span></a><span class="sd">    :param countries: An optional list containing 2 letter ISO codes</span>
</span><span id="standardize_phone-109"><a href="#standardize_phone-109"><span class="linenos">109</span></a><span class="sd">      associated with the phone numbers, signifying to which countries</span>
</span><span id="standardize_phone-110"><a href="#standardize_phone-110"><span class="linenos">110</span></a><span class="sd">      the phone numbers might belong.</span>
</span><span id="standardize_phone-111"><a href="#standardize_phone-111"><span class="linenos">111</span></a><span class="sd">    :return: Either a string or a list of strings, depending on the</span>
</span><span id="standardize_phone-112"><a href="#standardize_phone-112"><span class="linenos">112</span></a><span class="sd">      input of raw_phone, holding the standardized phone number(s).</span>
</span><span id="standardize_phone-113"><a href="#standardize_phone-113"><span class="linenos">113</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_phone-114"><a href="#standardize_phone-114"><span class="linenos">114</span></a>
</span><span id="standardize_phone-115"><a href="#standardize_phone-115"><span class="linenos">115</span></a>    <span class="c1"># Base cases: we always want to try the phone # on its own first;</span>
</span><span id="standardize_phone-116"><a href="#standardize_phone-116"><span class="linenos">116</span></a>    <span class="c1"># we also want to try the phone # with the US if all else fails</span>
</span><span id="standardize_phone-117"><a href="#standardize_phone-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
</span><span id="standardize_phone-118"><a href="#standardize_phone-118"><span class="linenos">118</span></a>        <span class="n">countries</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="standardize_phone-119"><a href="#standardize_phone-119"><span class="linenos">119</span></a>    <span class="k">if</span> <span class="s2">&quot;US&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
</span><span id="standardize_phone-120"><a href="#standardize_phone-120"><span class="linenos">120</span></a>        <span class="n">countries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;US&quot;</span><span class="p">)</span>
</span><span id="standardize_phone-121"><a href="#standardize_phone-121"><span class="linenos">121</span></a>
</span><span id="standardize_phone-122"><a href="#standardize_phone-122"><span class="linenos">122</span></a>    <span class="n">phones_to_clean</span> <span class="o">=</span> <span class="n">raw_phone</span>
</span><span id="standardize_phone-123"><a href="#standardize_phone-123"><span class="linenos">123</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_phone</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="standardize_phone-124"><a href="#standardize_phone-124"><span class="linenos">124</span></a>        <span class="n">phones_to_clean</span> <span class="o">=</span> <span class="p">[</span><span class="n">raw_phone</span><span class="p">]</span>
</span><span id="standardize_phone-125"><a href="#standardize_phone-125"><span class="linenos">125</span></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="standardize_phone-126"><a href="#standardize_phone-126"><span class="linenos">126</span></a>
</span><span id="standardize_phone-127"><a href="#standardize_phone-127"><span class="linenos">127</span></a>    <span class="k">for</span> <span class="n">phone</span> <span class="ow">in</span> <span class="n">phones_to_clean</span><span class="p">:</span>
</span><span id="standardize_phone-128"><a href="#standardize_phone-128"><span class="linenos">128</span></a>        <span class="n">standardized</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="standardize_phone-129"><a href="#standardize_phone-129"><span class="linenos">129</span></a>        <span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
</span><span id="standardize_phone-130"><a href="#standardize_phone-130"><span class="linenos">130</span></a>            <span class="c1"># We were able to pull the phone # and corresponding country</span>
</span><span id="standardize_phone-131"><a href="#standardize_phone-131"><span class="linenos">131</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="standardize_phone-132"><a href="#standardize_phone-132"><span class="linenos">132</span></a>                <span class="n">standardized</span> <span class="o">=</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">phone</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
</span><span id="standardize_phone-133"><a href="#standardize_phone-133"><span class="linenos">133</span></a>                <span class="k">break</span>
</span><span id="standardize_phone-134"><a href="#standardize_phone-134"><span class="linenos">134</span></a>
</span><span id="standardize_phone-135"><a href="#standardize_phone-135"><span class="linenos">135</span></a>            <span class="c1"># This combo of given phone # and country isn&#39;t valid</span>
</span><span id="standardize_phone-136"><a href="#standardize_phone-136"><span class="linenos">136</span></a>            <span class="k">except</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">phonenumberutil</span><span class="o">.</span><span class="n">NumberParseException</span><span class="p">:</span>
</span><span id="standardize_phone-137"><a href="#standardize_phone-137"><span class="linenos">137</span></a>                <span class="k">continue</span>
</span><span id="standardize_phone-138"><a href="#standardize_phone-138"><span class="linenos">138</span></a>
</span><span id="standardize_phone-139"><a href="#standardize_phone-139"><span class="linenos">139</span></a>        <span class="c1"># If we got a match, format it according to ISO standards</span>
</span><span id="standardize_phone-140"><a href="#standardize_phone-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">standardized</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">is_possible_number</span><span class="p">(</span><span class="n">standardized</span><span class="p">):</span>
</span><span id="standardize_phone-141"><a href="#standardize_phone-141"><span class="linenos">141</span></a>            <span class="n">standardized</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="standardize_phone-142"><a href="#standardize_phone-142"><span class="linenos">142</span></a>                <span class="n">phonenumbers</span><span class="o">.</span><span class="n">format_number</span><span class="p">(</span>
</span><span id="standardize_phone-143"><a href="#standardize_phone-143"><span class="linenos">143</span></a>                    <span class="n">standardized</span><span class="p">,</span> <span class="n">phonenumbers</span><span class="o">.</span><span class="n">PhoneNumberFormat</span><span class="o">.</span><span class="n">E164</span>
</span><span id="standardize_phone-144"><a href="#standardize_phone-144"><span class="linenos">144</span></a>                <span class="p">)</span>
</span><span id="standardize_phone-145"><a href="#standardize_phone-145"><span class="linenos">145</span></a>            <span class="p">)</span>
</span><span id="standardize_phone-146"><a href="#standardize_phone-146"><span class="linenos">146</span></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">standardized</span><span class="p">)</span>
</span><span id="standardize_phone-147"><a href="#standardize_phone-147"><span class="linenos">147</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="standardize_phone-148"><a href="#standardize_phone-148"><span class="linenos">148</span></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="standardize_phone-149"><a href="#standardize_phone-149"><span class="linenos">149</span></a>
</span><span id="standardize_phone-150"><a href="#standardize_phone-150"><span class="linenos">150</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_phone</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="standardize_phone-151"><a href="#standardize_phone-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="standardize_phone-152"><a href="#standardize_phone-152"><span class="linenos">152</span></a>    <span class="k">return</span> <span class="n">outputs</span>
</span></pre></div>


            <div class="docstring"><p>Parses phone number and generates its standardized ISO E.164 international format
for each given phone number and optional list of associated countries. If an input
phone number can't be parsed, that number returns the empty string. Attempts
to parse the inputs using the first successful strategy out of the following:</p>

<ol>
<li>parses the phone number on its own</li>
<li>parses the phone number using the provided list of possible
associated countries</li>
<li>parses the phone number using the US as country</li>
</ol>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>raw_phone</strong>:  One or more raw phone number(s) to standardize.</li>
<li><strong>countries</strong>:  An optional list containing 2 letter ISO codes
associated with the phone numbers, signifying to which countries
the phone numbers might belong.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Either a string or a list of strings, depending on the
    input of raw_phone, holding the standardized phone number(s).</p>
</blockquote>
</div>


                </section>
                <section id="standardize_name">
                            <input id="standardize_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_name</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">raw_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">trim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">case</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;upper&#39;</span>,</span><span class="param">	<span class="n">remove_numbers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="standardize_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_name-155"><a href="#standardize_name-155"><span class="linenos">155</span></a><span class="k">def</span> <span class="nf">standardize_name</span><span class="p">(</span>
</span><span id="standardize_name-156"><a href="#standardize_name-156"><span class="linenos">156</span></a>    <span class="n">raw_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span id="standardize_name-157"><a href="#standardize_name-157"><span class="linenos">157</span></a>    <span class="n">trim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="standardize_name-158"><a href="#standardize_name-158"><span class="linenos">158</span></a>    <span class="n">case</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span>
</span><span id="standardize_name-159"><a href="#standardize_name-159"><span class="linenos">159</span></a>    <span class="n">remove_numbers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="standardize_name-160"><a href="#standardize_name-160"><span class="linenos">160</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="standardize_name-161"><a href="#standardize_name-161"><span class="linenos">161</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_name-162"><a href="#standardize_name-162"><span class="linenos">162</span></a><span class="sd">    Performs basic standardization (described below) on each given name. Removes</span>
</span><span id="standardize_name-163"><a href="#standardize_name-163"><span class="linenos">163</span></a><span class="sd">    punctuation characters and performs a variety of additional cleaning operations.</span>
</span><span id="standardize_name-164"><a href="#standardize_name-164"><span class="linenos">164</span></a><span class="sd">    Other options can be toggled on or off using the relevant parameter.</span>
</span><span id="standardize_name-165"><a href="#standardize_name-165"><span class="linenos">165</span></a>
</span><span id="standardize_name-166"><a href="#standardize_name-166"><span class="linenos">166</span></a><span class="sd">    All options specified will be applied uniformly to each input name,</span>
</span><span id="standardize_name-167"><a href="#standardize_name-167"><span class="linenos">167</span></a><span class="sd">    i.e., specifying case = &quot;lower&quot; will make all given names lower case.</span>
</span><span id="standardize_name-168"><a href="#standardize_name-168"><span class="linenos">168</span></a>
</span><span id="standardize_name-169"><a href="#standardize_name-169"><span class="linenos">169</span></a><span class="sd">    :param raw_name: Either a single string name or a list of strings,</span>
</span><span id="standardize_name-170"><a href="#standardize_name-170"><span class="linenos">170</span></a><span class="sd">      each representing a name.</span>
</span><span id="standardize_name-171"><a href="#standardize_name-171"><span class="linenos">171</span></a><span class="sd">    :param trim: If true, strips leading/trailing whitespace;</span>
</span><span id="standardize_name-172"><a href="#standardize_name-172"><span class="linenos">172</span></a><span class="sd">      if false, retains whitespace. Default: `True`</span>
</span><span id="standardize_name-173"><a href="#standardize_name-173"><span class="linenos">173</span></a><span class="sd">    :param case: What case to enforce on each name.</span>
</span><span id="standardize_name-174"><a href="#standardize_name-174"><span class="linenos">174</span></a>
</span><span id="standardize_name-175"><a href="#standardize_name-175"><span class="linenos">175</span></a><span class="sd">      * `upper`: All upper case</span>
</span><span id="standardize_name-176"><a href="#standardize_name-176"><span class="linenos">176</span></a><span class="sd">      * `lower`: All lower case</span>
</span><span id="standardize_name-177"><a href="#standardize_name-177"><span class="linenos">177</span></a><span class="sd">      * `title`: Title case</span>
</span><span id="standardize_name-178"><a href="#standardize_name-178"><span class="linenos">178</span></a>
</span><span id="standardize_name-179"><a href="#standardize_name-179"><span class="linenos">179</span></a><span class="sd">      Default: `upper`</span>
</span><span id="standardize_name-180"><a href="#standardize_name-180"><span class="linenos">180</span></a><span class="sd">    :remove_numbers: If true, removes numeric characters from inputs;</span>
</span><span id="standardize_name-181"><a href="#standardize_name-181"><span class="linenos">181</span></a><span class="sd">      if false, retains numeric characters. Default `True`</span>
</span><span id="standardize_name-182"><a href="#standardize_name-182"><span class="linenos">182</span></a><span class="sd">    :return: Either a string or a list of strings, depending on the</span>
</span><span id="standardize_name-183"><a href="#standardize_name-183"><span class="linenos">183</span></a><span class="sd">      input of raw_name, holding the cleaned name(s).</span>
</span><span id="standardize_name-184"><a href="#standardize_name-184"><span class="linenos">184</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_name-185"><a href="#standardize_name-185"><span class="linenos">185</span></a>    <span class="n">names_to_clean</span> <span class="o">=</span> <span class="n">raw_name</span>
</span><span id="standardize_name-186"><a href="#standardize_name-186"><span class="linenos">186</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="standardize_name-187"><a href="#standardize_name-187"><span class="linenos">187</span></a>        <span class="n">names_to_clean</span> <span class="o">=</span> <span class="p">[</span><span class="n">raw_name</span><span class="p">]</span>
</span><span id="standardize_name-188"><a href="#standardize_name-188"><span class="linenos">188</span></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="standardize_name-189"><a href="#standardize_name-189"><span class="linenos">189</span></a>
</span><span id="standardize_name-190"><a href="#standardize_name-190"><span class="linenos">190</span></a>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names_to_clean</span><span class="p">:</span>
</span><span id="standardize_name-191"><a href="#standardize_name-191"><span class="linenos">191</span></a>        <span class="c1"># Remove all punctuation</span>
</span><span id="standardize_name-192"><a href="#standardize_name-192"><span class="linenos">192</span></a>        <span class="n">cleaned_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ltr</span> <span class="k">for</span> <span class="n">ltr</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">if</span> <span class="n">ltr</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">ltr</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">])</span>
</span><span id="standardize_name-193"><a href="#standardize_name-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="n">remove_numbers</span><span class="p">:</span>
</span><span id="standardize_name-194"><a href="#standardize_name-194"><span class="linenos">194</span></a>            <span class="n">cleaned_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ltr</span> <span class="k">for</span> <span class="n">ltr</span> <span class="ow">in</span> <span class="n">cleaned_name</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ltr</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()])</span>
</span><span id="standardize_name-195"><a href="#standardize_name-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">trim</span><span class="p">:</span>
</span><span id="standardize_name-196"><a href="#standardize_name-196"><span class="linenos">196</span></a>            <span class="n">cleaned_name</span> <span class="o">=</span> <span class="n">cleaned_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="standardize_name-197"><a href="#standardize_name-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span>
</span><span id="standardize_name-198"><a href="#standardize_name-198"><span class="linenos">198</span></a>            <span class="n">cleaned_name</span> <span class="o">=</span> <span class="n">cleaned_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="standardize_name-199"><a href="#standardize_name-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
</span><span id="standardize_name-200"><a href="#standardize_name-200"><span class="linenos">200</span></a>            <span class="n">cleaned_name</span> <span class="o">=</span> <span class="n">cleaned_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="standardize_name-201"><a href="#standardize_name-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span>
</span><span id="standardize_name-202"><a href="#standardize_name-202"><span class="linenos">202</span></a>            <span class="n">cleaned_name</span> <span class="o">=</span> <span class="n">cleaned_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</span><span id="standardize_name-203"><a href="#standardize_name-203"><span class="linenos">203</span></a>        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleaned_name</span><span class="p">)</span>
</span><span id="standardize_name-204"><a href="#standardize_name-204"><span class="linenos">204</span></a>
</span><span id="standardize_name-205"><a href="#standardize_name-205"><span class="linenos">205</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="standardize_name-206"><a href="#standardize_name-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="standardize_name-207"><a href="#standardize_name-207"><span class="linenos">207</span></a>    <span class="k">return</span> <span class="n">outputs</span>
</span></pre></div>


            <div class="docstring"><p>Performs basic standardization (described below) on each given name. Removes
punctuation characters and performs a variety of additional cleaning operations.
Other options can be toggled on or off using the relevant parameter.</p>

<p>All options specified will be applied uniformly to each input name,
i.e., specifying case = "lower" will make all given names lower case.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>raw_name</strong>:  Either a single string name or a list of strings,
each representing a name.</li>
<li><strong>trim</strong>:  If true, strips leading/trailing whitespace;
if false, retains whitespace. Default: <code>True</code></li>
<li><p><strong>case</strong>:  What case to enforce on each name.</p>

<ul>
<li><code>upper</code>: All upper case</li>
<li><code>lower</code>: All lower case</li>
<li><code>title</code>: Title case</li>
</ul>

<p>Default: <code>upper</code>
:remove_numbers: If true, removes numeric characters from inputs;
if false, retains numeric characters. Default <code>True</code></p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Either a string or a list of strings, depending on the
    input of raw_name, holding the cleaned name(s).</p>
</blockquote>
</div>


                </section>
                <section id="double_metaphone_string">
                            <input id="double_metaphone_string-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">double_metaphone_string</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">string</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">dmeta</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="double_metaphone_string-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#double_metaphone_string"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="double_metaphone_string-19"><a href="#double_metaphone_string-19"><span class="linenos">19</span></a><span class="k">def</span> <span class="nf">double_metaphone_string</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dmeta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
</span><span id="double_metaphone_string-20"><a href="#double_metaphone_string-20"><span class="linenos">20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="double_metaphone_string-21"><a href="#double_metaphone_string-21"><span class="linenos">21</span></a><span class="sd">    Performs the double metaphone phonetic encoding algorithm on the given</span>
</span><span id="double_metaphone_string-22"><a href="#double_metaphone_string-22"><span class="linenos">22</span></a><span class="sd">    string. Returns a list holding the primary and secondary phonetic</span>
</span><span id="double_metaphone_string-23"><a href="#double_metaphone_string-23"><span class="linenos">23</span></a><span class="sd">    representations of the string (including None if there is no valid</span>
</span><span id="double_metaphone_string-24"><a href="#double_metaphone_string-24"><span class="linenos">24</span></a><span class="sd">    secondary encoding). This function expects basic text cleaning (e.g.</span>
</span><span id="double_metaphone_string-25"><a href="#double_metaphone_string-25"><span class="linenos">25</span></a><span class="sd">    removal of numeric characters, trimming of spaces, etc.) to already</span>
</span><span id="double_metaphone_string-26"><a href="#double_metaphone_string-26"><span class="linenos">26</span></a><span class="sd">    have been performed.</span>
</span><span id="double_metaphone_string-27"><a href="#double_metaphone_string-27"><span class="linenos">27</span></a>
</span><span id="double_metaphone_string-28"><a href="#double_metaphone_string-28"><span class="linenos">28</span></a><span class="sd">    :param string: The string to phonetically encode.</span>
</span><span id="double_metaphone_string-29"><a href="#double_metaphone_string-29"><span class="linenos">29</span></a><span class="sd">    :param dmeta: An optional existing double metaphone object, in the case</span>
</span><span id="double_metaphone_string-30"><a href="#double_metaphone_string-30"><span class="linenos">30</span></a><span class="sd">      one has already been instantiated for bulk processing.</span>
</span><span id="double_metaphone_string-31"><a href="#double_metaphone_string-31"><span class="linenos">31</span></a><span class="sd">    :return: A list of the primary and secondary encodings of the given</span>
</span><span id="double_metaphone_string-32"><a href="#double_metaphone_string-32"><span class="linenos">32</span></a><span class="sd">      string.</span>
</span><span id="double_metaphone_string-33"><a href="#double_metaphone_string-33"><span class="linenos">33</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="double_metaphone_string-34"><a href="#double_metaphone_string-34"><span class="linenos">34</span></a>    <span class="k">if</span> <span class="n">dmeta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="double_metaphone_string-35"><a href="#double_metaphone_string-35"><span class="linenos">35</span></a>        <span class="n">dmeta</span> <span class="o">=</span> <span class="n">DoubleMetaphone</span><span class="p">()</span>
</span><span id="double_metaphone_string-36"><a href="#double_metaphone_string-36"><span class="linenos">36</span></a>    <span class="k">return</span> <span class="n">dmeta</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the double metaphone phonetic encoding algorithm on the given
string. Returns a list holding the primary and secondary phonetic
representations of the string (including None if there is no valid
secondary encoding). This function expects basic text cleaning (e.g.
removal of numeric characters, trimming of spaces, etc.) to already
have been performed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>string</strong>:  The string to phonetically encode.</li>
<li><strong>dmeta</strong>:  An optional existing double metaphone object, in the case
one has already been instantiated for bulk processing.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A list of the primary and secondary encodings of the given
    string.</p>
</blockquote>
</div>


                </section>
                <section id="compare_strings">
                            <input id="compare_strings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compare_strings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">string1</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">string2</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">similarity_measure</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;JaroWinkler&#39;</span><span class="p">,</span> <span class="s1">&#39;Levenshtein&#39;</span><span class="p">,</span> <span class="s1">&#39;DamerauLevenshtein&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JaroWinkler&#39;</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="compare_strings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compare_strings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compare_strings-7"><a href="#compare_strings-7"><span class="linenos"> 7</span></a><span class="k">def</span> <span class="nf">compare_strings</span><span class="p">(</span>
</span><span id="compare_strings-8"><a href="#compare_strings-8"><span class="linenos"> 8</span></a>    <span class="n">string1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="compare_strings-9"><a href="#compare_strings-9"><span class="linenos"> 9</span></a>    <span class="n">string2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="compare_strings-10"><a href="#compare_strings-10"><span class="linenos">10</span></a>    <span class="n">similarity_measure</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="compare_strings-11"><a href="#compare_strings-11"><span class="linenos">11</span></a>        <span class="s2">&quot;JaroWinkler&quot;</span><span class="p">,</span> <span class="s2">&quot;Levenshtein&quot;</span><span class="p">,</span> <span class="s2">&quot;DamerauLevenshtein&quot;</span>
</span><span id="compare_strings-12"><a href="#compare_strings-12"><span class="linenos">12</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;JaroWinkler&quot;</span><span class="p">,</span>
</span><span id="compare_strings-13"><a href="#compare_strings-13"><span class="linenos">13</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="compare_strings-14"><a href="#compare_strings-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="compare_strings-15"><a href="#compare_strings-15"><span class="linenos">15</span></a><span class="sd">    Returns the normalized similarity measure between string1 and string2, as</span>
</span><span id="compare_strings-16"><a href="#compare_strings-16"><span class="linenos">16</span></a><span class="sd">    determined by the similarlity measure. The higher the normalized similarity measure</span>
</span><span id="compare_strings-17"><a href="#compare_strings-17"><span class="linenos">17</span></a><span class="sd">    (up to 1.0), the more similar string1 and string2 are. A normalized similarity</span>
</span><span id="compare_strings-18"><a href="#compare_strings-18"><span class="linenos">18</span></a><span class="sd">    measure of 0.0 means string1 and string 2 are not at all similar. This function</span>
</span><span id="compare_strings-19"><a href="#compare_strings-19"><span class="linenos">19</span></a><span class="sd">    expects basic text cleaning (e.g. removal of numeric characters, trimming of spaces,</span>
</span><span id="compare_strings-20"><a href="#compare_strings-20"><span class="linenos">20</span></a><span class="sd">    etc.) to already have been performed on the input strings.</span>
</span><span id="compare_strings-21"><a href="#compare_strings-21"><span class="linenos">21</span></a>
</span><span id="compare_strings-22"><a href="#compare_strings-22"><span class="linenos">22</span></a><span class="sd">    :param string1: First string for comparison.</span>
</span><span id="compare_strings-23"><a href="#compare_strings-23"><span class="linenos">23</span></a><span class="sd">    :param string2: Second string for comparison.</span>
</span><span id="compare_strings-24"><a href="#compare_strings-24"><span class="linenos">24</span></a><span class="sd">    :param similarity_measure: The method used to measure the similarity between two</span>
</span><span id="compare_strings-25"><a href="#compare_strings-25"><span class="linenos">25</span></a><span class="sd">        strings, defaults to &quot;JaroWinkler&quot;.</span>
</span><span id="compare_strings-26"><a href="#compare_strings-26"><span class="linenos">26</span></a><span class="sd">     - JaroWinkler: a ratio of matching characters and transpositions needed to</span>
</span><span id="compare_strings-27"><a href="#compare_strings-27"><span class="linenos">27</span></a><span class="sd">        transform string1 into string2.</span>
</span><span id="compare_strings-28"><a href="#compare_strings-28"><span class="linenos">28</span></a><span class="sd">     - Levenshtein: the number of edits (excluding transpositions) needed to transform</span>
</span><span id="compare_strings-29"><a href="#compare_strings-29"><span class="linenos">29</span></a><span class="sd">        string1 into string2.</span>
</span><span id="compare_strings-30"><a href="#compare_strings-30"><span class="linenos">30</span></a><span class="sd">     - DamerauLevenshtein: the number of edits (including transpositions) needed to</span>
</span><span id="compare_strings-31"><a href="#compare_strings-31"><span class="linenos">31</span></a><span class="sd">        transform string1 into string2.</span>
</span><span id="compare_strings-32"><a href="#compare_strings-32"><span class="linenos">32</span></a><span class="sd">    :return: The normalized similarity between string1 and string2, with 0 representing</span>
</span><span id="compare_strings-33"><a href="#compare_strings-33"><span class="linenos">33</span></a><span class="sd">        no similarity between string1 and string2, and 1 meaning string1 and string2 are</span>
</span><span id="compare_strings-34"><a href="#compare_strings-34"><span class="linenos">34</span></a><span class="sd">        dentical words.</span>
</span><span id="compare_strings-35"><a href="#compare_strings-35"><span class="linenos">35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compare_strings-36"><a href="#compare_strings-36"><span class="linenos">36</span></a>    <span class="k">if</span> <span class="n">similarity_measure</span> <span class="o">==</span> <span class="s2">&quot;JaroWinkler&quot;</span><span class="p">:</span>
</span><span id="compare_strings-37"><a href="#compare_strings-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="n">rapidfuzz</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">JaroWinkler</span><span class="o">.</span><span class="n">normalized_similarity</span><span class="p">(</span><span class="n">string1</span><span class="p">,</span> <span class="n">string2</span><span class="p">)</span>
</span><span id="compare_strings-38"><a href="#compare_strings-38"><span class="linenos">38</span></a>    <span class="k">elif</span> <span class="n">similarity_measure</span> <span class="o">==</span> <span class="s2">&quot;Levenshtein&quot;</span><span class="p">:</span>
</span><span id="compare_strings-39"><a href="#compare_strings-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="n">rapidfuzz</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">Levenshtein</span><span class="o">.</span><span class="n">normalized_similarity</span><span class="p">(</span><span class="n">string1</span><span class="p">,</span> <span class="n">string2</span><span class="p">)</span>
</span><span id="compare_strings-40"><a href="#compare_strings-40"><span class="linenos">40</span></a>    <span class="k">elif</span> <span class="n">similarity_measure</span> <span class="o">==</span> <span class="s2">&quot;DamerauLevenshtein&quot;</span><span class="p">:</span>
</span><span id="compare_strings-41"><a href="#compare_strings-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="n">rapidfuzz</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">DamerauLevenshtein</span><span class="o">.</span><span class="n">normalized_similarity</span><span class="p">(</span>
</span><span id="compare_strings-42"><a href="#compare_strings-42"><span class="linenos">42</span></a>            <span class="n">string1</span><span class="p">,</span> <span class="n">string2</span>
</span><span id="compare_strings-43"><a href="#compare_strings-43"><span class="linenos">43</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the normalized similarity measure between string1 and string2, as
determined by the similarlity measure. The higher the normalized similarity measure
(up to 1.0), the more similar string1 and string2 are. A normalized similarity
measure of 0.0 means string1 and string 2 are not at all similar. This function
expects basic text cleaning (e.g. removal of numeric characters, trimming of spaces,
etc.) to already have been performed on the input strings.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>string1</strong>:  First string for comparison.</li>
<li><strong>string2</strong>:  Second string for comparison.</li>
<li><strong>similarity_measure</strong>:  The method used to measure the similarity between two
strings, defaults to "JaroWinkler".</li>
<li>JaroWinkler: a ratio of matching characters and transpositions needed to
transform string1 into string2.</li>
<li>Levenshtein: the number of edits (excluding transpositions) needed to transform
string1 into string2.</li>
<li>DamerauLevenshtein: the number of edits (including transpositions) needed to
transform string1 into string2.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The normalized similarity between string1 and string2, with 0 representing
      no similarity between string1 and string2, and 1 meaning string1 and string2 are
      dentical words.</p>
</blockquote>
</div>


                </section>
                <section id="DoubleMetaphone">
                            <input id="DoubleMetaphone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DoubleMetaphone</span>:

                <label class="view-source-button" for="DoubleMetaphone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone-23"><a href="#DoubleMetaphone-23"><span class="linenos"> 23</span></a><span class="k">class</span> <span class="nc">DoubleMetaphone</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="DoubleMetaphone-24"><a href="#DoubleMetaphone-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DoubleMetaphone-25"><a href="#DoubleMetaphone-25"><span class="linenos"> 25</span></a><span class="sd">    A Double Metaphone parsing object capable of performing the double</span>
</span><span id="DoubleMetaphone-26"><a href="#DoubleMetaphone-26"><span class="linenos"> 26</span></a><span class="sd">    coding algorithm on a given input string.</span>
</span><span id="DoubleMetaphone-27"><a href="#DoubleMetaphone-27"><span class="linenos"> 27</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DoubleMetaphone-28"><a href="#DoubleMetaphone-28"><span class="linenos"> 28</span></a>
</span><span id="DoubleMetaphone-29"><a href="#DoubleMetaphone-29"><span class="linenos"> 29</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-30"><a href="#DoubleMetaphone-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DoubleMetaphone-31"><a href="#DoubleMetaphone-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone-32"><a href="#DoubleMetaphone-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone-33"><a href="#DoubleMetaphone-33"><span class="linenos"> 33</span></a>        <span class="c1"># next is set to a tuple of the next characters in the primary and</span>
</span><span id="DoubleMetaphone-34"><a href="#DoubleMetaphone-34"><span class="linenos"> 34</span></a>        <span class="c1"># secondary codes and to indicate how many characters to move forward</span>
</span><span id="DoubleMetaphone-35"><a href="#DoubleMetaphone-35"><span class="linenos"> 35</span></a>        <span class="c1"># in the string.  The secondary code letter is given only when it is</span>
</span><span id="DoubleMetaphone-36"><a href="#DoubleMetaphone-36"><span class="linenos"> 36</span></a>        <span class="c1"># different than the primary.</span>
</span><span id="DoubleMetaphone-37"><a href="#DoubleMetaphone-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-38"><a href="#DoubleMetaphone-38"><span class="linenos"> 38</span></a>
</span><span id="DoubleMetaphone-39"><a href="#DoubleMetaphone-39"><span class="linenos"> 39</span></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DoubleMetaphone-40"><a href="#DoubleMetaphone-40"><span class="linenos"> 40</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span id="DoubleMetaphone-41"><a href="#DoubleMetaphone-41"><span class="linenos"> 41</span></a>
</span><span id="DoubleMetaphone-42"><a href="#DoubleMetaphone-42"><span class="linenos"> 42</span></a>    <span class="k">def</span> <span class="nf">check_word_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-43"><a href="#DoubleMetaphone-43"><span class="linenos"> 43</span></a>        <span class="c1"># Skip silent letters when they start a word (because they&#39;re not</span>
</span><span id="DoubleMetaphone-44"><a href="#DoubleMetaphone-44"><span class="linenos"> 44</span></a>        <span class="c1"># phonetic if they&#39;re silent)</span>
</span><span id="DoubleMetaphone-45"><a href="#DoubleMetaphone-45"><span class="linenos"> 45</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">get_letters</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">SILENT_STARTERS</span><span class="p">:</span>
</span><span id="DoubleMetaphone-46"><a href="#DoubleMetaphone-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone-47"><a href="#DoubleMetaphone-47"><span class="linenos"> 47</span></a>        <span class="c1"># Starting with &#39;X&#39; frequently pronounced &#39;Z&#39; e.g. &#39;Xavier&#39;</span>
</span><span id="DoubleMetaphone-48"><a href="#DoubleMetaphone-48"><span class="linenos"> 48</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">get_letters</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-49"><a href="#DoubleMetaphone-49"><span class="linenos"> 49</span></a>            <span class="c1"># &#39;Z&#39; maps to &#39;S&#39;</span>
</span><span id="DoubleMetaphone-50"><a href="#DoubleMetaphone-50"><span class="linenos"> 50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span>
</span><span id="DoubleMetaphone-51"><a href="#DoubleMetaphone-51"><span class="linenos"> 51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone-52"><a href="#DoubleMetaphone-52"><span class="linenos"> 52</span></a>
</span><span id="DoubleMetaphone-53"><a href="#DoubleMetaphone-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">process_vowel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-54"><a href="#DoubleMetaphone-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-55"><a href="#DoubleMetaphone-55"><span class="linenos"> 55</span></a>
</span><span id="DoubleMetaphone-56"><a href="#DoubleMetaphone-56"><span class="linenos"> 56</span></a>        <span class="c1"># All starting vowels map to &#39;A&#39;</span>
</span><span id="DoubleMetaphone-57"><a href="#DoubleMetaphone-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone-58"><a href="#DoubleMetaphone-58"><span class="linenos"> 58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-59"><a href="#DoubleMetaphone-59"><span class="linenos"> 59</span></a>
</span><span id="DoubleMetaphone-60"><a href="#DoubleMetaphone-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">process_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-61"><a href="#DoubleMetaphone-61"><span class="linenos"> 61</span></a>        <span class="c1"># &quot;-mb&quot;, e.g., &quot;dumb&quot;, already accounted for, see &#39;M&#39;</span>
</span><span id="DoubleMetaphone-62"><a href="#DoubleMetaphone-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-63"><a href="#DoubleMetaphone-63"><span class="linenos"> 63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-64"><a href="#DoubleMetaphone-64"><span class="linenos"> 64</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-65"><a href="#DoubleMetaphone-65"><span class="linenos"> 65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-66"><a href="#DoubleMetaphone-66"><span class="linenos"> 66</span></a>
</span><span id="DoubleMetaphone-67"><a href="#DoubleMetaphone-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">process_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-68"><a href="#DoubleMetaphone-68"><span class="linenos"> 68</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-69"><a href="#DoubleMetaphone-69"><span class="linenos"> 69</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-70"><a href="#DoubleMetaphone-70"><span class="linenos"> 70</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-71"><a href="#DoubleMetaphone-71"><span class="linenos"> 71</span></a>
</span><span id="DoubleMetaphone-72"><a href="#DoubleMetaphone-72"><span class="linenos"> 72</span></a>        <span class="c1"># Handle some germanic linguistics</span>
</span><span id="DoubleMetaphone-73"><a href="#DoubleMetaphone-73"><span class="linenos"> 73</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-74"><a href="#DoubleMetaphone-74"><span class="linenos"> 74</span></a>            <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone-75"><a href="#DoubleMetaphone-75"><span class="linenos"> 75</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone-76"><a href="#DoubleMetaphone-76"><span class="linenos"> 76</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACH&quot;</span>
</span><span id="DoubleMetaphone-77"><a href="#DoubleMetaphone-77"><span class="linenos"> 77</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-78"><a href="#DoubleMetaphone-78"><span class="linenos"> 78</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-79"><a href="#DoubleMetaphone-79"><span class="linenos"> 79</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-80"><a href="#DoubleMetaphone-80"><span class="linenos"> 80</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BACHER&quot;</span><span class="p">,</span> <span class="s2">&quot;MACHER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-81"><a href="#DoubleMetaphone-81"><span class="linenos"> 81</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone-82"><a href="#DoubleMetaphone-82"><span class="linenos"> 82</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-83"><a href="#DoubleMetaphone-83"><span class="linenos"> 83</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-84"><a href="#DoubleMetaphone-84"><span class="linenos"> 84</span></a>
</span><span id="DoubleMetaphone-85"><a href="#DoubleMetaphone-85"><span class="linenos"> 85</span></a>        <span class="c1"># Special case &#39;CAESAR&#39;</span>
</span><span id="DoubleMetaphone-86"><a href="#DoubleMetaphone-86"><span class="linenos"> 86</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-87"><a href="#DoubleMetaphone-87"><span class="linenos"> 87</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone-88"><a href="#DoubleMetaphone-88"><span class="linenos"> 88</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAESAR&quot;</span>
</span><span id="DoubleMetaphone-89"><a href="#DoubleMetaphone-89"><span class="linenos"> 89</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-90"><a href="#DoubleMetaphone-90"><span class="linenos"> 90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-91"><a href="#DoubleMetaphone-91"><span class="linenos"> 91</span></a>
</span><span id="DoubleMetaphone-92"><a href="#DoubleMetaphone-92"><span class="linenos"> 92</span></a>        <span class="c1"># Italian &#39;chianti&#39;</span>
</span><span id="DoubleMetaphone-93"><a href="#DoubleMetaphone-93"><span class="linenos"> 93</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHIA&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-94"><a href="#DoubleMetaphone-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-95"><a href="#DoubleMetaphone-95"><span class="linenos"> 95</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CH&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-96"><a href="#DoubleMetaphone-96"><span class="linenos"> 96</span></a>            <span class="c1"># e.g. &#39;michael&#39;</span>
</span><span id="DoubleMetaphone-97"><a href="#DoubleMetaphone-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHAE&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-98"><a href="#DoubleMetaphone-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-99"><a href="#DoubleMetaphone-99"><span class="linenos"> 99</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-100"><a href="#DoubleMetaphone-100"><span class="linenos">100</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone-101"><a href="#DoubleMetaphone-101"><span class="linenos">101</span></a>                <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-102"><a href="#DoubleMetaphone-102"><span class="linenos">102</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HARAC&quot;</span><span class="p">,</span> <span class="s2">&quot;HARIS&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-103"><a href="#DoubleMetaphone-103"><span class="linenos">103</span></a>                    <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone-104"><a href="#DoubleMetaphone-104"><span class="linenos">104</span></a>                    <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HOR&quot;</span><span class="p">,</span> <span class="s2">&quot;HYM&quot;</span><span class="p">,</span> <span class="s2">&quot;HIA&quot;</span><span class="p">,</span> <span class="s2">&quot;HEM&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-105"><a href="#DoubleMetaphone-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone-106"><a href="#DoubleMetaphone-106"><span class="linenos">106</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;CHORE&quot;</span>
</span><span id="DoubleMetaphone-107"><a href="#DoubleMetaphone-107"><span class="linenos">107</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-108"><a href="#DoubleMetaphone-108"><span class="linenos">108</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-109"><a href="#DoubleMetaphone-109"><span class="linenos">109</span></a>
</span><span id="DoubleMetaphone-110"><a href="#DoubleMetaphone-110"><span class="linenos">110</span></a>            <span class="c1"># Germanic, greek, or other phonetic &#39;ch&#39; for &#39;kh&#39; sound</span>
</span><span id="DoubleMetaphone-111"><a href="#DoubleMetaphone-111"><span class="linenos">111</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-112"><a href="#DoubleMetaphone-112"><span class="linenos">112</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VAN &quot;</span><span class="p">,</span> <span class="s2">&quot;VON &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-113"><a href="#DoubleMetaphone-113"><span class="linenos">113</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone-114"><a href="#DoubleMetaphone-114"><span class="linenos">114</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ORCHES&quot;</span><span class="p">,</span> <span class="s2">&quot;ARCHIT&quot;</span><span class="p">,</span> <span class="s2">&quot;ORCHID&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-115"><a href="#DoubleMetaphone-115"><span class="linenos">115</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-116"><a href="#DoubleMetaphone-116"><span class="linenos">116</span></a>                <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-117"><a href="#DoubleMetaphone-117"><span class="linenos">117</span></a>                    <span class="p">(</span>
</span><span id="DoubleMetaphone-118"><a href="#DoubleMetaphone-118"><span class="linenos">118</span></a>                        <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-119"><a href="#DoubleMetaphone-119"><span class="linenos">119</span></a>                        <span class="ow">or</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone-120"><a href="#DoubleMetaphone-120"><span class="linenos">120</span></a>                    <span class="p">)</span>
</span><span id="DoubleMetaphone-121"><a href="#DoubleMetaphone-121"><span class="linenos">121</span></a>                    <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-122"><a href="#DoubleMetaphone-122"><span class="linenos">122</span></a>                        <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="DoubleMetaphone-123"><a href="#DoubleMetaphone-123"><span class="linenos">123</span></a>                        <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-124"><a href="#DoubleMetaphone-124"><span class="linenos">124</span></a>                    <span class="p">)</span>
</span><span id="DoubleMetaphone-125"><a href="#DoubleMetaphone-125"><span class="linenos">125</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone-126"><a href="#DoubleMetaphone-126"><span class="linenos">126</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-127"><a href="#DoubleMetaphone-127"><span class="linenos">127</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-128"><a href="#DoubleMetaphone-128"><span class="linenos">128</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-129"><a href="#DoubleMetaphone-129"><span class="linenos">129</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone-130"><a href="#DoubleMetaphone-130"><span class="linenos">130</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MC&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-131"><a href="#DoubleMetaphone-131"><span class="linenos">131</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-132"><a href="#DoubleMetaphone-132"><span class="linenos">132</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-133"><a href="#DoubleMetaphone-133"><span class="linenos">133</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-134"><a href="#DoubleMetaphone-134"><span class="linenos">134</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-135"><a href="#DoubleMetaphone-135"><span class="linenos">135</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-136"><a href="#DoubleMetaphone-136"><span class="linenos">136</span></a>
</span><span id="DoubleMetaphone-137"><a href="#DoubleMetaphone-137"><span class="linenos">137</span></a>        <span class="c1"># e.g, &#39;czerny&#39;</span>
</span><span id="DoubleMetaphone-138"><a href="#DoubleMetaphone-138"><span class="linenos">138</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-139"><a href="#DoubleMetaphone-139"><span class="linenos">139</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CZ&quot;</span>
</span><span id="DoubleMetaphone-140"><a href="#DoubleMetaphone-140"><span class="linenos">140</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;WICZ&quot;</span>
</span><span id="DoubleMetaphone-141"><a href="#DoubleMetaphone-141"><span class="linenos">141</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-142"><a href="#DoubleMetaphone-142"><span class="linenos">142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-143"><a href="#DoubleMetaphone-143"><span class="linenos">143</span></a>
</span><span id="DoubleMetaphone-144"><a href="#DoubleMetaphone-144"><span class="linenos">144</span></a>        <span class="c1"># e.g., &#39;focaccia&#39;</span>
</span><span id="DoubleMetaphone-145"><a href="#DoubleMetaphone-145"><span class="linenos">145</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CIA&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-146"><a href="#DoubleMetaphone-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-147"><a href="#DoubleMetaphone-147"><span class="linenos">147</span></a>
</span><span id="DoubleMetaphone-148"><a href="#DoubleMetaphone-148"><span class="linenos">148</span></a>        <span class="c1"># Double &#39;C&#39;, but not if e.g. &#39;McClellan&#39;</span>
</span><span id="DoubleMetaphone-149"><a href="#DoubleMetaphone-149"><span class="linenos">149</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-150"><a href="#DoubleMetaphone-150"><span class="linenos">150</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span>
</span><span id="DoubleMetaphone-151"><a href="#DoubleMetaphone-151"><span class="linenos">151</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-152"><a href="#DoubleMetaphone-152"><span class="linenos">152</span></a>            <span class="c1"># &#39;bellocchio&#39; but not &#39;bacchus&#39;</span>
</span><span id="DoubleMetaphone-153"><a href="#DoubleMetaphone-153"><span class="linenos">153</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-154"><a href="#DoubleMetaphone-154"><span class="linenos">154</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-155"><a href="#DoubleMetaphone-155"><span class="linenos">155</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;HU&quot;</span>
</span><span id="DoubleMetaphone-156"><a href="#DoubleMetaphone-156"><span class="linenos">156</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-157"><a href="#DoubleMetaphone-157"><span class="linenos">157</span></a>                <span class="c1"># &#39;accident&#39;, &#39;accede&#39; &#39;succeed&#39;</span>
</span><span id="DoubleMetaphone-158"><a href="#DoubleMetaphone-158"><span class="linenos">158</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-159"><a href="#DoubleMetaphone-159"><span class="linenos">159</span></a>                    <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span>
</span><span id="DoubleMetaphone-160"><a href="#DoubleMetaphone-160"><span class="linenos">160</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UCCEE&quot;</span><span class="p">,</span> <span class="s2">&quot;UCCES&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-161"><a href="#DoubleMetaphone-161"><span class="linenos">161</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KS&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-162"><a href="#DoubleMetaphone-162"><span class="linenos">162</span></a>
</span><span id="DoubleMetaphone-163"><a href="#DoubleMetaphone-163"><span class="linenos">163</span></a>                <span class="c1"># &#39;bacci&#39;, &#39;bertucci&#39;, other italian</span>
</span><span id="DoubleMetaphone-164"><a href="#DoubleMetaphone-164"><span class="linenos">164</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-165"><a href="#DoubleMetaphone-165"><span class="linenos">165</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-166"><a href="#DoubleMetaphone-166"><span class="linenos">166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-167"><a href="#DoubleMetaphone-167"><span class="linenos">167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-168"><a href="#DoubleMetaphone-168"><span class="linenos">168</span></a>
</span><span id="DoubleMetaphone-169"><a href="#DoubleMetaphone-169"><span class="linenos">169</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CK&quot;</span><span class="p">,</span> <span class="s2">&quot;CG&quot;</span><span class="p">,</span> <span class="s2">&quot;CQ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-170"><a href="#DoubleMetaphone-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-171"><a href="#DoubleMetaphone-171"><span class="linenos">171</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CI&quot;</span><span class="p">,</span> <span class="s2">&quot;CE&quot;</span><span class="p">,</span> <span class="s2">&quot;CY&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-172"><a href="#DoubleMetaphone-172"><span class="linenos">172</span></a>            <span class="c1"># Italian vs. English</span>
</span><span id="DoubleMetaphone-173"><a href="#DoubleMetaphone-173"><span class="linenos">173</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CIO&quot;</span><span class="p">,</span> <span class="s2">&quot;CIE&quot;</span><span class="p">,</span> <span class="s2">&quot;CIA&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-174"><a href="#DoubleMetaphone-174"><span class="linenos">174</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-175"><a href="#DoubleMetaphone-175"><span class="linenos">175</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-176"><a href="#DoubleMetaphone-176"><span class="linenos">176</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-177"><a href="#DoubleMetaphone-177"><span class="linenos">177</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-178"><a href="#DoubleMetaphone-178"><span class="linenos">178</span></a>            <span class="c1"># Name set in &#39;mac caffrey&#39;, &#39;mac gregor&#39;</span>
</span><span id="DoubleMetaphone-179"><a href="#DoubleMetaphone-179"><span class="linenos">179</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot; C&quot;</span><span class="p">,</span> <span class="s2">&quot; Q&quot;</span><span class="p">,</span> <span class="s2">&quot; G&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-180"><a href="#DoubleMetaphone-180"><span class="linenos">180</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-181"><a href="#DoubleMetaphone-181"><span class="linenos">181</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-182"><a href="#DoubleMetaphone-182"><span class="linenos">182</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone-183"><a href="#DoubleMetaphone-183"><span class="linenos">183</span></a>                    <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span>
</span><span id="DoubleMetaphone-184"><a href="#DoubleMetaphone-184"><span class="linenos">184</span></a>                <span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CE&quot;</span><span class="p">,</span> <span class="s2">&quot;CI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-185"><a href="#DoubleMetaphone-185"><span class="linenos">185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-186"><a href="#DoubleMetaphone-186"><span class="linenos">186</span></a>
</span><span id="DoubleMetaphone-187"><a href="#DoubleMetaphone-187"><span class="linenos">187</span></a>                <span class="c1"># Default sound for &#39;C&#39;</span>
</span><span id="DoubleMetaphone-188"><a href="#DoubleMetaphone-188"><span class="linenos">188</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-189"><a href="#DoubleMetaphone-189"><span class="linenos">189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-190"><a href="#DoubleMetaphone-190"><span class="linenos">190</span></a>
</span><span id="DoubleMetaphone-191"><a href="#DoubleMetaphone-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">process_d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-192"><a href="#DoubleMetaphone-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DG&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-193"><a href="#DoubleMetaphone-193"><span class="linenos">193</span></a>            <span class="c1"># e.g. &#39;edge&#39;</span>
</span><span id="DoubleMetaphone-194"><a href="#DoubleMetaphone-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-195"><a href="#DoubleMetaphone-195"><span class="linenos">195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-196"><a href="#DoubleMetaphone-196"><span class="linenos">196</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-197"><a href="#DoubleMetaphone-197"><span class="linenos">197</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TK&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-198"><a href="#DoubleMetaphone-198"><span class="linenos">198</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DT&quot;</span><span class="p">,</span> <span class="s2">&quot;DD&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-199"><a href="#DoubleMetaphone-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-200"><a href="#DoubleMetaphone-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-201"><a href="#DoubleMetaphone-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-202"><a href="#DoubleMetaphone-202"><span class="linenos">202</span></a>
</span><span id="DoubleMetaphone-203"><a href="#DoubleMetaphone-203"><span class="linenos">203</span></a>    <span class="k">def</span> <span class="nf">process_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-204"><a href="#DoubleMetaphone-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-205"><a href="#DoubleMetaphone-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-206"><a href="#DoubleMetaphone-206"><span class="linenos">206</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-207"><a href="#DoubleMetaphone-207"><span class="linenos">207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-208"><a href="#DoubleMetaphone-208"><span class="linenos">208</span></a>
</span><span id="DoubleMetaphone-209"><a href="#DoubleMetaphone-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">process_g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-210"><a href="#DoubleMetaphone-210"><span class="linenos">210</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-211"><a href="#DoubleMetaphone-211"><span class="linenos">211</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-212"><a href="#DoubleMetaphone-212"><span class="linenos">212</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-213"><a href="#DoubleMetaphone-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-214"><a href="#DoubleMetaphone-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone-215"><a href="#DoubleMetaphone-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-216"><a href="#DoubleMetaphone-216"><span class="linenos">216</span></a>            <span class="k">elif</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="DoubleMetaphone-217"><a href="#DoubleMetaphone-217"><span class="linenos">217</span></a>                <span class="c1"># &#39;Ghislane&#39;, &#39;Ghiradelli&#39;</span>
</span><span id="DoubleMetaphone-218"><a href="#DoubleMetaphone-218"><span class="linenos">218</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone-219"><a href="#DoubleMetaphone-219"><span class="linenos">219</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-220"><a href="#DoubleMetaphone-220"><span class="linenos">220</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-221"><a href="#DoubleMetaphone-221"><span class="linenos">221</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-222"><a href="#DoubleMetaphone-222"><span class="linenos">222</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-223"><a href="#DoubleMetaphone-223"><span class="linenos">223</span></a>
</span><span id="DoubleMetaphone-224"><a href="#DoubleMetaphone-224"><span class="linenos">224</span></a>            <span class="c1"># Parker&#39;s rule for e.g., &#39;Hugh&#39;</span>
</span><span id="DoubleMetaphone-225"><a href="#DoubleMetaphone-225"><span class="linenos">225</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-226"><a href="#DoubleMetaphone-226"><span class="linenos">226</span></a>                <span class="p">(</span>
</span><span id="DoubleMetaphone-227"><a href="#DoubleMetaphone-227"><span class="linenos">227</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-228"><a href="#DoubleMetaphone-228"><span class="linenos">228</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-229"><a href="#DoubleMetaphone-229"><span class="linenos">229</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone-230"><a href="#DoubleMetaphone-230"><span class="linenos">230</span></a>                <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-231"><a href="#DoubleMetaphone-231"><span class="linenos">231</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-232"><a href="#DoubleMetaphone-232"><span class="linenos">232</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-233"><a href="#DoubleMetaphone-233"><span class="linenos">233</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone-234"><a href="#DoubleMetaphone-234"><span class="linenos">234</span></a>                <span class="ow">or</span> <span class="p">(</span><span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">])</span>
</span><span id="DoubleMetaphone-235"><a href="#DoubleMetaphone-235"><span class="linenos">235</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-236"><a href="#DoubleMetaphone-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-237"><a href="#DoubleMetaphone-237"><span class="linenos">237</span></a>
</span><span id="DoubleMetaphone-238"><a href="#DoubleMetaphone-238"><span class="linenos">238</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-239"><a href="#DoubleMetaphone-239"><span class="linenos">239</span></a>                <span class="c1"># e.g., &#39;laugh&#39;, &#39;McLaughlin&#39;, &#39;cough&#39;, &#39;gough&#39;, &#39;rough&#39;, &#39;tough&#39;</span>
</span><span id="DoubleMetaphone-240"><a href="#DoubleMetaphone-240"><span class="linenos">240</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-241"><a href="#DoubleMetaphone-241"><span class="linenos">241</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-242"><a href="#DoubleMetaphone-242"><span class="linenos">242</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;U&quot;</span>
</span><span id="DoubleMetaphone-243"><a href="#DoubleMetaphone-243"><span class="linenos">243</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-244"><a href="#DoubleMetaphone-244"><span class="linenos">244</span></a>                <span class="p">):</span>
</span><span id="DoubleMetaphone-245"><a href="#DoubleMetaphone-245"><span class="linenos">245</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-246"><a href="#DoubleMetaphone-246"><span class="linenos">246</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-247"><a href="#DoubleMetaphone-247"><span class="linenos">247</span></a>                    <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-248"><a href="#DoubleMetaphone-248"><span class="linenos">248</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-249"><a href="#DoubleMetaphone-249"><span class="linenos">249</span></a>
</span><span id="DoubleMetaphone-250"><a href="#DoubleMetaphone-250"><span class="linenos">250</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-251"><a href="#DoubleMetaphone-251"><span class="linenos">251</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-252"><a href="#DoubleMetaphone-252"><span class="linenos">252</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-253"><a href="#DoubleMetaphone-253"><span class="linenos">253</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone-254"><a href="#DoubleMetaphone-254"><span class="linenos">254</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-255"><a href="#DoubleMetaphone-255"><span class="linenos">255</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-256"><a href="#DoubleMetaphone-256"><span class="linenos">256</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-257"><a href="#DoubleMetaphone-257"><span class="linenos">257</span></a>
</span><span id="DoubleMetaphone-258"><a href="#DoubleMetaphone-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-259"><a href="#DoubleMetaphone-259"><span class="linenos">259</span></a>                <span class="c1"># Not e.g. &#39;cagney&#39;</span>
</span><span id="DoubleMetaphone-260"><a href="#DoubleMetaphone-260"><span class="linenos">260</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-261"><a href="#DoubleMetaphone-261"><span class="linenos">261</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;EY&quot;</span>
</span><span id="DoubleMetaphone-262"><a href="#DoubleMetaphone-262"><span class="linenos">262</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Y&quot;</span>
</span><span id="DoubleMetaphone-263"><a href="#DoubleMetaphone-263"><span class="linenos">263</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-264"><a href="#DoubleMetaphone-264"><span class="linenos">264</span></a>                <span class="p">):</span>
</span><span id="DoubleMetaphone-265"><a href="#DoubleMetaphone-265"><span class="linenos">265</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-266"><a href="#DoubleMetaphone-266"><span class="linenos">266</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-267"><a href="#DoubleMetaphone-267"><span class="linenos">267</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-268"><a href="#DoubleMetaphone-268"><span class="linenos">268</span></a>
</span><span id="DoubleMetaphone-269"><a href="#DoubleMetaphone-269"><span class="linenos">269</span></a>        <span class="c1"># e.g. &#39;Tagliaro&#39;</span>
</span><span id="DoubleMetaphone-270"><a href="#DoubleMetaphone-270"><span class="linenos">270</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-271"><a href="#DoubleMetaphone-271"><span class="linenos">271</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LI&quot;</span>
</span><span id="DoubleMetaphone-272"><a href="#DoubleMetaphone-272"><span class="linenos">272</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-273"><a href="#DoubleMetaphone-273"><span class="linenos">273</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-274"><a href="#DoubleMetaphone-274"><span class="linenos">274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KL&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-275"><a href="#DoubleMetaphone-275"><span class="linenos">275</span></a>
</span><span id="DoubleMetaphone-276"><a href="#DoubleMetaphone-276"><span class="linenos">276</span></a>        <span class="c1"># -ges-,-gep-,-gel-, -gie- at beginning</span>
</span><span id="DoubleMetaphone-277"><a href="#DoubleMetaphone-277"><span class="linenos">277</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-278"><a href="#DoubleMetaphone-278"><span class="linenos">278</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span>
</span><span id="DoubleMetaphone-279"><a href="#DoubleMetaphone-279"><span class="linenos">279</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="DoubleMetaphone-280"><a href="#DoubleMetaphone-280"><span class="linenos">280</span></a>            <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ES&quot;</span><span class="p">,</span> <span class="s2">&quot;EP&quot;</span><span class="p">,</span> <span class="s2">&quot;EB&quot;</span><span class="p">,</span> <span class="s2">&quot;EL&quot;</span><span class="p">,</span> <span class="s2">&quot;EY&quot;</span><span class="p">,</span> <span class="s2">&quot;IB&quot;</span><span class="p">,</span> <span class="s2">&quot;IL&quot;</span><span class="p">,</span> <span class="s2">&quot;IN&quot;</span><span class="p">,</span> <span class="s2">&quot;IE&quot;</span><span class="p">,</span> <span class="s2">&quot;EI&quot;</span><span class="p">,</span> <span class="s2">&quot;ER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-281"><a href="#DoubleMetaphone-281"><span class="linenos">281</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-282"><a href="#DoubleMetaphone-282"><span class="linenos">282</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-283"><a href="#DoubleMetaphone-283"><span class="linenos">283</span></a>
</span><span id="DoubleMetaphone-284"><a href="#DoubleMetaphone-284"><span class="linenos">284</span></a>        <span class="c1"># -ger-,  -gy-</span>
</span><span id="DoubleMetaphone-285"><a href="#DoubleMetaphone-285"><span class="linenos">285</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-286"><a href="#DoubleMetaphone-286"><span class="linenos">286</span></a>            <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ER&quot;</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-287"><a href="#DoubleMetaphone-287"><span class="linenos">287</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span>
</span><span id="DoubleMetaphone-288"><a href="#DoubleMetaphone-288"><span class="linenos">288</span></a>            <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DANGER&quot;</span><span class="p">,</span> <span class="s2">&quot;RANGER&quot;</span><span class="p">,</span> <span class="s2">&quot;MANGER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-289"><a href="#DoubleMetaphone-289"><span class="linenos">289</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-290"><a href="#DoubleMetaphone-290"><span class="linenos">290</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RGY&quot;</span><span class="p">,</span> <span class="s2">&quot;OGY&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-291"><a href="#DoubleMetaphone-291"><span class="linenos">291</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-292"><a href="#DoubleMetaphone-292"><span class="linenos">292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-293"><a href="#DoubleMetaphone-293"><span class="linenos">293</span></a>
</span><span id="DoubleMetaphone-294"><a href="#DoubleMetaphone-294"><span class="linenos">294</span></a>        <span class="c1"># Italian e.g, &#39;Biaggi&#39;</span>
</span><span id="DoubleMetaphone-295"><a href="#DoubleMetaphone-295"><span class="linenos">295</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone-296"><a href="#DoubleMetaphone-296"><span class="linenos">296</span></a>            <span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span>
</span><span id="DoubleMetaphone-297"><a href="#DoubleMetaphone-297"><span class="linenos">297</span></a>        <span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AGGI&quot;</span><span class="p">,</span> <span class="s2">&quot;OGGI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-298"><a href="#DoubleMetaphone-298"><span class="linenos">298</span></a>            <span class="c1"># Germanic</span>
</span><span id="DoubleMetaphone-299"><a href="#DoubleMetaphone-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-300"><a href="#DoubleMetaphone-300"><span class="linenos">300</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VON &quot;</span><span class="p">,</span> <span class="s2">&quot;VAN &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-301"><a href="#DoubleMetaphone-301"><span class="linenos">301</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone-302"><a href="#DoubleMetaphone-302"><span class="linenos">302</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ET&quot;</span>
</span><span id="DoubleMetaphone-303"><a href="#DoubleMetaphone-303"><span class="linenos">303</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-304"><a href="#DoubleMetaphone-304"><span class="linenos">304</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-305"><a href="#DoubleMetaphone-305"><span class="linenos">305</span></a>
</span><span id="DoubleMetaphone-306"><a href="#DoubleMetaphone-306"><span class="linenos">306</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-307"><a href="#DoubleMetaphone-307"><span class="linenos">307</span></a>                <span class="c1"># Always soft if following the French ending</span>
</span><span id="DoubleMetaphone-308"><a href="#DoubleMetaphone-308"><span class="linenos">308</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IER &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-309"><a href="#DoubleMetaphone-309"><span class="linenos">309</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-310"><a href="#DoubleMetaphone-310"><span class="linenos">310</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-311"><a href="#DoubleMetaphone-311"><span class="linenos">311</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-312"><a href="#DoubleMetaphone-312"><span class="linenos">312</span></a>
</span><span id="DoubleMetaphone-313"><a href="#DoubleMetaphone-313"><span class="linenos">313</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-314"><a href="#DoubleMetaphone-314"><span class="linenos">314</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-315"><a href="#DoubleMetaphone-315"><span class="linenos">315</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-316"><a href="#DoubleMetaphone-316"><span class="linenos">316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-317"><a href="#DoubleMetaphone-317"><span class="linenos">317</span></a>
</span><span id="DoubleMetaphone-318"><a href="#DoubleMetaphone-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">process_h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-319"><a href="#DoubleMetaphone-319"><span class="linenos">319</span></a>        <span class="c1"># Keep if self.word.start_index &amp; before vowel, or between 2 vowels</span>
</span><span id="DoubleMetaphone-320"><a href="#DoubleMetaphone-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-321"><a href="#DoubleMetaphone-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-322"><a href="#DoubleMetaphone-322"><span class="linenos">322</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone-323"><a href="#DoubleMetaphone-323"><span class="linenos">323</span></a>        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone-324"><a href="#DoubleMetaphone-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-325"><a href="#DoubleMetaphone-325"><span class="linenos">325</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-326"><a href="#DoubleMetaphone-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-327"><a href="#DoubleMetaphone-327"><span class="linenos">327</span></a>
</span><span id="DoubleMetaphone-328"><a href="#DoubleMetaphone-328"><span class="linenos">328</span></a>    <span class="k">def</span> <span class="nf">process_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-329"><a href="#DoubleMetaphone-329"><span class="linenos">329</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-330"><a href="#DoubleMetaphone-330"><span class="linenos">330</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-331"><a href="#DoubleMetaphone-331"><span class="linenos">331</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-332"><a href="#DoubleMetaphone-332"><span class="linenos">332</span></a>
</span><span id="DoubleMetaphone-333"><a href="#DoubleMetaphone-333"><span class="linenos">333</span></a>        <span class="c1"># Spanish, &#39;Jose&#39;, &#39;Jacinto&#39;, etc.</span>
</span><span id="DoubleMetaphone-334"><a href="#DoubleMetaphone-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-335"><a href="#DoubleMetaphone-335"><span class="linenos">335</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;JOSE&quot;</span>
</span><span id="DoubleMetaphone-336"><a href="#DoubleMetaphone-336"><span class="linenos">336</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SAN &quot;</span>
</span><span id="DoubleMetaphone-337"><a href="#DoubleMetaphone-337"><span class="linenos">337</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-338"><a href="#DoubleMetaphone-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone-339"><a href="#DoubleMetaphone-339"><span class="linenos">339</span></a>                <span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span>
</span><span id="DoubleMetaphone-340"><a href="#DoubleMetaphone-340"><span class="linenos">340</span></a>            <span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SAN &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-341"><a href="#DoubleMetaphone-341"><span class="linenos">341</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-342"><a href="#DoubleMetaphone-342"><span class="linenos">342</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-343"><a href="#DoubleMetaphone-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-344"><a href="#DoubleMetaphone-344"><span class="linenos">344</span></a>
</span><span id="DoubleMetaphone-345"><a href="#DoubleMetaphone-345"><span class="linenos">345</span></a>        <span class="c1"># Yankelovich/Jankelowicz</span>
</span><span id="DoubleMetaphone-346"><a href="#DoubleMetaphone-346"><span class="linenos">346</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-347"><a href="#DoubleMetaphone-347"><span class="linenos">347</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone-348"><a href="#DoubleMetaphone-348"><span class="linenos">348</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;JOSE&quot;</span>
</span><span id="DoubleMetaphone-349"><a href="#DoubleMetaphone-349"><span class="linenos">349</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-350"><a href="#DoubleMetaphone-350"><span class="linenos">350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-351"><a href="#DoubleMetaphone-351"><span class="linenos">351</span></a>
</span><span id="DoubleMetaphone-352"><a href="#DoubleMetaphone-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-353"><a href="#DoubleMetaphone-353"><span class="linenos">353</span></a>            <span class="c1"># Spanish pronunciation of e.g. &#39;Bajador&#39;</span>
</span><span id="DoubleMetaphone-354"><a href="#DoubleMetaphone-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-355"><a href="#DoubleMetaphone-355"><span class="linenos">355</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone-356"><a href="#DoubleMetaphone-356"><span class="linenos">356</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-357"><a href="#DoubleMetaphone-357"><span class="linenos">357</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-358"><a href="#DoubleMetaphone-358"><span class="linenos">358</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-359"><a href="#DoubleMetaphone-359"><span class="linenos">359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-360"><a href="#DoubleMetaphone-360"><span class="linenos">360</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-361"><a href="#DoubleMetaphone-361"><span class="linenos">361</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone-362"><a href="#DoubleMetaphone-362"><span class="linenos">362</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-363"><a href="#DoubleMetaphone-363"><span class="linenos">363</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-364"><a href="#DoubleMetaphone-364"><span class="linenos">364</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone-365"><a href="#DoubleMetaphone-365"><span class="linenos">365</span></a>                        <span class="s2">&quot;L&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-366"><a href="#DoubleMetaphone-366"><span class="linenos">366</span></a>                        <span class="s2">&quot;T&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-367"><a href="#DoubleMetaphone-367"><span class="linenos">367</span></a>                        <span class="s2">&quot;K&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-368"><a href="#DoubleMetaphone-368"><span class="linenos">368</span></a>                        <span class="s2">&quot;S&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-369"><a href="#DoubleMetaphone-369"><span class="linenos">369</span></a>                        <span class="s2">&quot;N&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-370"><a href="#DoubleMetaphone-370"><span class="linenos">370</span></a>                        <span class="s2">&quot;M&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-371"><a href="#DoubleMetaphone-371"><span class="linenos">371</span></a>                        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-372"><a href="#DoubleMetaphone-372"><span class="linenos">372</span></a>                        <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-373"><a href="#DoubleMetaphone-373"><span class="linenos">373</span></a>                    <span class="p">]</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-374"><a href="#DoubleMetaphone-374"><span class="linenos">374</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-375"><a href="#DoubleMetaphone-375"><span class="linenos">375</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-376"><a href="#DoubleMetaphone-376"><span class="linenos">376</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-377"><a href="#DoubleMetaphone-377"><span class="linenos">377</span></a>
</span><span id="DoubleMetaphone-378"><a href="#DoubleMetaphone-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;J&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-379"><a href="#DoubleMetaphone-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-380"><a href="#DoubleMetaphone-380"><span class="linenos">380</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-381"><a href="#DoubleMetaphone-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-382"><a href="#DoubleMetaphone-382"><span class="linenos">382</span></a>
</span><span id="DoubleMetaphone-383"><a href="#DoubleMetaphone-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">process_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-384"><a href="#DoubleMetaphone-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-385"><a href="#DoubleMetaphone-385"><span class="linenos">385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-386"><a href="#DoubleMetaphone-386"><span class="linenos">386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-387"><a href="#DoubleMetaphone-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-388"><a href="#DoubleMetaphone-388"><span class="linenos">388</span></a>
</span><span id="DoubleMetaphone-389"><a href="#DoubleMetaphone-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">process_l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-390"><a href="#DoubleMetaphone-390"><span class="linenos">390</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-391"><a href="#DoubleMetaphone-391"><span class="linenos">391</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-392"><a href="#DoubleMetaphone-392"><span class="linenos">392</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone-393"><a href="#DoubleMetaphone-393"><span class="linenos">393</span></a>
</span><span id="DoubleMetaphone-394"><a href="#DoubleMetaphone-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-395"><a href="#DoubleMetaphone-395"><span class="linenos">395</span></a>            <span class="c1"># Spanish e.g. &#39;cabrillo&#39;, &#39;gallegos&#39;</span>
</span><span id="DoubleMetaphone-396"><a href="#DoubleMetaphone-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-397"><a href="#DoubleMetaphone-397"><span class="linenos">397</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">end_index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-398"><a href="#DoubleMetaphone-398"><span class="linenos">398</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ILLO&quot;</span><span class="p">,</span> <span class="s2">&quot;ILLA&quot;</span><span class="p">,</span> <span class="s2">&quot;ALLE&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-399"><a href="#DoubleMetaphone-399"><span class="linenos">399</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-400"><a href="#DoubleMetaphone-400"><span class="linenos">400</span></a>                <span class="p">(</span>
</span><span id="DoubleMetaphone-401"><a href="#DoubleMetaphone-401"><span class="linenos">401</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">end_index</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AS&quot;</span><span class="p">,</span> <span class="s2">&quot;OS&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-402"><a href="#DoubleMetaphone-402"><span class="linenos">402</span></a>                    <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">end_index</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-403"><a href="#DoubleMetaphone-403"><span class="linenos">403</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone-404"><a href="#DoubleMetaphone-404"><span class="linenos">404</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ALLE&quot;</span>
</span><span id="DoubleMetaphone-405"><a href="#DoubleMetaphone-405"><span class="linenos">405</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-406"><a href="#DoubleMetaphone-406"><span class="linenos">406</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-407"><a href="#DoubleMetaphone-407"><span class="linenos">407</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-408"><a href="#DoubleMetaphone-408"><span class="linenos">408</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-409"><a href="#DoubleMetaphone-409"><span class="linenos">409</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-410"><a href="#DoubleMetaphone-410"><span class="linenos">410</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-411"><a href="#DoubleMetaphone-411"><span class="linenos">411</span></a>
</span><span id="DoubleMetaphone-412"><a href="#DoubleMetaphone-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">process_m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-413"><a href="#DoubleMetaphone-413"><span class="linenos">413</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-414"><a href="#DoubleMetaphone-414"><span class="linenos">414</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-415"><a href="#DoubleMetaphone-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-416"><a href="#DoubleMetaphone-416"><span class="linenos">416</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UMB&quot;</span>
</span><span id="DoubleMetaphone-417"><a href="#DoubleMetaphone-417"><span class="linenos">417</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-418"><a href="#DoubleMetaphone-418"><span class="linenos">418</span></a>                <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone-419"><a href="#DoubleMetaphone-419"><span class="linenos">419</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ER&quot;</span>
</span><span id="DoubleMetaphone-420"><a href="#DoubleMetaphone-420"><span class="linenos">420</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone-421"><a href="#DoubleMetaphone-421"><span class="linenos">421</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-422"><a href="#DoubleMetaphone-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-423"><a href="#DoubleMetaphone-423"><span class="linenos">423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-424"><a href="#DoubleMetaphone-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-425"><a href="#DoubleMetaphone-425"><span class="linenos">425</span></a>
</span><span id="DoubleMetaphone-426"><a href="#DoubleMetaphone-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="nf">process_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-427"><a href="#DoubleMetaphone-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-428"><a href="#DoubleMetaphone-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-429"><a href="#DoubleMetaphone-429"><span class="linenos">429</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-430"><a href="#DoubleMetaphone-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-431"><a href="#DoubleMetaphone-431"><span class="linenos">431</span></a>
</span><span id="DoubleMetaphone-432"><a href="#DoubleMetaphone-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">process_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-433"><a href="#DoubleMetaphone-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-434"><a href="#DoubleMetaphone-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-435"><a href="#DoubleMetaphone-435"><span class="linenos">435</span></a>
</span><span id="DoubleMetaphone-436"><a href="#DoubleMetaphone-436"><span class="linenos">436</span></a>        <span class="c1"># Account for &quot;Campbell&quot;, &quot;raspberry&quot;</span>
</span><span id="DoubleMetaphone-437"><a href="#DoubleMetaphone-437"><span class="linenos">437</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-438"><a href="#DoubleMetaphone-438"><span class="linenos">438</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-439"><a href="#DoubleMetaphone-439"><span class="linenos">439</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-440"><a href="#DoubleMetaphone-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-441"><a href="#DoubleMetaphone-441"><span class="linenos">441</span></a>
</span><span id="DoubleMetaphone-442"><a href="#DoubleMetaphone-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">process_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-443"><a href="#DoubleMetaphone-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-444"><a href="#DoubleMetaphone-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-445"><a href="#DoubleMetaphone-445"><span class="linenos">445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-446"><a href="#DoubleMetaphone-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-447"><a href="#DoubleMetaphone-447"><span class="linenos">447</span></a>
</span><span id="DoubleMetaphone-448"><a href="#DoubleMetaphone-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">process_r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-449"><a href="#DoubleMetaphone-449"><span class="linenos">449</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-450"><a href="#DoubleMetaphone-450"><span class="linenos">450</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-451"><a href="#DoubleMetaphone-451"><span class="linenos">451</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone-452"><a href="#DoubleMetaphone-452"><span class="linenos">452</span></a>
</span><span id="DoubleMetaphone-453"><a href="#DoubleMetaphone-453"><span class="linenos">453</span></a>        <span class="c1"># French e.g. &#39;Rogier&#39;, but exclude e.g. &#39;Hochmeier&#39;</span>
</span><span id="DoubleMetaphone-454"><a href="#DoubleMetaphone-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-455"><a href="#DoubleMetaphone-455"><span class="linenos">455</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">end_index</span>
</span><span id="DoubleMetaphone-456"><a href="#DoubleMetaphone-456"><span class="linenos">456</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-457"><a href="#DoubleMetaphone-457"><span class="linenos">457</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IE&quot;</span>
</span><span id="DoubleMetaphone-458"><a href="#DoubleMetaphone-458"><span class="linenos">458</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">4</span> <span class="p">:</span> <span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ME&quot;</span><span class="p">,</span> <span class="s2">&quot;MA&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-459"><a href="#DoubleMetaphone-459"><span class="linenos">459</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-460"><a href="#DoubleMetaphone-460"><span class="linenos">460</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-461"><a href="#DoubleMetaphone-461"><span class="linenos">461</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-462"><a href="#DoubleMetaphone-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-463"><a href="#DoubleMetaphone-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-464"><a href="#DoubleMetaphone-464"><span class="linenos">464</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-465"><a href="#DoubleMetaphone-465"><span class="linenos">465</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-466"><a href="#DoubleMetaphone-466"><span class="linenos">466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-467"><a href="#DoubleMetaphone-467"><span class="linenos">467</span></a>
</span><span id="DoubleMetaphone-468"><a href="#DoubleMetaphone-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">process_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-469"><a href="#DoubleMetaphone-469"><span class="linenos">469</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-470"><a href="#DoubleMetaphone-470"><span class="linenos">470</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-471"><a href="#DoubleMetaphone-471"><span class="linenos">471</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-472"><a href="#DoubleMetaphone-472"><span class="linenos">472</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone-473"><a href="#DoubleMetaphone-473"><span class="linenos">473</span></a>
</span><span id="DoubleMetaphone-474"><a href="#DoubleMetaphone-474"><span class="linenos">474</span></a>        <span class="c1"># Special cases like &#39;Carlisle&#39;, &#39;Carlysle&#39;</span>
</span><span id="DoubleMetaphone-475"><a href="#DoubleMetaphone-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ISL&quot;</span><span class="p">,</span> <span class="s2">&quot;YSL&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-476"><a href="#DoubleMetaphone-476"><span class="linenos">476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-477"><a href="#DoubleMetaphone-477"><span class="linenos">477</span></a>
</span><span id="DoubleMetaphone-478"><a href="#DoubleMetaphone-478"><span class="linenos">478</span></a>        <span class="c1"># special case &#39;sugar-&#39;</span>
</span><span id="DoubleMetaphone-479"><a href="#DoubleMetaphone-479"><span class="linenos">479</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-480"><a href="#DoubleMetaphone-480"><span class="linenos">480</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SUGAR&quot;</span>
</span><span id="DoubleMetaphone-481"><a href="#DoubleMetaphone-481"><span class="linenos">481</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-482"><a href="#DoubleMetaphone-482"><span class="linenos">482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-483"><a href="#DoubleMetaphone-483"><span class="linenos">483</span></a>
</span><span id="DoubleMetaphone-484"><a href="#DoubleMetaphone-484"><span class="linenos">484</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SH&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-485"><a href="#DoubleMetaphone-485"><span class="linenos">485</span></a>            <span class="c1"># Germanic</span>
</span><span id="DoubleMetaphone-486"><a href="#DoubleMetaphone-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HEIM&quot;</span><span class="p">,</span> <span class="s2">&quot;HOEK&quot;</span><span class="p">,</span> <span class="s2">&quot;HOLM&quot;</span><span class="p">,</span> <span class="s2">&quot;HOLZ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-487"><a href="#DoubleMetaphone-487"><span class="linenos">487</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-488"><a href="#DoubleMetaphone-488"><span class="linenos">488</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-489"><a href="#DoubleMetaphone-489"><span class="linenos">489</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-490"><a href="#DoubleMetaphone-490"><span class="linenos">490</span></a>
</span><span id="DoubleMetaphone-491"><a href="#DoubleMetaphone-491"><span class="linenos">491</span></a>        <span class="c1"># Italian &amp; Armenian</span>
</span><span id="DoubleMetaphone-492"><a href="#DoubleMetaphone-492"><span class="linenos">492</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-493"><a href="#DoubleMetaphone-493"><span class="linenos">493</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SIO&quot;</span><span class="p">,</span> <span class="s2">&quot;SIA&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-494"><a href="#DoubleMetaphone-494"><span class="linenos">494</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SIAN&quot;</span>
</span><span id="DoubleMetaphone-495"><a href="#DoubleMetaphone-495"><span class="linenos">495</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-496"><a href="#DoubleMetaphone-496"><span class="linenos">496</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span><span class="p">:</span>
</span><span id="DoubleMetaphone-497"><a href="#DoubleMetaphone-497"><span class="linenos">497</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-498"><a href="#DoubleMetaphone-498"><span class="linenos">498</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-499"><a href="#DoubleMetaphone-499"><span class="linenos">499</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-500"><a href="#DoubleMetaphone-500"><span class="linenos">500</span></a>
</span><span id="DoubleMetaphone-501"><a href="#DoubleMetaphone-501"><span class="linenos">501</span></a>        <span class="c1"># Lots of anglicisations to match here</span>
</span><span id="DoubleMetaphone-502"><a href="#DoubleMetaphone-502"><span class="linenos">502</span></a>        <span class="c1"># Germanic, e.g. &#39;Smith&#39; == &#39;Schmidt&#39;, &#39;Snider&#39; == &#39;Schneider&#39;</span>
</span><span id="DoubleMetaphone-503"><a href="#DoubleMetaphone-503"><span class="linenos">503</span></a>        <span class="c1"># Slavic languages, catch -sz- and the tricky Hungarian</span>
</span><span id="DoubleMetaphone-504"><a href="#DoubleMetaphone-504"><span class="linenos">504</span></a>        <span class="c1"># pronunciation with an &#39;s&#39;</span>
</span><span id="DoubleMetaphone-505"><a href="#DoubleMetaphone-505"><span class="linenos">505</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-506"><a href="#DoubleMetaphone-506"><span class="linenos">506</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-507"><a href="#DoubleMetaphone-507"><span class="linenos">507</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-508"><a href="#DoubleMetaphone-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-509"><a href="#DoubleMetaphone-509"><span class="linenos">509</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-510"><a href="#DoubleMetaphone-510"><span class="linenos">510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-511"><a href="#DoubleMetaphone-511"><span class="linenos">511</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-512"><a href="#DoubleMetaphone-512"><span class="linenos">512</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-513"><a href="#DoubleMetaphone-513"><span class="linenos">513</span></a>
</span><span id="DoubleMetaphone-514"><a href="#DoubleMetaphone-514"><span class="linenos">514</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SC&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-515"><a href="#DoubleMetaphone-515"><span class="linenos">515</span></a>            <span class="c1"># Schlesinger&#39;s rule</span>
</span><span id="DoubleMetaphone-516"><a href="#DoubleMetaphone-516"><span class="linenos">516</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-517"><a href="#DoubleMetaphone-517"><span class="linenos">517</span></a>                <span class="c1"># Dutch origin, e.g. &#39;school&#39;, &#39;schooner&#39;</span>
</span><span id="DoubleMetaphone-518"><a href="#DoubleMetaphone-518"><span class="linenos">518</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone-519"><a href="#DoubleMetaphone-519"><span class="linenos">519</span></a>                    <span class="s2">&quot;OO&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-520"><a href="#DoubleMetaphone-520"><span class="linenos">520</span></a>                    <span class="s2">&quot;ER&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-521"><a href="#DoubleMetaphone-521"><span class="linenos">521</span></a>                    <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-522"><a href="#DoubleMetaphone-522"><span class="linenos">522</span></a>                    <span class="s2">&quot;UY&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-523"><a href="#DoubleMetaphone-523"><span class="linenos">523</span></a>                    <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-524"><a href="#DoubleMetaphone-524"><span class="linenos">524</span></a>                    <span class="s2">&quot;EM&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-525"><a href="#DoubleMetaphone-525"><span class="linenos">525</span></a>                <span class="p">]:</span>
</span><span id="DoubleMetaphone-526"><a href="#DoubleMetaphone-526"><span class="linenos">526</span></a>                    <span class="c1"># &#39;Schermerhorn&#39;, &#39;Schenker&#39;</span>
</span><span id="DoubleMetaphone-527"><a href="#DoubleMetaphone-527"><span class="linenos">527</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ER&quot;</span><span class="p">,</span> <span class="s2">&quot;EN&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-528"><a href="#DoubleMetaphone-528"><span class="linenos">528</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-529"><a href="#DoubleMetaphone-529"><span class="linenos">529</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-530"><a href="#DoubleMetaphone-530"><span class="linenos">530</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-531"><a href="#DoubleMetaphone-531"><span class="linenos">531</span></a>
</span><span id="DoubleMetaphone-532"><a href="#DoubleMetaphone-532"><span class="linenos">532</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-533"><a href="#DoubleMetaphone-533"><span class="linenos">533</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-534"><a href="#DoubleMetaphone-534"><span class="linenos">534</span></a>                        <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone-535"><a href="#DoubleMetaphone-535"><span class="linenos">535</span></a>                        <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone-536"><a href="#DoubleMetaphone-536"><span class="linenos">536</span></a>                        <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;W&quot;</span>
</span><span id="DoubleMetaphone-537"><a href="#DoubleMetaphone-537"><span class="linenos">537</span></a>                    <span class="p">):</span>
</span><span id="DoubleMetaphone-538"><a href="#DoubleMetaphone-538"><span class="linenos">538</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-539"><a href="#DoubleMetaphone-539"><span class="linenos">539</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-540"><a href="#DoubleMetaphone-540"><span class="linenos">540</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-541"><a href="#DoubleMetaphone-541"><span class="linenos">541</span></a>
</span><span id="DoubleMetaphone-542"><a href="#DoubleMetaphone-542"><span class="linenos">542</span></a>            <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-543"><a href="#DoubleMetaphone-543"><span class="linenos">543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-544"><a href="#DoubleMetaphone-544"><span class="linenos">544</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-545"><a href="#DoubleMetaphone-545"><span class="linenos">545</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-546"><a href="#DoubleMetaphone-546"><span class="linenos">546</span></a>
</span><span id="DoubleMetaphone-547"><a href="#DoubleMetaphone-547"><span class="linenos">547</span></a>        <span class="c1"># French e.g. &#39;Resnais&#39;, &#39;Artois&#39;</span>
</span><span id="DoubleMetaphone-548"><a href="#DoubleMetaphone-548"><span class="linenos">548</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">end_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;OI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-549"><a href="#DoubleMetaphone-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-550"><a href="#DoubleMetaphone-550"><span class="linenos">550</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-551"><a href="#DoubleMetaphone-551"><span class="linenos">551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-552"><a href="#DoubleMetaphone-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-553"><a href="#DoubleMetaphone-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-554"><a href="#DoubleMetaphone-554"><span class="linenos">554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-555"><a href="#DoubleMetaphone-555"><span class="linenos">555</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-556"><a href="#DoubleMetaphone-556"><span class="linenos">556</span></a>
</span><span id="DoubleMetaphone-557"><a href="#DoubleMetaphone-557"><span class="linenos">557</span></a>    <span class="k">def</span> <span class="nf">process_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-558"><a href="#DoubleMetaphone-558"><span class="linenos">558</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-559"><a href="#DoubleMetaphone-559"><span class="linenos">559</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-560"><a href="#DoubleMetaphone-560"><span class="linenos">560</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-561"><a href="#DoubleMetaphone-561"><span class="linenos">561</span></a>
</span><span id="DoubleMetaphone-562"><a href="#DoubleMetaphone-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TION&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-563"><a href="#DoubleMetaphone-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-564"><a href="#DoubleMetaphone-564"><span class="linenos">564</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TIA&quot;</span><span class="p">,</span> <span class="s2">&quot;TCH&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-565"><a href="#DoubleMetaphone-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone-566"><a href="#DoubleMetaphone-566"><span class="linenos">566</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-567"><a href="#DoubleMetaphone-567"><span class="linenos">567</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TH&quot;</span>
</span><span id="DoubleMetaphone-568"><a href="#DoubleMetaphone-568"><span class="linenos">568</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TTH&quot;</span>
</span><span id="DoubleMetaphone-569"><a href="#DoubleMetaphone-569"><span class="linenos">569</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-570"><a href="#DoubleMetaphone-570"><span class="linenos">570</span></a>            <span class="c1"># &#39;Thomas&#39;, &#39;Thames&#39; or hard-sound Germanic</span>
</span><span id="DoubleMetaphone-571"><a href="#DoubleMetaphone-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-572"><a href="#DoubleMetaphone-572"><span class="linenos">572</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OM&quot;</span><span class="p">,</span> <span class="s2">&quot;AM&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-573"><a href="#DoubleMetaphone-573"><span class="linenos">573</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VON &quot;</span><span class="p">,</span> <span class="s2">&quot;VAN &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-574"><a href="#DoubleMetaphone-574"><span class="linenos">574</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone-575"><a href="#DoubleMetaphone-575"><span class="linenos">575</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone-576"><a href="#DoubleMetaphone-576"><span class="linenos">576</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-577"><a href="#DoubleMetaphone-577"><span class="linenos">577</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-578"><a href="#DoubleMetaphone-578"><span class="linenos">578</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-579"><a href="#DoubleMetaphone-579"><span class="linenos">579</span></a>
</span><span id="DoubleMetaphone-580"><a href="#DoubleMetaphone-580"><span class="linenos">580</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-581"><a href="#DoubleMetaphone-581"><span class="linenos">581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-582"><a href="#DoubleMetaphone-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-583"><a href="#DoubleMetaphone-583"><span class="linenos">583</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-584"><a href="#DoubleMetaphone-584"><span class="linenos">584</span></a>
</span><span id="DoubleMetaphone-585"><a href="#DoubleMetaphone-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">process_v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-586"><a href="#DoubleMetaphone-586"><span class="linenos">586</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-587"><a href="#DoubleMetaphone-587"><span class="linenos">587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-588"><a href="#DoubleMetaphone-588"><span class="linenos">588</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-589"><a href="#DoubleMetaphone-589"><span class="linenos">589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-590"><a href="#DoubleMetaphone-590"><span class="linenos">590</span></a>
</span><span id="DoubleMetaphone-591"><a href="#DoubleMetaphone-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">process_w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-592"><a href="#DoubleMetaphone-592"><span class="linenos">592</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-593"><a href="#DoubleMetaphone-593"><span class="linenos">593</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-594"><a href="#DoubleMetaphone-594"><span class="linenos">594</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-595"><a href="#DoubleMetaphone-595"><span class="linenos">595</span></a>
</span><span id="DoubleMetaphone-596"><a href="#DoubleMetaphone-596"><span class="linenos">596</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WR&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-597"><a href="#DoubleMetaphone-597"><span class="linenos">597</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone-598"><a href="#DoubleMetaphone-598"><span class="linenos">598</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-599"><a href="#DoubleMetaphone-599"><span class="linenos">599</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WH&quot;</span>
</span><span id="DoubleMetaphone-600"><a href="#DoubleMetaphone-600"><span class="linenos">600</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-601"><a href="#DoubleMetaphone-601"><span class="linenos">601</span></a>            <span class="c1"># Wasserman should match Vasserman</span>
</span><span id="DoubleMetaphone-602"><a href="#DoubleMetaphone-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone-603"><a href="#DoubleMetaphone-603"><span class="linenos">603</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-604"><a href="#DoubleMetaphone-604"><span class="linenos">604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-605"><a href="#DoubleMetaphone-605"><span class="linenos">605</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-606"><a href="#DoubleMetaphone-606"><span class="linenos">606</span></a>
</span><span id="DoubleMetaphone-607"><a href="#DoubleMetaphone-607"><span class="linenos">607</span></a>        <span class="c1"># Arnow should match Arnoff</span>
</span><span id="DoubleMetaphone-608"><a href="#DoubleMetaphone-608"><span class="linenos">608</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-609"><a href="#DoubleMetaphone-609"><span class="linenos">609</span></a>            <span class="p">(</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">)</span>
</span><span id="DoubleMetaphone-610"><a href="#DoubleMetaphone-610"><span class="linenos">610</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone-611"><a href="#DoubleMetaphone-611"><span class="linenos">611</span></a>            <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;EWSKI&quot;</span><span class="p">,</span> <span class="s2">&quot;EWSKY&quot;</span><span class="p">,</span> <span class="s2">&quot;OWSKI&quot;</span><span class="p">,</span> <span class="s2">&quot;OWSKY&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-612"><a href="#DoubleMetaphone-612"><span class="linenos">612</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone-613"><a href="#DoubleMetaphone-613"><span class="linenos">613</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-614"><a href="#DoubleMetaphone-614"><span class="linenos">614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-615"><a href="#DoubleMetaphone-615"><span class="linenos">615</span></a>
</span><span id="DoubleMetaphone-616"><a href="#DoubleMetaphone-616"><span class="linenos">616</span></a>        <span class="c1"># Polish e.g. &#39;Filipowicz&#39;</span>
</span><span id="DoubleMetaphone-617"><a href="#DoubleMetaphone-617"><span class="linenos">617</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WICZ&quot;</span><span class="p">,</span> <span class="s2">&quot;WITZ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-618"><a href="#DoubleMetaphone-618"><span class="linenos">618</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TS&quot;</span><span class="p">,</span> <span class="s2">&quot;FX&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="DoubleMetaphone-619"><a href="#DoubleMetaphone-619"><span class="linenos">619</span></a>
</span><span id="DoubleMetaphone-620"><a href="#DoubleMetaphone-620"><span class="linenos">620</span></a>        <span class="c1"># By default, &#39;W&#39; is skipped phonetically</span>
</span><span id="DoubleMetaphone-621"><a href="#DoubleMetaphone-621"><span class="linenos">621</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-622"><a href="#DoubleMetaphone-622"><span class="linenos">622</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-623"><a href="#DoubleMetaphone-623"><span class="linenos">623</span></a>
</span><span id="DoubleMetaphone-624"><a href="#DoubleMetaphone-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">process_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-625"><a href="#DoubleMetaphone-625"><span class="linenos">625</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone-626"><a href="#DoubleMetaphone-626"><span class="linenos">626</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone-627"><a href="#DoubleMetaphone-627"><span class="linenos">627</span></a>
</span><span id="DoubleMetaphone-628"><a href="#DoubleMetaphone-628"><span class="linenos">628</span></a>        <span class="c1"># French e.g. &#39;Breaux&#39;</span>
</span><span id="DoubleMetaphone-629"><a href="#DoubleMetaphone-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-630"><a href="#DoubleMetaphone-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-631"><a href="#DoubleMetaphone-631"><span class="linenos">631</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone-632"><a href="#DoubleMetaphone-632"><span class="linenos">632</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-633"><a href="#DoubleMetaphone-633"><span class="linenos">633</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;IAU&quot;</span><span class="p">,</span> <span class="s2">&quot;EAU&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-634"><a href="#DoubleMetaphone-634"><span class="linenos">634</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AU&quot;</span><span class="p">,</span> <span class="s2">&quot;OU&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone-635"><a href="#DoubleMetaphone-635"><span class="linenos">635</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone-636"><a href="#DoubleMetaphone-636"><span class="linenos">636</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-637"><a href="#DoubleMetaphone-637"><span class="linenos">637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KS&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-638"><a href="#DoubleMetaphone-638"><span class="linenos">638</span></a>
</span><span id="DoubleMetaphone-639"><a href="#DoubleMetaphone-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-640"><a href="#DoubleMetaphone-640"><span class="linenos">640</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-641"><a href="#DoubleMetaphone-641"><span class="linenos">641</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-642"><a href="#DoubleMetaphone-642"><span class="linenos">642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-643"><a href="#DoubleMetaphone-643"><span class="linenos">643</span></a>
</span><span id="DoubleMetaphone-644"><a href="#DoubleMetaphone-644"><span class="linenos">644</span></a>    <span class="k">def</span> <span class="nf">process_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone-645"><a href="#DoubleMetaphone-645"><span class="linenos">645</span></a>        <span class="c1"># Chinese pinyin e.g. &#39;zhao&#39;</span>
</span><span id="DoubleMetaphone-646"><a href="#DoubleMetaphone-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-647"><a href="#DoubleMetaphone-647"><span class="linenos">647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-648"><a href="#DoubleMetaphone-648"><span class="linenos">648</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone-649"><a href="#DoubleMetaphone-649"><span class="linenos">649</span></a>            <span class="s2">&quot;ZO&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-650"><a href="#DoubleMetaphone-650"><span class="linenos">650</span></a>            <span class="s2">&quot;ZI&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-651"><a href="#DoubleMetaphone-651"><span class="linenos">651</span></a>            <span class="s2">&quot;ZA&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone-652"><a href="#DoubleMetaphone-652"><span class="linenos">652</span></a>        <span class="p">]</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-653"><a href="#DoubleMetaphone-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone-654"><a href="#DoubleMetaphone-654"><span class="linenos">654</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-655"><a href="#DoubleMetaphone-655"><span class="linenos">655</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;T&quot;</span>
</span><span id="DoubleMetaphone-656"><a href="#DoubleMetaphone-656"><span class="linenos">656</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-657"><a href="#DoubleMetaphone-657"><span class="linenos">657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;TS&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone-658"><a href="#DoubleMetaphone-658"><span class="linenos">658</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-659"><a href="#DoubleMetaphone-659"><span class="linenos">659</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-660"><a href="#DoubleMetaphone-660"><span class="linenos">660</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone-661"><a href="#DoubleMetaphone-661"><span class="linenos">661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span>
</span><span id="DoubleMetaphone-662"><a href="#DoubleMetaphone-662"><span class="linenos">662</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span>
</span><span id="DoubleMetaphone-663"><a href="#DoubleMetaphone-663"><span class="linenos">663</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone-664"><a href="#DoubleMetaphone-664"><span class="linenos">664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-665"><a href="#DoubleMetaphone-665"><span class="linenos">665</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone-666"><a href="#DoubleMetaphone-666"><span class="linenos">666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone-667"><a href="#DoubleMetaphone-667"><span class="linenos">667</span></a>
</span><span id="DoubleMetaphone-668"><a href="#DoubleMetaphone-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</span><span id="DoubleMetaphone-669"><a href="#DoubleMetaphone-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">word</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="DoubleMetaphone-670"><a href="#DoubleMetaphone-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone-671"><a href="#DoubleMetaphone-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone-672"><a href="#DoubleMetaphone-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone-673"><a href="#DoubleMetaphone-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone-674"><a href="#DoubleMetaphone-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_word_start</span><span class="p">()</span>
</span><span id="DoubleMetaphone-675"><a href="#DoubleMetaphone-675"><span class="linenos">675</span></a>
</span><span id="DoubleMetaphone-676"><a href="#DoubleMetaphone-676"><span class="linenos">676</span></a>        <span class="c1"># Loop through chars in word.buffer</span>
</span><span id="DoubleMetaphone-677"><a href="#DoubleMetaphone-677"><span class="linenos">677</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone-678"><a href="#DoubleMetaphone-678"><span class="linenos">678</span></a>            <span class="n">character</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">]</span>
</span><span id="DoubleMetaphone-679"><a href="#DoubleMetaphone-679"><span class="linenos">679</span></a>
</span><span id="DoubleMetaphone-680"><a href="#DoubleMetaphone-680"><span class="linenos">680</span></a>            <span class="c1"># Vowels and spaces get special handling</span>
</span><span id="DoubleMetaphone-681"><a href="#DoubleMetaphone-681"><span class="linenos">681</span></a>            <span class="k">if</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone-682"><a href="#DoubleMetaphone-682"><span class="linenos">682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_vowel</span><span class="p">()</span>
</span><span id="DoubleMetaphone-683"><a href="#DoubleMetaphone-683"><span class="linenos">683</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-684"><a href="#DoubleMetaphone-684"><span class="linenos">684</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone-685"><a href="#DoubleMetaphone-685"><span class="linenos">685</span></a>                <span class="k">continue</span>
</span><span id="DoubleMetaphone-686"><a href="#DoubleMetaphone-686"><span class="linenos">686</span></a>
</span><span id="DoubleMetaphone-687"><a href="#DoubleMetaphone-687"><span class="linenos">687</span></a>            <span class="c1"># Other letters each have their own function</span>
</span><span id="DoubleMetaphone-688"><a href="#DoubleMetaphone-688"><span class="linenos">688</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-689"><a href="#DoubleMetaphone-689"><span class="linenos">689</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_b</span><span class="p">()</span>
</span><span id="DoubleMetaphone-690"><a href="#DoubleMetaphone-690"><span class="linenos">690</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-691"><a href="#DoubleMetaphone-691"><span class="linenos">691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_c</span><span class="p">()</span>
</span><span id="DoubleMetaphone-692"><a href="#DoubleMetaphone-692"><span class="linenos">692</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-693"><a href="#DoubleMetaphone-693"><span class="linenos">693</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_d</span><span class="p">()</span>
</span><span id="DoubleMetaphone-694"><a href="#DoubleMetaphone-694"><span class="linenos">694</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-695"><a href="#DoubleMetaphone-695"><span class="linenos">695</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_f</span><span class="p">()</span>
</span><span id="DoubleMetaphone-696"><a href="#DoubleMetaphone-696"><span class="linenos">696</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-697"><a href="#DoubleMetaphone-697"><span class="linenos">697</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_g</span><span class="p">()</span>
</span><span id="DoubleMetaphone-698"><a href="#DoubleMetaphone-698"><span class="linenos">698</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-699"><a href="#DoubleMetaphone-699"><span class="linenos">699</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_h</span><span class="p">()</span>
</span><span id="DoubleMetaphone-700"><a href="#DoubleMetaphone-700"><span class="linenos">700</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;J&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-701"><a href="#DoubleMetaphone-701"><span class="linenos">701</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_j</span><span class="p">()</span>
</span><span id="DoubleMetaphone-702"><a href="#DoubleMetaphone-702"><span class="linenos">702</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-703"><a href="#DoubleMetaphone-703"><span class="linenos">703</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_k</span><span class="p">()</span>
</span><span id="DoubleMetaphone-704"><a href="#DoubleMetaphone-704"><span class="linenos">704</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-705"><a href="#DoubleMetaphone-705"><span class="linenos">705</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_l</span><span class="p">()</span>
</span><span id="DoubleMetaphone-706"><a href="#DoubleMetaphone-706"><span class="linenos">706</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-707"><a href="#DoubleMetaphone-707"><span class="linenos">707</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_m</span><span class="p">()</span>
</span><span id="DoubleMetaphone-708"><a href="#DoubleMetaphone-708"><span class="linenos">708</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-709"><a href="#DoubleMetaphone-709"><span class="linenos">709</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_n</span><span class="p">()</span>
</span><span id="DoubleMetaphone-710"><a href="#DoubleMetaphone-710"><span class="linenos">710</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-711"><a href="#DoubleMetaphone-711"><span class="linenos">711</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_p</span><span class="p">()</span>
</span><span id="DoubleMetaphone-712"><a href="#DoubleMetaphone-712"><span class="linenos">712</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-713"><a href="#DoubleMetaphone-713"><span class="linenos">713</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_q</span><span class="p">()</span>
</span><span id="DoubleMetaphone-714"><a href="#DoubleMetaphone-714"><span class="linenos">714</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-715"><a href="#DoubleMetaphone-715"><span class="linenos">715</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_r</span><span class="p">()</span>
</span><span id="DoubleMetaphone-716"><a href="#DoubleMetaphone-716"><span class="linenos">716</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-717"><a href="#DoubleMetaphone-717"><span class="linenos">717</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_s</span><span class="p">()</span>
</span><span id="DoubleMetaphone-718"><a href="#DoubleMetaphone-718"><span class="linenos">718</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-719"><a href="#DoubleMetaphone-719"><span class="linenos">719</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_t</span><span class="p">()</span>
</span><span id="DoubleMetaphone-720"><a href="#DoubleMetaphone-720"><span class="linenos">720</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-721"><a href="#DoubleMetaphone-721"><span class="linenos">721</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_v</span><span class="p">()</span>
</span><span id="DoubleMetaphone-722"><a href="#DoubleMetaphone-722"><span class="linenos">722</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;W&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-723"><a href="#DoubleMetaphone-723"><span class="linenos">723</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_w</span><span class="p">()</span>
</span><span id="DoubleMetaphone-724"><a href="#DoubleMetaphone-724"><span class="linenos">724</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-725"><a href="#DoubleMetaphone-725"><span class="linenos">725</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_x</span><span class="p">()</span>
</span><span id="DoubleMetaphone-726"><a href="#DoubleMetaphone-726"><span class="linenos">726</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone-727"><a href="#DoubleMetaphone-727"><span class="linenos">727</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_z</span><span class="p">()</span>
</span><span id="DoubleMetaphone-728"><a href="#DoubleMetaphone-728"><span class="linenos">728</span></a>
</span><span id="DoubleMetaphone-729"><a href="#DoubleMetaphone-729"><span class="linenos">729</span></a>            <span class="c1"># Handle any residual unprocessed sound clusters</span>
</span><span id="DoubleMetaphone-730"><a href="#DoubleMetaphone-730"><span class="linenos">730</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DoubleMetaphone-731"><a href="#DoubleMetaphone-731"><span class="linenos">731</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-732"><a href="#DoubleMetaphone-732"><span class="linenos">732</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone-733"><a href="#DoubleMetaphone-733"><span class="linenos">733</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone-734"><a href="#DoubleMetaphone-734"><span class="linenos">734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DoubleMetaphone-735"><a href="#DoubleMetaphone-735"><span class="linenos">735</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="DoubleMetaphone-736"><a href="#DoubleMetaphone-736"><span class="linenos">736</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-737"><a href="#DoubleMetaphone-737"><span class="linenos">737</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone-738"><a href="#DoubleMetaphone-738"><span class="linenos">738</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="DoubleMetaphone-739"><a href="#DoubleMetaphone-739"><span class="linenos">739</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DoubleMetaphone-740"><a href="#DoubleMetaphone-740"><span class="linenos">740</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DoubleMetaphone-741"><a href="#DoubleMetaphone-741"><span class="linenos">741</span></a>
</span><span id="DoubleMetaphone-742"><a href="#DoubleMetaphone-742"><span class="linenos">742</span></a>        <span class="c1"># Standardize all representations to the dominant</span>
</span><span id="DoubleMetaphone-743"><a href="#DoubleMetaphone-743"><span class="linenos">743</span></a>        <span class="c1"># first sound clusters</span>
</span><span id="DoubleMetaphone-744"><a href="#DoubleMetaphone-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="DoubleMetaphone-745"><a href="#DoubleMetaphone-745"><span class="linenos">745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone-746"><a href="#DoubleMetaphone-746"><span class="linenos">746</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="DoubleMetaphone-747"><a href="#DoubleMetaphone-747"><span class="linenos">747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone-748"><a href="#DoubleMetaphone-748"><span class="linenos">748</span></a>
</span><span id="DoubleMetaphone-749"><a href="#DoubleMetaphone-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">:</span>
</span><span id="DoubleMetaphone-750"><a href="#DoubleMetaphone-750"><span class="linenos">750</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone-751"><a href="#DoubleMetaphone-751"><span class="linenos">751</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A Double Metaphone parsing object capable of performing the double
coding algorithm on a given input string.</p>
</div>


                            <div id="DoubleMetaphone.check_word_start" class="classattr">
                                        <input id="DoubleMetaphone.check_word_start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_word_start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.check_word_start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.check_word_start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.check_word_start-42"><a href="#DoubleMetaphone.check_word_start-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">check_word_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.check_word_start-43"><a href="#DoubleMetaphone.check_word_start-43"><span class="linenos">43</span></a>        <span class="c1"># Skip silent letters when they start a word (because they&#39;re not</span>
</span><span id="DoubleMetaphone.check_word_start-44"><a href="#DoubleMetaphone.check_word_start-44"><span class="linenos">44</span></a>        <span class="c1"># phonetic if they&#39;re silent)</span>
</span><span id="DoubleMetaphone.check_word_start-45"><a href="#DoubleMetaphone.check_word_start-45"><span class="linenos">45</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">get_letters</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">SILENT_STARTERS</span><span class="p">:</span>
</span><span id="DoubleMetaphone.check_word_start-46"><a href="#DoubleMetaphone.check_word_start-46"><span class="linenos">46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone.check_word_start-47"><a href="#DoubleMetaphone.check_word_start-47"><span class="linenos">47</span></a>        <span class="c1"># Starting with &#39;X&#39; frequently pronounced &#39;Z&#39; e.g. &#39;Xavier&#39;</span>
</span><span id="DoubleMetaphone.check_word_start-48"><a href="#DoubleMetaphone.check_word_start-48"><span class="linenos">48</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">get_letters</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.check_word_start-49"><a href="#DoubleMetaphone.check_word_start-49"><span class="linenos">49</span></a>            <span class="c1"># &#39;Z&#39; maps to &#39;S&#39;</span>
</span><span id="DoubleMetaphone.check_word_start-50"><a href="#DoubleMetaphone.check_word_start-50"><span class="linenos">50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;S&quot;</span>
</span><span id="DoubleMetaphone.check_word_start-51"><a href="#DoubleMetaphone.check_word_start-51"><span class="linenos">51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_vowel" class="classattr">
                                        <input id="DoubleMetaphone.process_vowel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_vowel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_vowel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_vowel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_vowel-53"><a href="#DoubleMetaphone.process_vowel-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">process_vowel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_vowel-54"><a href="#DoubleMetaphone.process_vowel-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_vowel-55"><a href="#DoubleMetaphone.process_vowel-55"><span class="linenos">55</span></a>
</span><span id="DoubleMetaphone.process_vowel-56"><a href="#DoubleMetaphone.process_vowel-56"><span class="linenos">56</span></a>        <span class="c1"># All starting vowels map to &#39;A&#39;</span>
</span><span id="DoubleMetaphone.process_vowel-57"><a href="#DoubleMetaphone.process_vowel-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_vowel-58"><a href="#DoubleMetaphone.process_vowel-58"><span class="linenos">58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_b" class="classattr">
                                        <input id="DoubleMetaphone.process_b-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_b</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_b-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_b"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_b-60"><a href="#DoubleMetaphone.process_b-60"><span class="linenos">60</span></a>    <span class="k">def</span> <span class="nf">process_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_b-61"><a href="#DoubleMetaphone.process_b-61"><span class="linenos">61</span></a>        <span class="c1"># &quot;-mb&quot;, e.g., &quot;dumb&quot;, already accounted for, see &#39;M&#39;</span>
</span><span id="DoubleMetaphone.process_b-62"><a href="#DoubleMetaphone.process_b-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_b-63"><a href="#DoubleMetaphone.process_b-63"><span class="linenos">63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_b-64"><a href="#DoubleMetaphone.process_b-64"><span class="linenos">64</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_b-65"><a href="#DoubleMetaphone.process_b-65"><span class="linenos">65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_c" class="classattr">
                                        <input id="DoubleMetaphone.process_c-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_c</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_c-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_c"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_c-67"><a href="#DoubleMetaphone.process_c-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">process_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-68"><a href="#DoubleMetaphone.process_c-68"><span class="linenos"> 68</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_c-69"><a href="#DoubleMetaphone.process_c-69"><span class="linenos"> 69</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_c-70"><a href="#DoubleMetaphone.process_c-70"><span class="linenos"> 70</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_c-71"><a href="#DoubleMetaphone.process_c-71"><span class="linenos"> 71</span></a>
</span><span id="DoubleMetaphone.process_c-72"><a href="#DoubleMetaphone.process_c-72"><span class="linenos"> 72</span></a>        <span class="c1"># Handle some germanic linguistics</span>
</span><span id="DoubleMetaphone.process_c-73"><a href="#DoubleMetaphone.process_c-73"><span class="linenos"> 73</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-74"><a href="#DoubleMetaphone.process_c-74"><span class="linenos"> 74</span></a>            <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone.process_c-75"><a href="#DoubleMetaphone.process_c-75"><span class="linenos"> 75</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone.process_c-76"><a href="#DoubleMetaphone.process_c-76"><span class="linenos"> 76</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACH&quot;</span>
</span><span id="DoubleMetaphone.process_c-77"><a href="#DoubleMetaphone.process_c-77"><span class="linenos"> 77</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-78"><a href="#DoubleMetaphone.process_c-78"><span class="linenos"> 78</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-79"><a href="#DoubleMetaphone.process_c-79"><span class="linenos"> 79</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-80"><a href="#DoubleMetaphone.process_c-80"><span class="linenos"> 80</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BACHER&quot;</span><span class="p">,</span> <span class="s2">&quot;MACHER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-81"><a href="#DoubleMetaphone.process_c-81"><span class="linenos"> 81</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-82"><a href="#DoubleMetaphone.process_c-82"><span class="linenos"> 82</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-83"><a href="#DoubleMetaphone.process_c-83"><span class="linenos"> 83</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-84"><a href="#DoubleMetaphone.process_c-84"><span class="linenos"> 84</span></a>
</span><span id="DoubleMetaphone.process_c-85"><a href="#DoubleMetaphone.process_c-85"><span class="linenos"> 85</span></a>        <span class="c1"># Special case &#39;CAESAR&#39;</span>
</span><span id="DoubleMetaphone.process_c-86"><a href="#DoubleMetaphone.process_c-86"><span class="linenos"> 86</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-87"><a href="#DoubleMetaphone.process_c-87"><span class="linenos"> 87</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_c-88"><a href="#DoubleMetaphone.process_c-88"><span class="linenos"> 88</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CAESAR&quot;</span>
</span><span id="DoubleMetaphone.process_c-89"><a href="#DoubleMetaphone.process_c-89"><span class="linenos"> 89</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-90"><a href="#DoubleMetaphone.process_c-90"><span class="linenos"> 90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-91"><a href="#DoubleMetaphone.process_c-91"><span class="linenos"> 91</span></a>
</span><span id="DoubleMetaphone.process_c-92"><a href="#DoubleMetaphone.process_c-92"><span class="linenos"> 92</span></a>        <span class="c1"># Italian &#39;chianti&#39;</span>
</span><span id="DoubleMetaphone.process_c-93"><a href="#DoubleMetaphone.process_c-93"><span class="linenos"> 93</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHIA&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-94"><a href="#DoubleMetaphone.process_c-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-95"><a href="#DoubleMetaphone.process_c-95"><span class="linenos"> 95</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CH&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-96"><a href="#DoubleMetaphone.process_c-96"><span class="linenos"> 96</span></a>            <span class="c1"># e.g. &#39;michael&#39;</span>
</span><span id="DoubleMetaphone.process_c-97"><a href="#DoubleMetaphone.process_c-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHAE&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-98"><a href="#DoubleMetaphone.process_c-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-99"><a href="#DoubleMetaphone.process_c-99"><span class="linenos"> 99</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-100"><a href="#DoubleMetaphone.process_c-100"><span class="linenos">100</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_c-101"><a href="#DoubleMetaphone.process_c-101"><span class="linenos">101</span></a>                <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-102"><a href="#DoubleMetaphone.process_c-102"><span class="linenos">102</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HARAC&quot;</span><span class="p">,</span> <span class="s2">&quot;HARIS&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-103"><a href="#DoubleMetaphone.process_c-103"><span class="linenos">103</span></a>                    <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-104"><a href="#DoubleMetaphone.process_c-104"><span class="linenos">104</span></a>                    <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HOR&quot;</span><span class="p">,</span> <span class="s2">&quot;HYM&quot;</span><span class="p">,</span> <span class="s2">&quot;HIA&quot;</span><span class="p">,</span> <span class="s2">&quot;HEM&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-105"><a href="#DoubleMetaphone.process_c-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-106"><a href="#DoubleMetaphone.process_c-106"><span class="linenos">106</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;CHORE&quot;</span>
</span><span id="DoubleMetaphone.process_c-107"><a href="#DoubleMetaphone.process_c-107"><span class="linenos">107</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-108"><a href="#DoubleMetaphone.process_c-108"><span class="linenos">108</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-109"><a href="#DoubleMetaphone.process_c-109"><span class="linenos">109</span></a>
</span><span id="DoubleMetaphone.process_c-110"><a href="#DoubleMetaphone.process_c-110"><span class="linenos">110</span></a>            <span class="c1"># Germanic, greek, or other phonetic &#39;ch&#39; for &#39;kh&#39; sound</span>
</span><span id="DoubleMetaphone.process_c-111"><a href="#DoubleMetaphone.process_c-111"><span class="linenos">111</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-112"><a href="#DoubleMetaphone.process_c-112"><span class="linenos">112</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VAN &quot;</span><span class="p">,</span> <span class="s2">&quot;VON &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-113"><a href="#DoubleMetaphone.process_c-113"><span class="linenos">113</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone.process_c-114"><a href="#DoubleMetaphone.process_c-114"><span class="linenos">114</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ORCHES&quot;</span><span class="p">,</span> <span class="s2">&quot;ARCHIT&quot;</span><span class="p">,</span> <span class="s2">&quot;ORCHID&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-115"><a href="#DoubleMetaphone.process_c-115"><span class="linenos">115</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-116"><a href="#DoubleMetaphone.process_c-116"><span class="linenos">116</span></a>                <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-117"><a href="#DoubleMetaphone.process_c-117"><span class="linenos">117</span></a>                    <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-118"><a href="#DoubleMetaphone.process_c-118"><span class="linenos">118</span></a>                        <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-119"><a href="#DoubleMetaphone.process_c-119"><span class="linenos">119</span></a>                        <span class="ow">or</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_c-120"><a href="#DoubleMetaphone.process_c-120"><span class="linenos">120</span></a>                    <span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-121"><a href="#DoubleMetaphone.process_c-121"><span class="linenos">121</span></a>                    <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-122"><a href="#DoubleMetaphone.process_c-122"><span class="linenos">122</span></a>                        <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-123"><a href="#DoubleMetaphone.process_c-123"><span class="linenos">123</span></a>                        <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-124"><a href="#DoubleMetaphone.process_c-124"><span class="linenos">124</span></a>                    <span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-125"><a href="#DoubleMetaphone.process_c-125"><span class="linenos">125</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-126"><a href="#DoubleMetaphone.process_c-126"><span class="linenos">126</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-127"><a href="#DoubleMetaphone.process_c-127"><span class="linenos">127</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-128"><a href="#DoubleMetaphone.process_c-128"><span class="linenos">128</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-129"><a href="#DoubleMetaphone.process_c-129"><span class="linenos">129</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-130"><a href="#DoubleMetaphone.process_c-130"><span class="linenos">130</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MC&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-131"><a href="#DoubleMetaphone.process_c-131"><span class="linenos">131</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-132"><a href="#DoubleMetaphone.process_c-132"><span class="linenos">132</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-133"><a href="#DoubleMetaphone.process_c-133"><span class="linenos">133</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-134"><a href="#DoubleMetaphone.process_c-134"><span class="linenos">134</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-135"><a href="#DoubleMetaphone.process_c-135"><span class="linenos">135</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-136"><a href="#DoubleMetaphone.process_c-136"><span class="linenos">136</span></a>
</span><span id="DoubleMetaphone.process_c-137"><a href="#DoubleMetaphone.process_c-137"><span class="linenos">137</span></a>        <span class="c1"># e.g, &#39;czerny&#39;</span>
</span><span id="DoubleMetaphone.process_c-138"><a href="#DoubleMetaphone.process_c-138"><span class="linenos">138</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-139"><a href="#DoubleMetaphone.process_c-139"><span class="linenos">139</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CZ&quot;</span>
</span><span id="DoubleMetaphone.process_c-140"><a href="#DoubleMetaphone.process_c-140"><span class="linenos">140</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;WICZ&quot;</span>
</span><span id="DoubleMetaphone.process_c-141"><a href="#DoubleMetaphone.process_c-141"><span class="linenos">141</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-142"><a href="#DoubleMetaphone.process_c-142"><span class="linenos">142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-143"><a href="#DoubleMetaphone.process_c-143"><span class="linenos">143</span></a>
</span><span id="DoubleMetaphone.process_c-144"><a href="#DoubleMetaphone.process_c-144"><span class="linenos">144</span></a>        <span class="c1"># e.g., &#39;focaccia&#39;</span>
</span><span id="DoubleMetaphone.process_c-145"><a href="#DoubleMetaphone.process_c-145"><span class="linenos">145</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CIA&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-146"><a href="#DoubleMetaphone.process_c-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-147"><a href="#DoubleMetaphone.process_c-147"><span class="linenos">147</span></a>
</span><span id="DoubleMetaphone.process_c-148"><a href="#DoubleMetaphone.process_c-148"><span class="linenos">148</span></a>        <span class="c1"># Double &#39;C&#39;, but not if e.g. &#39;McClellan&#39;</span>
</span><span id="DoubleMetaphone.process_c-149"><a href="#DoubleMetaphone.process_c-149"><span class="linenos">149</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-150"><a href="#DoubleMetaphone.process_c-150"><span class="linenos">150</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span>
</span><span id="DoubleMetaphone.process_c-151"><a href="#DoubleMetaphone.process_c-151"><span class="linenos">151</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-152"><a href="#DoubleMetaphone.process_c-152"><span class="linenos">152</span></a>            <span class="c1"># &#39;bellocchio&#39; but not &#39;bacchus&#39;</span>
</span><span id="DoubleMetaphone.process_c-153"><a href="#DoubleMetaphone.process_c-153"><span class="linenos">153</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-154"><a href="#DoubleMetaphone.process_c-154"><span class="linenos">154</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_c-155"><a href="#DoubleMetaphone.process_c-155"><span class="linenos">155</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;HU&quot;</span>
</span><span id="DoubleMetaphone.process_c-156"><a href="#DoubleMetaphone.process_c-156"><span class="linenos">156</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_c-157"><a href="#DoubleMetaphone.process_c-157"><span class="linenos">157</span></a>                <span class="c1"># &#39;accident&#39;, &#39;accede&#39; &#39;succeed&#39;</span>
</span><span id="DoubleMetaphone.process_c-158"><a href="#DoubleMetaphone.process_c-158"><span class="linenos">158</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_c-159"><a href="#DoubleMetaphone.process_c-159"><span class="linenos">159</span></a>                    <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span>
</span><span id="DoubleMetaphone.process_c-160"><a href="#DoubleMetaphone.process_c-160"><span class="linenos">160</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;UCCEE&quot;</span><span class="p">,</span> <span class="s2">&quot;UCCES&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-161"><a href="#DoubleMetaphone.process_c-161"><span class="linenos">161</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KS&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-162"><a href="#DoubleMetaphone.process_c-162"><span class="linenos">162</span></a>
</span><span id="DoubleMetaphone.process_c-163"><a href="#DoubleMetaphone.process_c-163"><span class="linenos">163</span></a>                <span class="c1"># &#39;bacci&#39;, &#39;bertucci&#39;, other italian</span>
</span><span id="DoubleMetaphone.process_c-164"><a href="#DoubleMetaphone.process_c-164"><span class="linenos">164</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-165"><a href="#DoubleMetaphone.process_c-165"><span class="linenos">165</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-166"><a href="#DoubleMetaphone.process_c-166"><span class="linenos">166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-167"><a href="#DoubleMetaphone.process_c-167"><span class="linenos">167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-168"><a href="#DoubleMetaphone.process_c-168"><span class="linenos">168</span></a>
</span><span id="DoubleMetaphone.process_c-169"><a href="#DoubleMetaphone.process_c-169"><span class="linenos">169</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CK&quot;</span><span class="p">,</span> <span class="s2">&quot;CG&quot;</span><span class="p">,</span> <span class="s2">&quot;CQ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-170"><a href="#DoubleMetaphone.process_c-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-171"><a href="#DoubleMetaphone.process_c-171"><span class="linenos">171</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CI&quot;</span><span class="p">,</span> <span class="s2">&quot;CE&quot;</span><span class="p">,</span> <span class="s2">&quot;CY&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-172"><a href="#DoubleMetaphone.process_c-172"><span class="linenos">172</span></a>            <span class="c1"># Italian vs. English</span>
</span><span id="DoubleMetaphone.process_c-173"><a href="#DoubleMetaphone.process_c-173"><span class="linenos">173</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CIO&quot;</span><span class="p">,</span> <span class="s2">&quot;CIE&quot;</span><span class="p">,</span> <span class="s2">&quot;CIA&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-174"><a href="#DoubleMetaphone.process_c-174"><span class="linenos">174</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-175"><a href="#DoubleMetaphone.process_c-175"><span class="linenos">175</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-176"><a href="#DoubleMetaphone.process_c-176"><span class="linenos">176</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-177"><a href="#DoubleMetaphone.process_c-177"><span class="linenos">177</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-178"><a href="#DoubleMetaphone.process_c-178"><span class="linenos">178</span></a>            <span class="c1"># Name set in &#39;mac caffrey&#39;, &#39;mac gregor&#39;</span>
</span><span id="DoubleMetaphone.process_c-179"><a href="#DoubleMetaphone.process_c-179"><span class="linenos">179</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot; C&quot;</span><span class="p">,</span> <span class="s2">&quot; Q&quot;</span><span class="p">,</span> <span class="s2">&quot; G&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-180"><a href="#DoubleMetaphone.process_c-180"><span class="linenos">180</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-181"><a href="#DoubleMetaphone.process_c-181"><span class="linenos">181</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-182"><a href="#DoubleMetaphone.process_c-182"><span class="linenos">182</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone.process_c-183"><a href="#DoubleMetaphone.process_c-183"><span class="linenos">183</span></a>                    <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span>
</span><span id="DoubleMetaphone.process_c-184"><a href="#DoubleMetaphone.process_c-184"><span class="linenos">184</span></a>                <span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CE&quot;</span><span class="p">,</span> <span class="s2">&quot;CI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_c-185"><a href="#DoubleMetaphone.process_c-185"><span class="linenos">185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_c-186"><a href="#DoubleMetaphone.process_c-186"><span class="linenos">186</span></a>
</span><span id="DoubleMetaphone.process_c-187"><a href="#DoubleMetaphone.process_c-187"><span class="linenos">187</span></a>                <span class="c1"># Default sound for &#39;C&#39;</span>
</span><span id="DoubleMetaphone.process_c-188"><a href="#DoubleMetaphone.process_c-188"><span class="linenos">188</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_c-189"><a href="#DoubleMetaphone.process_c-189"><span class="linenos">189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_d" class="classattr">
                                        <input id="DoubleMetaphone.process_d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_d-191"><a href="#DoubleMetaphone.process_d-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">process_d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_d-192"><a href="#DoubleMetaphone.process_d-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DG&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_d-193"><a href="#DoubleMetaphone.process_d-193"><span class="linenos">193</span></a>            <span class="c1"># e.g. &#39;edge&#39;</span>
</span><span id="DoubleMetaphone.process_d-194"><a href="#DoubleMetaphone.process_d-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_d-195"><a href="#DoubleMetaphone.process_d-195"><span class="linenos">195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_d-196"><a href="#DoubleMetaphone.process_d-196"><span class="linenos">196</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_d-197"><a href="#DoubleMetaphone.process_d-197"><span class="linenos">197</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TK&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_d-198"><a href="#DoubleMetaphone.process_d-198"><span class="linenos">198</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DT&quot;</span><span class="p">,</span> <span class="s2">&quot;DD&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_d-199"><a href="#DoubleMetaphone.process_d-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_d-200"><a href="#DoubleMetaphone.process_d-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_d-201"><a href="#DoubleMetaphone.process_d-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_f" class="classattr">
                                        <input id="DoubleMetaphone.process_f-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_f</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_f-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_f"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_f-203"><a href="#DoubleMetaphone.process_f-203"><span class="linenos">203</span></a>    <span class="k">def</span> <span class="nf">process_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_f-204"><a href="#DoubleMetaphone.process_f-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_f-205"><a href="#DoubleMetaphone.process_f-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_f-206"><a href="#DoubleMetaphone.process_f-206"><span class="linenos">206</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_f-207"><a href="#DoubleMetaphone.process_f-207"><span class="linenos">207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_g" class="classattr">
                                        <input id="DoubleMetaphone.process_g-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_g</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_g-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_g"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_g-209"><a href="#DoubleMetaphone.process_g-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">process_g</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-210"><a href="#DoubleMetaphone.process_g-210"><span class="linenos">210</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_g-211"><a href="#DoubleMetaphone.process_g-211"><span class="linenos">211</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_g-212"><a href="#DoubleMetaphone.process_g-212"><span class="linenos">212</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_g-213"><a href="#DoubleMetaphone.process_g-213"><span class="linenos">213</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-214"><a href="#DoubleMetaphone.process_g-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-215"><a href="#DoubleMetaphone.process_g-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-216"><a href="#DoubleMetaphone.process_g-216"><span class="linenos">216</span></a>            <span class="k">elif</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-217"><a href="#DoubleMetaphone.process_g-217"><span class="linenos">217</span></a>                <span class="c1"># &#39;Ghislane&#39;, &#39;Ghiradelli&#39;</span>
</span><span id="DoubleMetaphone.process_g-218"><a href="#DoubleMetaphone.process_g-218"><span class="linenos">218</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-219"><a href="#DoubleMetaphone.process_g-219"><span class="linenos">219</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-220"><a href="#DoubleMetaphone.process_g-220"><span class="linenos">220</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-221"><a href="#DoubleMetaphone.process_g-221"><span class="linenos">221</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-222"><a href="#DoubleMetaphone.process_g-222"><span class="linenos">222</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-223"><a href="#DoubleMetaphone.process_g-223"><span class="linenos">223</span></a>
</span><span id="DoubleMetaphone.process_g-224"><a href="#DoubleMetaphone.process_g-224"><span class="linenos">224</span></a>            <span class="c1"># Parker&#39;s rule for e.g., &#39;Hugh&#39;</span>
</span><span id="DoubleMetaphone.process_g-225"><a href="#DoubleMetaphone.process_g-225"><span class="linenos">225</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-226"><a href="#DoubleMetaphone.process_g-226"><span class="linenos">226</span></a>                <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-227"><a href="#DoubleMetaphone.process_g-227"><span class="linenos">227</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-228"><a href="#DoubleMetaphone.process_g-228"><span class="linenos">228</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-229"><a href="#DoubleMetaphone.process_g-229"><span class="linenos">229</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-230"><a href="#DoubleMetaphone.process_g-230"><span class="linenos">230</span></a>                <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-231"><a href="#DoubleMetaphone.process_g-231"><span class="linenos">231</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-232"><a href="#DoubleMetaphone.process_g-232"><span class="linenos">232</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-233"><a href="#DoubleMetaphone.process_g-233"><span class="linenos">233</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-234"><a href="#DoubleMetaphone.process_g-234"><span class="linenos">234</span></a>                <span class="ow">or</span> <span class="p">(</span><span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">])</span>
</span><span id="DoubleMetaphone.process_g-235"><a href="#DoubleMetaphone.process_g-235"><span class="linenos">235</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-236"><a href="#DoubleMetaphone.process_g-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-237"><a href="#DoubleMetaphone.process_g-237"><span class="linenos">237</span></a>
</span><span id="DoubleMetaphone.process_g-238"><a href="#DoubleMetaphone.process_g-238"><span class="linenos">238</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-239"><a href="#DoubleMetaphone.process_g-239"><span class="linenos">239</span></a>                <span class="c1"># e.g., &#39;laugh&#39;, &#39;McLaughlin&#39;, &#39;cough&#39;, &#39;gough&#39;, &#39;rough&#39;, &#39;tough&#39;</span>
</span><span id="DoubleMetaphone.process_g-240"><a href="#DoubleMetaphone.process_g-240"><span class="linenos">240</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-241"><a href="#DoubleMetaphone.process_g-241"><span class="linenos">241</span></a>                    <span class="n">position</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-242"><a href="#DoubleMetaphone.process_g-242"><span class="linenos">242</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;U&quot;</span>
</span><span id="DoubleMetaphone.process_g-243"><a href="#DoubleMetaphone.process_g-243"><span class="linenos">243</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-244"><a href="#DoubleMetaphone.process_g-244"><span class="linenos">244</span></a>                <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-245"><a href="#DoubleMetaphone.process_g-245"><span class="linenos">245</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-246"><a href="#DoubleMetaphone.process_g-246"><span class="linenos">246</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-247"><a href="#DoubleMetaphone.process_g-247"><span class="linenos">247</span></a>                    <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-248"><a href="#DoubleMetaphone.process_g-248"><span class="linenos">248</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-249"><a href="#DoubleMetaphone.process_g-249"><span class="linenos">249</span></a>
</span><span id="DoubleMetaphone.process_g-250"><a href="#DoubleMetaphone.process_g-250"><span class="linenos">250</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-251"><a href="#DoubleMetaphone.process_g-251"><span class="linenos">251</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-252"><a href="#DoubleMetaphone.process_g-252"><span class="linenos">252</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-253"><a href="#DoubleMetaphone.process_g-253"><span class="linenos">253</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone.process_g-254"><a href="#DoubleMetaphone.process_g-254"><span class="linenos">254</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_g-255"><a href="#DoubleMetaphone.process_g-255"><span class="linenos">255</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-256"><a href="#DoubleMetaphone.process_g-256"><span class="linenos">256</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-257"><a href="#DoubleMetaphone.process_g-257"><span class="linenos">257</span></a>
</span><span id="DoubleMetaphone.process_g-258"><a href="#DoubleMetaphone.process_g-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-259"><a href="#DoubleMetaphone.process_g-259"><span class="linenos">259</span></a>                <span class="c1"># Not e.g. &#39;cagney&#39;</span>
</span><span id="DoubleMetaphone.process_g-260"><a href="#DoubleMetaphone.process_g-260"><span class="linenos">260</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-261"><a href="#DoubleMetaphone.process_g-261"><span class="linenos">261</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;EY&quot;</span>
</span><span id="DoubleMetaphone.process_g-262"><a href="#DoubleMetaphone.process_g-262"><span class="linenos">262</span></a>                    <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Y&quot;</span>
</span><span id="DoubleMetaphone.process_g-263"><a href="#DoubleMetaphone.process_g-263"><span class="linenos">263</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_g-264"><a href="#DoubleMetaphone.process_g-264"><span class="linenos">264</span></a>                <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-265"><a href="#DoubleMetaphone.process_g-265"><span class="linenos">265</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-266"><a href="#DoubleMetaphone.process_g-266"><span class="linenos">266</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-267"><a href="#DoubleMetaphone.process_g-267"><span class="linenos">267</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KN&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-268"><a href="#DoubleMetaphone.process_g-268"><span class="linenos">268</span></a>
</span><span id="DoubleMetaphone.process_g-269"><a href="#DoubleMetaphone.process_g-269"><span class="linenos">269</span></a>        <span class="c1"># e.g. &#39;Tagliaro&#39;</span>
</span><span id="DoubleMetaphone.process_g-270"><a href="#DoubleMetaphone.process_g-270"><span class="linenos">270</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-271"><a href="#DoubleMetaphone.process_g-271"><span class="linenos">271</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LI&quot;</span>
</span><span id="DoubleMetaphone.process_g-272"><a href="#DoubleMetaphone.process_g-272"><span class="linenos">272</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_g-273"><a href="#DoubleMetaphone.process_g-273"><span class="linenos">273</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-274"><a href="#DoubleMetaphone.process_g-274"><span class="linenos">274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KL&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-275"><a href="#DoubleMetaphone.process_g-275"><span class="linenos">275</span></a>
</span><span id="DoubleMetaphone.process_g-276"><a href="#DoubleMetaphone.process_g-276"><span class="linenos">276</span></a>        <span class="c1"># -ges-,-gep-,-gel-, -gie- at beginning</span>
</span><span id="DoubleMetaphone.process_g-277"><a href="#DoubleMetaphone.process_g-277"><span class="linenos">277</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-278"><a href="#DoubleMetaphone.process_g-278"><span class="linenos">278</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span>
</span><span id="DoubleMetaphone.process_g-279"><a href="#DoubleMetaphone.process_g-279"><span class="linenos">279</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-280"><a href="#DoubleMetaphone.process_g-280"><span class="linenos">280</span></a>            <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ES&quot;</span><span class="p">,</span> <span class="s2">&quot;EP&quot;</span><span class="p">,</span> <span class="s2">&quot;EB&quot;</span><span class="p">,</span> <span class="s2">&quot;EL&quot;</span><span class="p">,</span> <span class="s2">&quot;EY&quot;</span><span class="p">,</span> <span class="s2">&quot;IB&quot;</span><span class="p">,</span> <span class="s2">&quot;IL&quot;</span><span class="p">,</span> <span class="s2">&quot;IN&quot;</span><span class="p">,</span> <span class="s2">&quot;IE&quot;</span><span class="p">,</span> <span class="s2">&quot;EI&quot;</span><span class="p">,</span> <span class="s2">&quot;ER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-281"><a href="#DoubleMetaphone.process_g-281"><span class="linenos">281</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-282"><a href="#DoubleMetaphone.process_g-282"><span class="linenos">282</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-283"><a href="#DoubleMetaphone.process_g-283"><span class="linenos">283</span></a>
</span><span id="DoubleMetaphone.process_g-284"><a href="#DoubleMetaphone.process_g-284"><span class="linenos">284</span></a>        <span class="c1"># -ger-,  -gy-</span>
</span><span id="DoubleMetaphone.process_g-285"><a href="#DoubleMetaphone.process_g-285"><span class="linenos">285</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-286"><a href="#DoubleMetaphone.process_g-286"><span class="linenos">286</span></a>            <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ER&quot;</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-287"><a href="#DoubleMetaphone.process_g-287"><span class="linenos">287</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-288"><a href="#DoubleMetaphone.process_g-288"><span class="linenos">288</span></a>            <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DANGER&quot;</span><span class="p">,</span> <span class="s2">&quot;RANGER&quot;</span><span class="p">,</span> <span class="s2">&quot;MANGER&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-289"><a href="#DoubleMetaphone.process_g-289"><span class="linenos">289</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-290"><a href="#DoubleMetaphone.process_g-290"><span class="linenos">290</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RGY&quot;</span><span class="p">,</span> <span class="s2">&quot;OGY&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-291"><a href="#DoubleMetaphone.process_g-291"><span class="linenos">291</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-292"><a href="#DoubleMetaphone.process_g-292"><span class="linenos">292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-293"><a href="#DoubleMetaphone.process_g-293"><span class="linenos">293</span></a>
</span><span id="DoubleMetaphone.process_g-294"><a href="#DoubleMetaphone.process_g-294"><span class="linenos">294</span></a>        <span class="c1"># Italian e.g, &#39;Biaggi&#39;</span>
</span><span id="DoubleMetaphone.process_g-295"><a href="#DoubleMetaphone.process_g-295"><span class="linenos">295</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone.process_g-296"><a href="#DoubleMetaphone.process_g-296"><span class="linenos">296</span></a>            <span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span>
</span><span id="DoubleMetaphone.process_g-297"><a href="#DoubleMetaphone.process_g-297"><span class="linenos">297</span></a>        <span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AGGI&quot;</span><span class="p">,</span> <span class="s2">&quot;OGGI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_g-298"><a href="#DoubleMetaphone.process_g-298"><span class="linenos">298</span></a>            <span class="c1"># Germanic</span>
</span><span id="DoubleMetaphone.process_g-299"><a href="#DoubleMetaphone.process_g-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_g-300"><a href="#DoubleMetaphone.process_g-300"><span class="linenos">300</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VON &quot;</span><span class="p">,</span> <span class="s2">&quot;VAN &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_g-301"><a href="#DoubleMetaphone.process_g-301"><span class="linenos">301</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone.process_g-302"><a href="#DoubleMetaphone.process_g-302"><span class="linenos">302</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ET&quot;</span>
</span><span id="DoubleMetaphone.process_g-303"><a href="#DoubleMetaphone.process_g-303"><span class="linenos">303</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_g-304"><a href="#DoubleMetaphone.process_g-304"><span class="linenos">304</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-305"><a href="#DoubleMetaphone.process_g-305"><span class="linenos">305</span></a>
</span><span id="DoubleMetaphone.process_g-306"><a href="#DoubleMetaphone.process_g-306"><span class="linenos">306</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-307"><a href="#DoubleMetaphone.process_g-307"><span class="linenos">307</span></a>                <span class="c1"># Always soft if following the French ending</span>
</span><span id="DoubleMetaphone.process_g-308"><a href="#DoubleMetaphone.process_g-308"><span class="linenos">308</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IER &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-309"><a href="#DoubleMetaphone.process_g-309"><span class="linenos">309</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-310"><a href="#DoubleMetaphone.process_g-310"><span class="linenos">310</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-311"><a href="#DoubleMetaphone.process_g-311"><span class="linenos">311</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-312"><a href="#DoubleMetaphone.process_g-312"><span class="linenos">312</span></a>
</span><span id="DoubleMetaphone.process_g-313"><a href="#DoubleMetaphone.process_g-313"><span class="linenos">313</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-314"><a href="#DoubleMetaphone.process_g-314"><span class="linenos">314</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_g-315"><a href="#DoubleMetaphone.process_g-315"><span class="linenos">315</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_g-316"><a href="#DoubleMetaphone.process_g-316"><span class="linenos">316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_h" class="classattr">
                                        <input id="DoubleMetaphone.process_h-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_h</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_h-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_h"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_h-318"><a href="#DoubleMetaphone.process_h-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">process_h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_h-319"><a href="#DoubleMetaphone.process_h-319"><span class="linenos">319</span></a>        <span class="c1"># Keep if self.word.start_index &amp; before vowel, or between 2 vowels</span>
</span><span id="DoubleMetaphone.process_h-320"><a href="#DoubleMetaphone.process_h-320"><span class="linenos">320</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_h-321"><a href="#DoubleMetaphone.process_h-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_h-322"><a href="#DoubleMetaphone.process_h-322"><span class="linenos">322</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone.process_h-323"><a href="#DoubleMetaphone.process_h-323"><span class="linenos">323</span></a>        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_h-324"><a href="#DoubleMetaphone.process_h-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_h-325"><a href="#DoubleMetaphone.process_h-325"><span class="linenos">325</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_h-326"><a href="#DoubleMetaphone.process_h-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_j" class="classattr">
                                        <input id="DoubleMetaphone.process_j-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_j</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_j-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_j"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_j-328"><a href="#DoubleMetaphone.process_j-328"><span class="linenos">328</span></a>    <span class="k">def</span> <span class="nf">process_j</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_j-329"><a href="#DoubleMetaphone.process_j-329"><span class="linenos">329</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_j-330"><a href="#DoubleMetaphone.process_j-330"><span class="linenos">330</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_j-331"><a href="#DoubleMetaphone.process_j-331"><span class="linenos">331</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_j-332"><a href="#DoubleMetaphone.process_j-332"><span class="linenos">332</span></a>
</span><span id="DoubleMetaphone.process_j-333"><a href="#DoubleMetaphone.process_j-333"><span class="linenos">333</span></a>        <span class="c1"># Spanish, &#39;Jose&#39;, &#39;Jacinto&#39;, etc.</span>
</span><span id="DoubleMetaphone.process_j-334"><a href="#DoubleMetaphone.process_j-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_j-335"><a href="#DoubleMetaphone.process_j-335"><span class="linenos">335</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;JOSE&quot;</span>
</span><span id="DoubleMetaphone.process_j-336"><a href="#DoubleMetaphone.process_j-336"><span class="linenos">336</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SAN &quot;</span>
</span><span id="DoubleMetaphone.process_j-337"><a href="#DoubleMetaphone.process_j-337"><span class="linenos">337</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_j-338"><a href="#DoubleMetaphone.process_j-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span>
</span><span id="DoubleMetaphone.process_j-339"><a href="#DoubleMetaphone.process_j-339"><span class="linenos">339</span></a>                <span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span>
</span><span id="DoubleMetaphone.process_j-340"><a href="#DoubleMetaphone.process_j-340"><span class="linenos">340</span></a>            <span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SAN &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-341"><a href="#DoubleMetaphone.process_j-341"><span class="linenos">341</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_j-342"><a href="#DoubleMetaphone.process_j-342"><span class="linenos">342</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-343"><a href="#DoubleMetaphone.process_j-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_j-344"><a href="#DoubleMetaphone.process_j-344"><span class="linenos">344</span></a>
</span><span id="DoubleMetaphone.process_j-345"><a href="#DoubleMetaphone.process_j-345"><span class="linenos">345</span></a>        <span class="c1"># Yankelovich/Jankelowicz</span>
</span><span id="DoubleMetaphone.process_j-346"><a href="#DoubleMetaphone.process_j-346"><span class="linenos">346</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_j-347"><a href="#DoubleMetaphone.process_j-347"><span class="linenos">347</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_j-348"><a href="#DoubleMetaphone.process_j-348"><span class="linenos">348</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;JOSE&quot;</span>
</span><span id="DoubleMetaphone.process_j-349"><a href="#DoubleMetaphone.process_j-349"><span class="linenos">349</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_j-350"><a href="#DoubleMetaphone.process_j-350"><span class="linenos">350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_j-351"><a href="#DoubleMetaphone.process_j-351"><span class="linenos">351</span></a>
</span><span id="DoubleMetaphone.process_j-352"><a href="#DoubleMetaphone.process_j-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-353"><a href="#DoubleMetaphone.process_j-353"><span class="linenos">353</span></a>            <span class="c1"># Spanish pronunciation of e.g. &#39;Bajador&#39;</span>
</span><span id="DoubleMetaphone.process_j-354"><a href="#DoubleMetaphone.process_j-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_j-355"><a href="#DoubleMetaphone.process_j-355"><span class="linenos">355</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone.process_j-356"><a href="#DoubleMetaphone.process_j-356"><span class="linenos">356</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_j-357"><a href="#DoubleMetaphone.process_j-357"><span class="linenos">357</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_j-358"><a href="#DoubleMetaphone.process_j-358"><span class="linenos">358</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_j-359"><a href="#DoubleMetaphone.process_j-359"><span class="linenos">359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_j-360"><a href="#DoubleMetaphone.process_j-360"><span class="linenos">360</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-361"><a href="#DoubleMetaphone.process_j-361"><span class="linenos">361</span></a>                <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-362"><a href="#DoubleMetaphone.process_j-362"><span class="linenos">362</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_j-363"><a href="#DoubleMetaphone.process_j-363"><span class="linenos">363</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-364"><a href="#DoubleMetaphone.process_j-364"><span class="linenos">364</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone.process_j-365"><a href="#DoubleMetaphone.process_j-365"><span class="linenos">365</span></a>                        <span class="s2">&quot;L&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-366"><a href="#DoubleMetaphone.process_j-366"><span class="linenos">366</span></a>                        <span class="s2">&quot;T&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-367"><a href="#DoubleMetaphone.process_j-367"><span class="linenos">367</span></a>                        <span class="s2">&quot;K&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-368"><a href="#DoubleMetaphone.process_j-368"><span class="linenos">368</span></a>                        <span class="s2">&quot;S&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-369"><a href="#DoubleMetaphone.process_j-369"><span class="linenos">369</span></a>                        <span class="s2">&quot;N&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-370"><a href="#DoubleMetaphone.process_j-370"><span class="linenos">370</span></a>                        <span class="s2">&quot;M&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-371"><a href="#DoubleMetaphone.process_j-371"><span class="linenos">371</span></a>                        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-372"><a href="#DoubleMetaphone.process_j-372"><span class="linenos">372</span></a>                        <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_j-373"><a href="#DoubleMetaphone.process_j-373"><span class="linenos">373</span></a>                    <span class="p">]</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_j-374"><a href="#DoubleMetaphone.process_j-374"><span class="linenos">374</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_j-375"><a href="#DoubleMetaphone.process_j-375"><span class="linenos">375</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-376"><a href="#DoubleMetaphone.process_j-376"><span class="linenos">376</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_j-377"><a href="#DoubleMetaphone.process_j-377"><span class="linenos">377</span></a>
</span><span id="DoubleMetaphone.process_j-378"><a href="#DoubleMetaphone.process_j-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;J&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-379"><a href="#DoubleMetaphone.process_j-379"><span class="linenos">379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_j-380"><a href="#DoubleMetaphone.process_j-380"><span class="linenos">380</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_j-381"><a href="#DoubleMetaphone.process_j-381"><span class="linenos">381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_k" class="classattr">
                                        <input id="DoubleMetaphone.process_k-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_k</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_k-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_k"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_k-383"><a href="#DoubleMetaphone.process_k-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">process_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_k-384"><a href="#DoubleMetaphone.process_k-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_k-385"><a href="#DoubleMetaphone.process_k-385"><span class="linenos">385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_k-386"><a href="#DoubleMetaphone.process_k-386"><span class="linenos">386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_k-387"><a href="#DoubleMetaphone.process_k-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_l" class="classattr">
                                        <input id="DoubleMetaphone.process_l-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_l</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_l-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_l"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_l-389"><a href="#DoubleMetaphone.process_l-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">process_l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_l-390"><a href="#DoubleMetaphone.process_l-390"><span class="linenos">390</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_l-391"><a href="#DoubleMetaphone.process_l-391"><span class="linenos">391</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_l-392"><a href="#DoubleMetaphone.process_l-392"><span class="linenos">392</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_l-393"><a href="#DoubleMetaphone.process_l-393"><span class="linenos">393</span></a>
</span><span id="DoubleMetaphone.process_l-394"><a href="#DoubleMetaphone.process_l-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_l-395"><a href="#DoubleMetaphone.process_l-395"><span class="linenos">395</span></a>            <span class="c1"># Spanish e.g. &#39;cabrillo&#39;, &#39;gallegos&#39;</span>
</span><span id="DoubleMetaphone.process_l-396"><a href="#DoubleMetaphone.process_l-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_l-397"><a href="#DoubleMetaphone.process_l-397"><span class="linenos">397</span></a>                <span class="n">position</span> <span class="o">==</span> <span class="p">(</span><span class="n">end_index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_l-398"><a href="#DoubleMetaphone.process_l-398"><span class="linenos">398</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ILLO&quot;</span><span class="p">,</span> <span class="s2">&quot;ILLA&quot;</span><span class="p">,</span> <span class="s2">&quot;ALLE&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_l-399"><a href="#DoubleMetaphone.process_l-399"><span class="linenos">399</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_l-400"><a href="#DoubleMetaphone.process_l-400"><span class="linenos">400</span></a>                <span class="p">(</span>
</span><span id="DoubleMetaphone.process_l-401"><a href="#DoubleMetaphone.process_l-401"><span class="linenos">401</span></a>                    <span class="n">buffer</span><span class="p">[</span><span class="n">end_index</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AS&quot;</span><span class="p">,</span> <span class="s2">&quot;OS&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_l-402"><a href="#DoubleMetaphone.process_l-402"><span class="linenos">402</span></a>                    <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">end_index</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_l-403"><a href="#DoubleMetaphone.process_l-403"><span class="linenos">403</span></a>                <span class="p">)</span>
</span><span id="DoubleMetaphone.process_l-404"><a href="#DoubleMetaphone.process_l-404"><span class="linenos">404</span></a>                <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ALLE&quot;</span>
</span><span id="DoubleMetaphone.process_l-405"><a href="#DoubleMetaphone.process_l-405"><span class="linenos">405</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_l-406"><a href="#DoubleMetaphone.process_l-406"><span class="linenos">406</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_l-407"><a href="#DoubleMetaphone.process_l-407"><span class="linenos">407</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_l-408"><a href="#DoubleMetaphone.process_l-408"><span class="linenos">408</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_l-409"><a href="#DoubleMetaphone.process_l-409"><span class="linenos">409</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_l-410"><a href="#DoubleMetaphone.process_l-410"><span class="linenos">410</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_m" class="classattr">
                                        <input id="DoubleMetaphone.process_m-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_m</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_m-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_m"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_m-412"><a href="#DoubleMetaphone.process_m-412"><span class="linenos">412</span></a>    <span class="k">def</span> <span class="nf">process_m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_m-413"><a href="#DoubleMetaphone.process_m-413"><span class="linenos">413</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_m-414"><a href="#DoubleMetaphone.process_m-414"><span class="linenos">414</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_m-415"><a href="#DoubleMetaphone.process_m-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_m-416"><a href="#DoubleMetaphone.process_m-416"><span class="linenos">416</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;UMB&quot;</span>
</span><span id="DoubleMetaphone.process_m-417"><a href="#DoubleMetaphone.process_m-417"><span class="linenos">417</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_m-418"><a href="#DoubleMetaphone.process_m-418"><span class="linenos">418</span></a>                <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_m-419"><a href="#DoubleMetaphone.process_m-419"><span class="linenos">419</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ER&quot;</span>
</span><span id="DoubleMetaphone.process_m-420"><a href="#DoubleMetaphone.process_m-420"><span class="linenos">420</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone.process_m-421"><a href="#DoubleMetaphone.process_m-421"><span class="linenos">421</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_m-422"><a href="#DoubleMetaphone.process_m-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_m-423"><a href="#DoubleMetaphone.process_m-423"><span class="linenos">423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_m-424"><a href="#DoubleMetaphone.process_m-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_n" class="classattr">
                                        <input id="DoubleMetaphone.process_n-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_n</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_n-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_n"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_n-426"><a href="#DoubleMetaphone.process_n-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="nf">process_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_n-427"><a href="#DoubleMetaphone.process_n-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_n-428"><a href="#DoubleMetaphone.process_n-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_n-429"><a href="#DoubleMetaphone.process_n-429"><span class="linenos">429</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_n-430"><a href="#DoubleMetaphone.process_n-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_p" class="classattr">
                                        <input id="DoubleMetaphone.process_p-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_p</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_p-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_p"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_p-432"><a href="#DoubleMetaphone.process_p-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">process_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_p-433"><a href="#DoubleMetaphone.process_p-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_p-434"><a href="#DoubleMetaphone.process_p-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_p-435"><a href="#DoubleMetaphone.process_p-435"><span class="linenos">435</span></a>
</span><span id="DoubleMetaphone.process_p-436"><a href="#DoubleMetaphone.process_p-436"><span class="linenos">436</span></a>        <span class="c1"># Account for &quot;Campbell&quot;, &quot;raspberry&quot;</span>
</span><span id="DoubleMetaphone.process_p-437"><a href="#DoubleMetaphone.process_p-437"><span class="linenos">437</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_p-438"><a href="#DoubleMetaphone.process_p-438"><span class="linenos">438</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_p-439"><a href="#DoubleMetaphone.process_p-439"><span class="linenos">439</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_p-440"><a href="#DoubleMetaphone.process_p-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_q" class="classattr">
                                        <input id="DoubleMetaphone.process_q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_q</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_q-442"><a href="#DoubleMetaphone.process_q-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">process_q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_q-443"><a href="#DoubleMetaphone.process_q-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_q-444"><a href="#DoubleMetaphone.process_q-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_q-445"><a href="#DoubleMetaphone.process_q-445"><span class="linenos">445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_q-446"><a href="#DoubleMetaphone.process_q-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_r" class="classattr">
                                        <input id="DoubleMetaphone.process_r-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_r</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_r-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_r"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_r-448"><a href="#DoubleMetaphone.process_r-448"><span class="linenos">448</span></a>    <span class="k">def</span> <span class="nf">process_r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_r-449"><a href="#DoubleMetaphone.process_r-449"><span class="linenos">449</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_r-450"><a href="#DoubleMetaphone.process_r-450"><span class="linenos">450</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_r-451"><a href="#DoubleMetaphone.process_r-451"><span class="linenos">451</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_r-452"><a href="#DoubleMetaphone.process_r-452"><span class="linenos">452</span></a>
</span><span id="DoubleMetaphone.process_r-453"><a href="#DoubleMetaphone.process_r-453"><span class="linenos">453</span></a>        <span class="c1"># French e.g. &#39;Rogier&#39;, but exclude e.g. &#39;Hochmeier&#39;</span>
</span><span id="DoubleMetaphone.process_r-454"><a href="#DoubleMetaphone.process_r-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_r-455"><a href="#DoubleMetaphone.process_r-455"><span class="linenos">455</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_r-456"><a href="#DoubleMetaphone.process_r-456"><span class="linenos">456</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_r-457"><a href="#DoubleMetaphone.process_r-457"><span class="linenos">457</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;IE&quot;</span>
</span><span id="DoubleMetaphone.process_r-458"><a href="#DoubleMetaphone.process_r-458"><span class="linenos">458</span></a>            <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">4</span> <span class="p">:</span> <span class="n">position</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ME&quot;</span><span class="p">,</span> <span class="s2">&quot;MA&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_r-459"><a href="#DoubleMetaphone.process_r-459"><span class="linenos">459</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_r-460"><a href="#DoubleMetaphone.process_r-460"><span class="linenos">460</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_r-461"><a href="#DoubleMetaphone.process_r-461"><span class="linenos">461</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_r-462"><a href="#DoubleMetaphone.process_r-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_r-463"><a href="#DoubleMetaphone.process_r-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_r-464"><a href="#DoubleMetaphone.process_r-464"><span class="linenos">464</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_r-465"><a href="#DoubleMetaphone.process_r-465"><span class="linenos">465</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_r-466"><a href="#DoubleMetaphone.process_r-466"><span class="linenos">466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_s" class="classattr">
                                        <input id="DoubleMetaphone.process_s-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_s</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_s-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_s"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_s-468"><a href="#DoubleMetaphone.process_s-468"><span class="linenos">468</span></a>    <span class="k">def</span> <span class="nf">process_s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_s-469"><a href="#DoubleMetaphone.process_s-469"><span class="linenos">469</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_s-470"><a href="#DoubleMetaphone.process_s-470"><span class="linenos">470</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_s-471"><a href="#DoubleMetaphone.process_s-471"><span class="linenos">471</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_s-472"><a href="#DoubleMetaphone.process_s-472"><span class="linenos">472</span></a>        <span class="n">end_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_s-473"><a href="#DoubleMetaphone.process_s-473"><span class="linenos">473</span></a>
</span><span id="DoubleMetaphone.process_s-474"><a href="#DoubleMetaphone.process_s-474"><span class="linenos">474</span></a>        <span class="c1"># Special cases like &#39;Carlisle&#39;, &#39;Carlysle&#39;</span>
</span><span id="DoubleMetaphone.process_s-475"><a href="#DoubleMetaphone.process_s-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ISL&quot;</span><span class="p">,</span> <span class="s2">&quot;YSL&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-476"><a href="#DoubleMetaphone.process_s-476"><span class="linenos">476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-477"><a href="#DoubleMetaphone.process_s-477"><span class="linenos">477</span></a>
</span><span id="DoubleMetaphone.process_s-478"><a href="#DoubleMetaphone.process_s-478"><span class="linenos">478</span></a>        <span class="c1"># special case &#39;sugar-&#39;</span>
</span><span id="DoubleMetaphone.process_s-479"><a href="#DoubleMetaphone.process_s-479"><span class="linenos">479</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_s-480"><a href="#DoubleMetaphone.process_s-480"><span class="linenos">480</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SUGAR&quot;</span>
</span><span id="DoubleMetaphone.process_s-481"><a href="#DoubleMetaphone.process_s-481"><span class="linenos">481</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_s-482"><a href="#DoubleMetaphone.process_s-482"><span class="linenos">482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-483"><a href="#DoubleMetaphone.process_s-483"><span class="linenos">483</span></a>
</span><span id="DoubleMetaphone.process_s-484"><a href="#DoubleMetaphone.process_s-484"><span class="linenos">484</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SH&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-485"><a href="#DoubleMetaphone.process_s-485"><span class="linenos">485</span></a>            <span class="c1"># Germanic</span>
</span><span id="DoubleMetaphone.process_s-486"><a href="#DoubleMetaphone.process_s-486"><span class="linenos">486</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HEIM&quot;</span><span class="p">,</span> <span class="s2">&quot;HOEK&quot;</span><span class="p">,</span> <span class="s2">&quot;HOLM&quot;</span><span class="p">,</span> <span class="s2">&quot;HOLZ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-487"><a href="#DoubleMetaphone.process_s-487"><span class="linenos">487</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-488"><a href="#DoubleMetaphone.process_s-488"><span class="linenos">488</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-489"><a href="#DoubleMetaphone.process_s-489"><span class="linenos">489</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-490"><a href="#DoubleMetaphone.process_s-490"><span class="linenos">490</span></a>
</span><span id="DoubleMetaphone.process_s-491"><a href="#DoubleMetaphone.process_s-491"><span class="linenos">491</span></a>        <span class="c1"># Italian &amp; Armenian</span>
</span><span id="DoubleMetaphone.process_s-492"><a href="#DoubleMetaphone.process_s-492"><span class="linenos">492</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_s-493"><a href="#DoubleMetaphone.process_s-493"><span class="linenos">493</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SIO&quot;</span><span class="p">,</span> <span class="s2">&quot;SIA&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_s-494"><a href="#DoubleMetaphone.process_s-494"><span class="linenos">494</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SIAN&quot;</span>
</span><span id="DoubleMetaphone.process_s-495"><a href="#DoubleMetaphone.process_s-495"><span class="linenos">495</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_s-496"><a href="#DoubleMetaphone.process_s-496"><span class="linenos">496</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-497"><a href="#DoubleMetaphone.process_s-497"><span class="linenos">497</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-498"><a href="#DoubleMetaphone.process_s-498"><span class="linenos">498</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-499"><a href="#DoubleMetaphone.process_s-499"><span class="linenos">499</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-500"><a href="#DoubleMetaphone.process_s-500"><span class="linenos">500</span></a>
</span><span id="DoubleMetaphone.process_s-501"><a href="#DoubleMetaphone.process_s-501"><span class="linenos">501</span></a>        <span class="c1"># Lots of anglicisations to match here</span>
</span><span id="DoubleMetaphone.process_s-502"><a href="#DoubleMetaphone.process_s-502"><span class="linenos">502</span></a>        <span class="c1"># Germanic, e.g. &#39;Smith&#39; == &#39;Schmidt&#39;, &#39;Snider&#39; == &#39;Schneider&#39;</span>
</span><span id="DoubleMetaphone.process_s-503"><a href="#DoubleMetaphone.process_s-503"><span class="linenos">503</span></a>        <span class="c1"># Slavic languages, catch -sz- and the tricky Hungarian</span>
</span><span id="DoubleMetaphone.process_s-504"><a href="#DoubleMetaphone.process_s-504"><span class="linenos">504</span></a>        <span class="c1"># pronunciation with an &#39;s&#39;</span>
</span><span id="DoubleMetaphone.process_s-505"><a href="#DoubleMetaphone.process_s-505"><span class="linenos">505</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_s-506"><a href="#DoubleMetaphone.process_s-506"><span class="linenos">506</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_s-507"><a href="#DoubleMetaphone.process_s-507"><span class="linenos">507</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-508"><a href="#DoubleMetaphone.process_s-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-509"><a href="#DoubleMetaphone.process_s-509"><span class="linenos">509</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-510"><a href="#DoubleMetaphone.process_s-510"><span class="linenos">510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_s-511"><a href="#DoubleMetaphone.process_s-511"><span class="linenos">511</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-512"><a href="#DoubleMetaphone.process_s-512"><span class="linenos">512</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_s-513"><a href="#DoubleMetaphone.process_s-513"><span class="linenos">513</span></a>
</span><span id="DoubleMetaphone.process_s-514"><a href="#DoubleMetaphone.process_s-514"><span class="linenos">514</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SC&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-515"><a href="#DoubleMetaphone.process_s-515"><span class="linenos">515</span></a>            <span class="c1"># Schlesinger&#39;s rule</span>
</span><span id="DoubleMetaphone.process_s-516"><a href="#DoubleMetaphone.process_s-516"><span class="linenos">516</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-517"><a href="#DoubleMetaphone.process_s-517"><span class="linenos">517</span></a>                <span class="c1"># Dutch origin, e.g. &#39;school&#39;, &#39;schooner&#39;</span>
</span><span id="DoubleMetaphone.process_s-518"><a href="#DoubleMetaphone.process_s-518"><span class="linenos">518</span></a>                <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone.process_s-519"><a href="#DoubleMetaphone.process_s-519"><span class="linenos">519</span></a>                    <span class="s2">&quot;OO&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-520"><a href="#DoubleMetaphone.process_s-520"><span class="linenos">520</span></a>                    <span class="s2">&quot;ER&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-521"><a href="#DoubleMetaphone.process_s-521"><span class="linenos">521</span></a>                    <span class="s2">&quot;EN&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-522"><a href="#DoubleMetaphone.process_s-522"><span class="linenos">522</span></a>                    <span class="s2">&quot;UY&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-523"><a href="#DoubleMetaphone.process_s-523"><span class="linenos">523</span></a>                    <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-524"><a href="#DoubleMetaphone.process_s-524"><span class="linenos">524</span></a>                    <span class="s2">&quot;EM&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_s-525"><a href="#DoubleMetaphone.process_s-525"><span class="linenos">525</span></a>                <span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-526"><a href="#DoubleMetaphone.process_s-526"><span class="linenos">526</span></a>                    <span class="c1"># &#39;Schermerhorn&#39;, &#39;Schenker&#39;</span>
</span><span id="DoubleMetaphone.process_s-527"><a href="#DoubleMetaphone.process_s-527"><span class="linenos">527</span></a>                    <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ER&quot;</span><span class="p">,</span> <span class="s2">&quot;EN&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-528"><a href="#DoubleMetaphone.process_s-528"><span class="linenos">528</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-529"><a href="#DoubleMetaphone.process_s-529"><span class="linenos">529</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-530"><a href="#DoubleMetaphone.process_s-530"><span class="linenos">530</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-531"><a href="#DoubleMetaphone.process_s-531"><span class="linenos">531</span></a>
</span><span id="DoubleMetaphone.process_s-532"><a href="#DoubleMetaphone.process_s-532"><span class="linenos">532</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-533"><a href="#DoubleMetaphone.process_s-533"><span class="linenos">533</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_s-534"><a href="#DoubleMetaphone.process_s-534"><span class="linenos">534</span></a>                        <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_s-535"><a href="#DoubleMetaphone.process_s-535"><span class="linenos">535</span></a>                        <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VOWELS</span>
</span><span id="DoubleMetaphone.process_s-536"><a href="#DoubleMetaphone.process_s-536"><span class="linenos">536</span></a>                        <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;W&quot;</span>
</span><span id="DoubleMetaphone.process_s-537"><a href="#DoubleMetaphone.process_s-537"><span class="linenos">537</span></a>                    <span class="p">):</span>
</span><span id="DoubleMetaphone.process_s-538"><a href="#DoubleMetaphone.process_s-538"><span class="linenos">538</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-539"><a href="#DoubleMetaphone.process_s-539"><span class="linenos">539</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-540"><a href="#DoubleMetaphone.process_s-540"><span class="linenos">540</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-541"><a href="#DoubleMetaphone.process_s-541"><span class="linenos">541</span></a>
</span><span id="DoubleMetaphone.process_s-542"><a href="#DoubleMetaphone.process_s-542"><span class="linenos">542</span></a>            <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-543"><a href="#DoubleMetaphone.process_s-543"><span class="linenos">543</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-544"><a href="#DoubleMetaphone.process_s-544"><span class="linenos">544</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-545"><a href="#DoubleMetaphone.process_s-545"><span class="linenos">545</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-546"><a href="#DoubleMetaphone.process_s-546"><span class="linenos">546</span></a>
</span><span id="DoubleMetaphone.process_s-547"><a href="#DoubleMetaphone.process_s-547"><span class="linenos">547</span></a>        <span class="c1"># French e.g. &#39;Resnais&#39;, &#39;Artois&#39;</span>
</span><span id="DoubleMetaphone.process_s-548"><a href="#DoubleMetaphone.process_s-548"><span class="linenos">548</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">end_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;OI&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-549"><a href="#DoubleMetaphone.process_s-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_s-550"><a href="#DoubleMetaphone.process_s-550"><span class="linenos">550</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-551"><a href="#DoubleMetaphone.process_s-551"><span class="linenos">551</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_s-552"><a href="#DoubleMetaphone.process_s-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_s-553"><a href="#DoubleMetaphone.process_s-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_s-554"><a href="#DoubleMetaphone.process_s-554"><span class="linenos">554</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_s-555"><a href="#DoubleMetaphone.process_s-555"><span class="linenos">555</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_t" class="classattr">
                                        <input id="DoubleMetaphone.process_t-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_t</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_t-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_t"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_t-557"><a href="#DoubleMetaphone.process_t-557"><span class="linenos">557</span></a>    <span class="k">def</span> <span class="nf">process_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_t-558"><a href="#DoubleMetaphone.process_t-558"><span class="linenos">558</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_t-559"><a href="#DoubleMetaphone.process_t-559"><span class="linenos">559</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_t-560"><a href="#DoubleMetaphone.process_t-560"><span class="linenos">560</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_t-561"><a href="#DoubleMetaphone.process_t-561"><span class="linenos">561</span></a>
</span><span id="DoubleMetaphone.process_t-562"><a href="#DoubleMetaphone.process_t-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TION&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_t-563"><a href="#DoubleMetaphone.process_t-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_t-564"><a href="#DoubleMetaphone.process_t-564"><span class="linenos">564</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TIA&quot;</span><span class="p">,</span> <span class="s2">&quot;TCH&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_t-565"><a href="#DoubleMetaphone.process_t-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_t-566"><a href="#DoubleMetaphone.process_t-566"><span class="linenos">566</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_t-567"><a href="#DoubleMetaphone.process_t-567"><span class="linenos">567</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TH&quot;</span>
</span><span id="DoubleMetaphone.process_t-568"><a href="#DoubleMetaphone.process_t-568"><span class="linenos">568</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TTH&quot;</span>
</span><span id="DoubleMetaphone.process_t-569"><a href="#DoubleMetaphone.process_t-569"><span class="linenos">569</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_t-570"><a href="#DoubleMetaphone.process_t-570"><span class="linenos">570</span></a>            <span class="c1"># &#39;Thomas&#39;, &#39;Thames&#39; or hard-sound Germanic</span>
</span><span id="DoubleMetaphone.process_t-571"><a href="#DoubleMetaphone.process_t-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_t-572"><a href="#DoubleMetaphone.process_t-572"><span class="linenos">572</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OM&quot;</span><span class="p">,</span> <span class="s2">&quot;AM&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_t-573"><a href="#DoubleMetaphone.process_t-573"><span class="linenos">573</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VON &quot;</span><span class="p">,</span> <span class="s2">&quot;VAN &quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_t-574"><a href="#DoubleMetaphone.process_t-574"><span class="linenos">574</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone.process_t-575"><a href="#DoubleMetaphone.process_t-575"><span class="linenos">575</span></a>            <span class="p">):</span>
</span><span id="DoubleMetaphone.process_t-576"><a href="#DoubleMetaphone.process_t-576"><span class="linenos">576</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_t-577"><a href="#DoubleMetaphone.process_t-577"><span class="linenos">577</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_t-578"><a href="#DoubleMetaphone.process_t-578"><span class="linenos">578</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_t-579"><a href="#DoubleMetaphone.process_t-579"><span class="linenos">579</span></a>
</span><span id="DoubleMetaphone.process_t-580"><a href="#DoubleMetaphone.process_t-580"><span class="linenos">580</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_t-581"><a href="#DoubleMetaphone.process_t-581"><span class="linenos">581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_t-582"><a href="#DoubleMetaphone.process_t-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_t-583"><a href="#DoubleMetaphone.process_t-583"><span class="linenos">583</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_v" class="classattr">
                                        <input id="DoubleMetaphone.process_v-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_v</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_v-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_v"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_v-585"><a href="#DoubleMetaphone.process_v-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">process_v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_v-586"><a href="#DoubleMetaphone.process_v-586"><span class="linenos">586</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_v-587"><a href="#DoubleMetaphone.process_v-587"><span class="linenos">587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_v-588"><a href="#DoubleMetaphone.process_v-588"><span class="linenos">588</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_v-589"><a href="#DoubleMetaphone.process_v-589"><span class="linenos">589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_w" class="classattr">
                                        <input id="DoubleMetaphone.process_w-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_w</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_w-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_w"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_w-591"><a href="#DoubleMetaphone.process_w-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">process_w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_w-592"><a href="#DoubleMetaphone.process_w-592"><span class="linenos">592</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_w-593"><a href="#DoubleMetaphone.process_w-593"><span class="linenos">593</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_w-594"><a href="#DoubleMetaphone.process_w-594"><span class="linenos">594</span></a>        <span class="n">start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_w-595"><a href="#DoubleMetaphone.process_w-595"><span class="linenos">595</span></a>
</span><span id="DoubleMetaphone.process_w-596"><a href="#DoubleMetaphone.process_w-596"><span class="linenos">596</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WR&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_w-597"><a href="#DoubleMetaphone.process_w-597"><span class="linenos">597</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-598"><a href="#DoubleMetaphone.process_w-598"><span class="linenos">598</span></a>        <span class="k">elif</span> <span class="n">position</span> <span class="o">==</span> <span class="n">start_index</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_w-599"><a href="#DoubleMetaphone.process_w-599"><span class="linenos">599</span></a>            <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span> <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WH&quot;</span>
</span><span id="DoubleMetaphone.process_w-600"><a href="#DoubleMetaphone.process_w-600"><span class="linenos">600</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_w-601"><a href="#DoubleMetaphone.process_w-601"><span class="linenos">601</span></a>            <span class="c1"># Wasserman should match Vasserman</span>
</span><span id="DoubleMetaphone.process_w-602"><a href="#DoubleMetaphone.process_w-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_w-603"><a href="#DoubleMetaphone.process_w-603"><span class="linenos">603</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-604"><a href="#DoubleMetaphone.process_w-604"><span class="linenos">604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_w-605"><a href="#DoubleMetaphone.process_w-605"><span class="linenos">605</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-606"><a href="#DoubleMetaphone.process_w-606"><span class="linenos">606</span></a>
</span><span id="DoubleMetaphone.process_w-607"><a href="#DoubleMetaphone.process_w-607"><span class="linenos">607</span></a>        <span class="c1"># Arnow should match Arnoff</span>
</span><span id="DoubleMetaphone.process_w-608"><a href="#DoubleMetaphone.process_w-608"><span class="linenos">608</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_w-609"><a href="#DoubleMetaphone.process_w-609"><span class="linenos">609</span></a>            <span class="p">(</span><span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span> <span class="ow">and</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-610"><a href="#DoubleMetaphone.process_w-610"><span class="linenos">610</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_w-611"><a href="#DoubleMetaphone.process_w-611"><span class="linenos">611</span></a>            <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;EWSKI&quot;</span><span class="p">,</span> <span class="s2">&quot;EWSKY&quot;</span><span class="p">,</span> <span class="s2">&quot;OWSKI&quot;</span><span class="p">,</span> <span class="s2">&quot;OWSKY&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_w-612"><a href="#DoubleMetaphone.process_w-612"><span class="linenos">612</span></a>            <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">start_index</span> <span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SCH&quot;</span>
</span><span id="DoubleMetaphone.process_w-613"><a href="#DoubleMetaphone.process_w-613"><span class="linenos">613</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_w-614"><a href="#DoubleMetaphone.process_w-614"><span class="linenos">614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-615"><a href="#DoubleMetaphone.process_w-615"><span class="linenos">615</span></a>
</span><span id="DoubleMetaphone.process_w-616"><a href="#DoubleMetaphone.process_w-616"><span class="linenos">616</span></a>        <span class="c1"># Polish e.g. &#39;Filipowicz&#39;</span>
</span><span id="DoubleMetaphone.process_w-617"><a href="#DoubleMetaphone.process_w-617"><span class="linenos">617</span></a>        <span class="k">elif</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WICZ&quot;</span><span class="p">,</span> <span class="s2">&quot;WITZ&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_w-618"><a href="#DoubleMetaphone.process_w-618"><span class="linenos">618</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TS&quot;</span><span class="p">,</span> <span class="s2">&quot;FX&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_w-619"><a href="#DoubleMetaphone.process_w-619"><span class="linenos">619</span></a>
</span><span id="DoubleMetaphone.process_w-620"><a href="#DoubleMetaphone.process_w-620"><span class="linenos">620</span></a>        <span class="c1"># By default, &#39;W&#39; is skipped phonetically</span>
</span><span id="DoubleMetaphone.process_w-621"><a href="#DoubleMetaphone.process_w-621"><span class="linenos">621</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_w-622"><a href="#DoubleMetaphone.process_w-622"><span class="linenos">622</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_x" class="classattr">
                                        <input id="DoubleMetaphone.process_x-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_x</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_x-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_x"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_x-624"><a href="#DoubleMetaphone.process_x-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">process_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_x-625"><a href="#DoubleMetaphone.process_x-625"><span class="linenos">625</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span>
</span><span id="DoubleMetaphone.process_x-626"><a href="#DoubleMetaphone.process_x-626"><span class="linenos">626</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="DoubleMetaphone.process_x-627"><a href="#DoubleMetaphone.process_x-627"><span class="linenos">627</span></a>
</span><span id="DoubleMetaphone.process_x-628"><a href="#DoubleMetaphone.process_x-628"><span class="linenos">628</span></a>        <span class="c1"># French e.g. &#39;Breaux&#39;</span>
</span><span id="DoubleMetaphone.process_x-629"><a href="#DoubleMetaphone.process_x-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_x-630"><a href="#DoubleMetaphone.process_x-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_x-631"><a href="#DoubleMetaphone.process_x-631"><span class="linenos">631</span></a>            <span class="n">position</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span>
</span><span id="DoubleMetaphone.process_x-632"><a href="#DoubleMetaphone.process_x-632"><span class="linenos">632</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_x-633"><a href="#DoubleMetaphone.process_x-633"><span class="linenos">633</span></a>                <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;IAU&quot;</span><span class="p">,</span> <span class="s2">&quot;EAU&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_x-634"><a href="#DoubleMetaphone.process_x-634"><span class="linenos">634</span></a>                <span class="ow">or</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">position</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AU&quot;</span><span class="p">,</span> <span class="s2">&quot;OU&quot;</span><span class="p">]</span>
</span><span id="DoubleMetaphone.process_x-635"><a href="#DoubleMetaphone.process_x-635"><span class="linenos">635</span></a>            <span class="p">)</span>
</span><span id="DoubleMetaphone.process_x-636"><a href="#DoubleMetaphone.process_x-636"><span class="linenos">636</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_x-637"><a href="#DoubleMetaphone.process_x-637"><span class="linenos">637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;KS&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_x-638"><a href="#DoubleMetaphone.process_x-638"><span class="linenos">638</span></a>
</span><span id="DoubleMetaphone.process_x-639"><a href="#DoubleMetaphone.process_x-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="n">buffer</span><span class="p">[</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.process_x-640"><a href="#DoubleMetaphone.process_x-640"><span class="linenos">640</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_x-641"><a href="#DoubleMetaphone.process_x-641"><span class="linenos">641</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_x-642"><a href="#DoubleMetaphone.process_x-642"><span class="linenos">642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.process_z" class="classattr">
                                        <input id="DoubleMetaphone.process_z-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_z</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.process_z-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.process_z"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.process_z-644"><a href="#DoubleMetaphone.process_z-644"><span class="linenos">644</span></a>    <span class="k">def</span> <span class="nf">process_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DoubleMetaphone.process_z-645"><a href="#DoubleMetaphone.process_z-645"><span class="linenos">645</span></a>        <span class="c1"># Chinese pinyin e.g. &#39;zhao&#39;</span>
</span><span id="DoubleMetaphone.process_z-646"><a href="#DoubleMetaphone.process_z-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_z-647"><a href="#DoubleMetaphone.process_z-647"><span class="linenos">647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_z-648"><a href="#DoubleMetaphone.process_z-648"><span class="linenos">648</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="DoubleMetaphone.process_z-649"><a href="#DoubleMetaphone.process_z-649"><span class="linenos">649</span></a>            <span class="s2">&quot;ZO&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_z-650"><a href="#DoubleMetaphone.process_z-650"><span class="linenos">650</span></a>            <span class="s2">&quot;ZI&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_z-651"><a href="#DoubleMetaphone.process_z-651"><span class="linenos">651</span></a>            <span class="s2">&quot;ZA&quot;</span><span class="p">,</span>
</span><span id="DoubleMetaphone.process_z-652"><a href="#DoubleMetaphone.process_z-652"><span class="linenos">652</span></a>        <span class="p">]</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_z-653"><a href="#DoubleMetaphone.process_z-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">is_slavo_germanic</span>
</span><span id="DoubleMetaphone.process_z-654"><a href="#DoubleMetaphone.process_z-654"><span class="linenos">654</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.process_z-655"><a href="#DoubleMetaphone.process_z-655"><span class="linenos">655</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;T&quot;</span>
</span><span id="DoubleMetaphone.process_z-656"><a href="#DoubleMetaphone.process_z-656"><span class="linenos">656</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_z-657"><a href="#DoubleMetaphone.process_z-657"><span class="linenos">657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;TS&quot;</span><span class="p">)</span>
</span><span id="DoubleMetaphone.process_z-658"><a href="#DoubleMetaphone.process_z-658"><span class="linenos">658</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_z-659"><a href="#DoubleMetaphone.process_z-659"><span class="linenos">659</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_z-660"><a href="#DoubleMetaphone.process_z-660"><span class="linenos">660</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="DoubleMetaphone.process_z-661"><a href="#DoubleMetaphone.process_z-661"><span class="linenos">661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span>
</span><span id="DoubleMetaphone.process_z-662"><a href="#DoubleMetaphone.process_z-662"><span class="linenos">662</span></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span>
</span><span id="DoubleMetaphone.process_z-663"><a href="#DoubleMetaphone.process_z-663"><span class="linenos">663</span></a>        <span class="p">):</span>
</span><span id="DoubleMetaphone.process_z-664"><a href="#DoubleMetaphone.process_z-664"><span class="linenos">664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</span><span id="DoubleMetaphone.process_z-665"><a href="#DoubleMetaphone.process_z-665"><span class="linenos">665</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DoubleMetaphone.process_z-666"><a href="#DoubleMetaphone.process_z-666"><span class="linenos">666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></pre></div>


    

                            </div>
                            <div id="DoubleMetaphone.parse" class="classattr">
                                        <input id="DoubleMetaphone.parse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">input</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DoubleMetaphone.parse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DoubleMetaphone.parse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DoubleMetaphone.parse-668"><a href="#DoubleMetaphone.parse-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
</span><span id="DoubleMetaphone.parse-669"><a href="#DoubleMetaphone.parse-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">word</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="DoubleMetaphone.parse-670"><a href="#DoubleMetaphone.parse-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">start_index</span>
</span><span id="DoubleMetaphone.parse-671"><a href="#DoubleMetaphone.parse-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone.parse-672"><a href="#DoubleMetaphone.parse-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone.parse-673"><a href="#DoubleMetaphone.parse-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="DoubleMetaphone.parse-674"><a href="#DoubleMetaphone.parse-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_word_start</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-675"><a href="#DoubleMetaphone.parse-675"><span class="linenos">675</span></a>
</span><span id="DoubleMetaphone.parse-676"><a href="#DoubleMetaphone.parse-676"><span class="linenos">676</span></a>        <span class="c1"># Loop through chars in word.buffer</span>
</span><span id="DoubleMetaphone.parse-677"><a href="#DoubleMetaphone.parse-677"><span class="linenos">677</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-678"><a href="#DoubleMetaphone.parse-678"><span class="linenos">678</span></a>            <span class="n">character</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-679"><a href="#DoubleMetaphone.parse-679"><span class="linenos">679</span></a>
</span><span id="DoubleMetaphone.parse-680"><a href="#DoubleMetaphone.parse-680"><span class="linenos">680</span></a>            <span class="c1"># Vowels and spaces get special handling</span>
</span><span id="DoubleMetaphone.parse-681"><a href="#DoubleMetaphone.parse-681"><span class="linenos">681</span></a>            <span class="k">if</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-682"><a href="#DoubleMetaphone.parse-682"><span class="linenos">682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_vowel</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-683"><a href="#DoubleMetaphone.parse-683"><span class="linenos">683</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-684"><a href="#DoubleMetaphone.parse-684"><span class="linenos">684</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DoubleMetaphone.parse-685"><a href="#DoubleMetaphone.parse-685"><span class="linenos">685</span></a>                <span class="k">continue</span>
</span><span id="DoubleMetaphone.parse-686"><a href="#DoubleMetaphone.parse-686"><span class="linenos">686</span></a>
</span><span id="DoubleMetaphone.parse-687"><a href="#DoubleMetaphone.parse-687"><span class="linenos">687</span></a>            <span class="c1"># Other letters each have their own function</span>
</span><span id="DoubleMetaphone.parse-688"><a href="#DoubleMetaphone.parse-688"><span class="linenos">688</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-689"><a href="#DoubleMetaphone.parse-689"><span class="linenos">689</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_b</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-690"><a href="#DoubleMetaphone.parse-690"><span class="linenos">690</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-691"><a href="#DoubleMetaphone.parse-691"><span class="linenos">691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_c</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-692"><a href="#DoubleMetaphone.parse-692"><span class="linenos">692</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-693"><a href="#DoubleMetaphone.parse-693"><span class="linenos">693</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_d</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-694"><a href="#DoubleMetaphone.parse-694"><span class="linenos">694</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-695"><a href="#DoubleMetaphone.parse-695"><span class="linenos">695</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_f</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-696"><a href="#DoubleMetaphone.parse-696"><span class="linenos">696</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-697"><a href="#DoubleMetaphone.parse-697"><span class="linenos">697</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_g</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-698"><a href="#DoubleMetaphone.parse-698"><span class="linenos">698</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-699"><a href="#DoubleMetaphone.parse-699"><span class="linenos">699</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_h</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-700"><a href="#DoubleMetaphone.parse-700"><span class="linenos">700</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;J&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-701"><a href="#DoubleMetaphone.parse-701"><span class="linenos">701</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_j</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-702"><a href="#DoubleMetaphone.parse-702"><span class="linenos">702</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-703"><a href="#DoubleMetaphone.parse-703"><span class="linenos">703</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_k</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-704"><a href="#DoubleMetaphone.parse-704"><span class="linenos">704</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-705"><a href="#DoubleMetaphone.parse-705"><span class="linenos">705</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_l</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-706"><a href="#DoubleMetaphone.parse-706"><span class="linenos">706</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-707"><a href="#DoubleMetaphone.parse-707"><span class="linenos">707</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_m</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-708"><a href="#DoubleMetaphone.parse-708"><span class="linenos">708</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-709"><a href="#DoubleMetaphone.parse-709"><span class="linenos">709</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_n</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-710"><a href="#DoubleMetaphone.parse-710"><span class="linenos">710</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-711"><a href="#DoubleMetaphone.parse-711"><span class="linenos">711</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_p</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-712"><a href="#DoubleMetaphone.parse-712"><span class="linenos">712</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-713"><a href="#DoubleMetaphone.parse-713"><span class="linenos">713</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_q</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-714"><a href="#DoubleMetaphone.parse-714"><span class="linenos">714</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-715"><a href="#DoubleMetaphone.parse-715"><span class="linenos">715</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_r</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-716"><a href="#DoubleMetaphone.parse-716"><span class="linenos">716</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-717"><a href="#DoubleMetaphone.parse-717"><span class="linenos">717</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_s</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-718"><a href="#DoubleMetaphone.parse-718"><span class="linenos">718</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-719"><a href="#DoubleMetaphone.parse-719"><span class="linenos">719</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_t</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-720"><a href="#DoubleMetaphone.parse-720"><span class="linenos">720</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-721"><a href="#DoubleMetaphone.parse-721"><span class="linenos">721</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_v</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-722"><a href="#DoubleMetaphone.parse-722"><span class="linenos">722</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;W&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-723"><a href="#DoubleMetaphone.parse-723"><span class="linenos">723</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_w</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-724"><a href="#DoubleMetaphone.parse-724"><span class="linenos">724</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-725"><a href="#DoubleMetaphone.parse-725"><span class="linenos">725</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_x</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-726"><a href="#DoubleMetaphone.parse-726"><span class="linenos">726</span></a>            <span class="k">elif</span> <span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-727"><a href="#DoubleMetaphone.parse-727"><span class="linenos">727</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_z</span><span class="p">()</span>
</span><span id="DoubleMetaphone.parse-728"><a href="#DoubleMetaphone.parse-728"><span class="linenos">728</span></a>
</span><span id="DoubleMetaphone.parse-729"><a href="#DoubleMetaphone.parse-729"><span class="linenos">729</span></a>            <span class="c1"># Handle any residual unprocessed sound clusters</span>
</span><span id="DoubleMetaphone.parse-730"><a href="#DoubleMetaphone.parse-730"><span class="linenos">730</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-731"><a href="#DoubleMetaphone.parse-731"><span class="linenos">731</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.parse-732"><a href="#DoubleMetaphone.parse-732"><span class="linenos">732</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-733"><a href="#DoubleMetaphone.parse-733"><span class="linenos">733</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-734"><a href="#DoubleMetaphone.parse-734"><span class="linenos">734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-735"><a href="#DoubleMetaphone.parse-735"><span class="linenos">735</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-736"><a href="#DoubleMetaphone.parse-736"><span class="linenos">736</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.parse-737"><a href="#DoubleMetaphone.parse-737"><span class="linenos">737</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-738"><a href="#DoubleMetaphone.parse-738"><span class="linenos">738</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="DoubleMetaphone.parse-739"><a href="#DoubleMetaphone.parse-739"><span class="linenos">739</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-740"><a href="#DoubleMetaphone.parse-740"><span class="linenos">740</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-741"><a href="#DoubleMetaphone.parse-741"><span class="linenos">741</span></a>
</span><span id="DoubleMetaphone.parse-742"><a href="#DoubleMetaphone.parse-742"><span class="linenos">742</span></a>        <span class="c1"># Standardize all representations to the dominant</span>
</span><span id="DoubleMetaphone.parse-743"><a href="#DoubleMetaphone.parse-743"><span class="linenos">743</span></a>        <span class="c1"># first sound clusters</span>
</span><span id="DoubleMetaphone.parse-744"><a href="#DoubleMetaphone.parse-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-745"><a href="#DoubleMetaphone.parse-745"><span class="linenos">745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-746"><a href="#DoubleMetaphone.parse-746"><span class="linenos">746</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-747"><a href="#DoubleMetaphone.parse-747"><span class="linenos">747</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="DoubleMetaphone.parse-748"><a href="#DoubleMetaphone.parse-748"><span class="linenos">748</span></a>
</span><span id="DoubleMetaphone.parse-749"><a href="#DoubleMetaphone.parse-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">:</span>
</span><span id="DoubleMetaphone.parse-750"><a href="#DoubleMetaphone.parse-750"><span class="linenos">750</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DoubleMetaphone.parse-751"><a href="#DoubleMetaphone.parse-751"><span class="linenos">751</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_phone</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_phone</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="standardize_birth_date">
                            <input id="standardize_birth_date-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardize_birth_date</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">raw_dob</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">existing_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="standardize_birth_date-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standardize_birth_date"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standardize_birth_date-296"><a href="#standardize_birth_date-296"><span class="linenos">296</span></a><span class="k">def</span> <span class="nf">standardize_birth_date</span><span class="p">(</span>
</span><span id="standardize_birth_date-297"><a href="#standardize_birth_date-297"><span class="linenos">297</span></a>    <span class="n">raw_dob</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">existing_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">FHIR_DATE_FORMAT</span>
</span><span id="standardize_birth_date-298"><a href="#standardize_birth_date-298"><span class="linenos">298</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="standardize_birth_date-299"><a href="#standardize_birth_date-299"><span class="linenos">299</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="standardize_birth_date-300"><a href="#standardize_birth_date-300"><span class="linenos">300</span></a><span class="sd">    Validates and standardizes a date of birth string into YYYY-MM-DD format.</span>
</span><span id="standardize_birth_date-301"><a href="#standardize_birth_date-301"><span class="linenos">301</span></a>
</span><span id="standardize_birth_date-302"><a href="#standardize_birth_date-302"><span class="linenos">302</span></a><span class="sd">    :param raw_dob: One date of birth (dob) to standardize.</span>
</span><span id="standardize_birth_date-303"><a href="#standardize_birth_date-303"><span class="linenos">303</span></a><span class="sd">    :param existing_format: A python DateTime format used to parse the date of</span>
</span><span id="standardize_birth_date-304"><a href="#standardize_birth_date-304"><span class="linenos">304</span></a><span class="sd">        birth within the Patient resource.  Default: `%Y-%m-%d` (YYYY-MM-DD).</span>
</span><span id="standardize_birth_date-305"><a href="#standardize_birth_date-305"><span class="linenos">305</span></a><span class="sd">    :return: Date of birth as a string in YYYY-MM-DD format</span>
</span><span id="standardize_birth_date-306"><a href="#standardize_birth_date-306"><span class="linenos">306</span></a><span class="sd">        or None if date of birth is invalid.</span>
</span><span id="standardize_birth_date-307"><a href="#standardize_birth_date-307"><span class="linenos">307</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standardize_birth_date-308"><a href="#standardize_birth_date-308"><span class="linenos">308</span></a>
</span><span id="standardize_birth_date-309"><a href="#standardize_birth_date-309"><span class="linenos">309</span></a>    <span class="c1">#  Need to make sure dob is not None or null (&quot;&quot;)</span>
</span><span id="standardize_birth_date-310"><a href="#standardize_birth_date-310"><span class="linenos">310</span></a>    <span class="c1">#  or detect() will end up in an infinite loop</span>
</span><span id="standardize_birth_date-311"><a href="#standardize_birth_date-311"><span class="linenos">311</span></a>    <span class="k">if</span> <span class="n">raw_dob</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_dob</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="standardize_birth_date-312"><a href="#standardize_birth_date-312"><span class="linenos">312</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Date of Birth must be supplied!&quot;</span><span class="p">)</span>
</span><span id="standardize_birth_date-313"><a href="#standardize_birth_date-313"><span class="linenos">313</span></a>
</span><span id="standardize_birth_date-314"><a href="#standardize_birth_date-314"><span class="linenos">314</span></a>    <span class="n">standardized_dob</span> <span class="o">=</span> <span class="n">_standardize_date</span><span class="p">(</span>
</span><span id="standardize_birth_date-315"><a href="#standardize_birth_date-315"><span class="linenos">315</span></a>        <span class="n">raw_date</span><span class="o">=</span><span class="n">raw_dob</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="n">existing_format</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">True</span>
</span><span id="standardize_birth_date-316"><a href="#standardize_birth_date-316"><span class="linenos">316</span></a>    <span class="p">)</span>
</span><span id="standardize_birth_date-317"><a href="#standardize_birth_date-317"><span class="linenos">317</span></a>
</span><span id="standardize_birth_date-318"><a href="#standardize_birth_date-318"><span class="linenos">318</span></a>    <span class="k">return</span> <span class="n">standardized_dob</span>
</span></pre></div>


            <div class="docstring"><p>Validates and standardizes a date of birth string into YYYY-MM-DD format.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>raw_dob</strong>:  One date of birth (dob) to standardize.</li>
<li><strong>existing_format</strong>:  A python DateTime format used to parse the date of
birth within the Patient resource.  Default: <code>%Y-%m-%d</code> (YYYY-MM-DD).</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Date of birth as a string in YYYY-MM-DD format
      or None if date of birth is invalid.</p>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>