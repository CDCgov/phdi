version: '3.8'

services:
  # Next.js app
  nextjs-app:
    container_name: ecr-viewer
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ecr-viewer-app:/app
    environment:
      - DATABASE_URL=postgres://username:password@postgres:5432/ecrviewer_db
    depends_on:
      - postgres
      # - db-seed

  # PostgreSQL database
  postgres:
    image: postgres:14-alpine
    ports:
      - 5432:5432
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
      - ./seed-scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=ecr_user
      - POSTGRES_DB=ecrviewer_db
    
# Database seeding
  # db-seed:
  #   container_name: db-seed
  #   image: postgres:latest
  #   restart: "no"
  #   depends_on:
  #     - postgres
  #   volumes:
  #     - ./seed-scripts:/docker-entrypoint-initdb.d
volumes:
  ecr-viewer-app: