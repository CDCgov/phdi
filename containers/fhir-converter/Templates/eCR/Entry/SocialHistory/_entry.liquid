{% assign socialObservations = entry.observation | to_array -%}
{% if socialObservations.first -%}
    {% for socialObservation in socialObservations -%}
        {% if socialObservation.code.nullFlavor or socialObservation.value.nullFlavor -%}
        {% else -%}
            {% if patientSocialExtensions == true -%}
                {% if socialObservation.templateId and socialObservation.templateId.root and socialObservation.templateId.root == '2.16.840.1.113883.10.20.34.3.45' -%}
                    {% assign gendIdObs = socialObservation -%}
                {% endif -%}
                {% if socialObservation.templateId and socialObservation.templateId.root and socialObservation.templateId.root == '2.16.840.1.113883.10.20.22.4.200' -%}
                    {% assign birthSObs = socialObservation -%}
                {% endif -%}
            {% else -%}
                {% assign birthSObs = nil -%}
                {% assign gendIdObs = nil -%}
                {% assign socialObservationId = socialObservation | to_json_string | generate_uuid -%}       
                {% if socialObservation.templateId and socialObservation.templateId.root and socialObservation.templateId.root == '2.16.840.1.113883.10.20.22.4.109' -%}
                    {% include 'Resource/ObservationHomeEnv' observationCategory: 'social-history', observationEntry: socialObservation, ID: socialObservationId -%}
                    {% include 'Reference/Observation/Subject' ID: socialObservationId, REF: fullPatientId -%}
                {% else -%}
                    {% include 'Resource/Observation' observationCategory: 'social-history', observationEntry: socialObservation, ID: socialObservationId -%}
                    {% include 'Reference/Observation/Subject' ID: socialObservationId, REF: fullPatientId -%}
                {% endif -%}
            {% endif -%}
        {% endif -%}
    {% endfor -%}
{% endif -%}
